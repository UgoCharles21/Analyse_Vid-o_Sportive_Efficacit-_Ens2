<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analyse Vid√©o ‚Äî √âducation physique (Supabase)</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=DM+Mono:wght@400;500&display=swap');

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     VARIABLES & RESET
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  :root {
    --navy:    #0D1B2A;
    --blue:    #1B4F72;
    --accent:  #2E86C1;
    --teal:    #1ABC9C;
    --orange:  #E67E22;
    --green:   #27AE60;
    --red:     #E74C3C;
    --purple:  #8E44AD;
    --gold:    #F0C040;
    --white:   #FFFFFF;
    --offwhite:#F5F8FA;
    --lgray:   #BDC3C7;
    --gray:    #7F8C8D;
    --dark:    #1A252F;
  }
  * { box-sizing:border-box; margin:0; padding:0; }
  body { font-family:'DM Sans',sans-serif; background:var(--navy); color:var(--white); min-height:100vh; }
  input,textarea,select { font-family:'DM Sans',sans-serif; }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     CONFIG BANNER (visible une fois, puis masqu√©e)
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  #config-banner {
    background: #1a0a00;
    border-bottom: 2px solid var(--orange);
    padding: 0.9rem 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
  }
  #config-banner .cb-label { font-size:0.8rem; font-weight:700; color:var(--orange); letter-spacing:1px; white-space:nowrap; }
  #config-banner input {
    background:rgba(255,255,255,0.08); border:1px solid var(--orange);
    color:var(--white); padding:0.35rem 0.7rem; border-radius:6px;
    font-size:0.82rem; flex:1; min-width:180px;
  }
  #config-banner button {
    background:var(--orange); border:none; color:var(--white);
    padding:0.4rem 1rem; border-radius:6px; cursor:pointer;
    font-weight:700; font-size:0.82rem; white-space:nowrap;
  }
  #config-banner button:hover { background:#ca6f1e; }
  #config-saved { font-size:0.78rem; color:var(--teal); font-weight:600; display:none; }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     HEADER & TABS
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  .app-header {
    background:linear-gradient(135deg,#0D1B2A 0%,#1B3A5C 60%,#0D2137 100%);
    padding:1.5rem 2rem 0;
    border-bottom:2px solid var(--accent);
  }
  .app-header-top {
    display:flex; align-items:center; justify-content:space-between;
    margin-bottom:1rem; flex-wrap:wrap; gap:0.8rem;
  }
  .app-title { font-size:1.5rem; font-weight:700; }
  .app-title span { color:var(--teal); }
  .user-pill {
    background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.15);
    border-radius:20px; padding:0.3rem 0.9rem; font-size:0.82rem; color:#A9CCE3;
    display:flex; align-items:center; gap:0.5rem;
  }
  .user-dot { width:8px; height:8px; border-radius:50%; background:var(--teal); }

  .tabs {
    display:flex; gap:0.3rem; flex-wrap:wrap;
  }
  .tab-btn {
    background:transparent; border:none; color:#A9CCE3;
    padding:0.6rem 1.2rem; cursor:pointer;
    font-family:'DM Sans',sans-serif; font-size:0.88rem; font-weight:500;
    border-bottom:3px solid transparent; transition:all 0.2s;
  }
  .tab-btn:hover { color:var(--white); }
  .tab-btn.active { color:var(--white); border-bottom-color:var(--accent); }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SECTIONS
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  .section { display:none; padding:2rem 2rem; max-width:1100px; margin:0 auto; }
  .section.active { display:block; }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     LOADING SPINNER
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  .loading {
    display:flex; align-items:center; gap:0.8rem;
    color:#A9CCE3; font-size:0.9rem; padding:2rem 0;
  }
  .spinner {
    width:20px; height:20px; border:2px solid rgba(255,255,255,0.15);
    border-top-color:var(--accent); border-radius:50%;
    animation:spin 0.7s linear infinite;
  }
  @keyframes spin { to { transform:rotate(360deg); } }

  .error-box {
    background:rgba(231,76,60,0.1); border:1px solid rgba(231,76,60,0.4);
    border-radius:10px; padding:1rem 1.2rem; color:#E74C3C; font-size:0.88rem;
    display:none; margin-bottom:1rem;
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     FORMULAIRE √âTUDIANT
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  .form-section-header {
    display:flex; align-items:center; gap:0.6rem;
    padding:0.8rem 1.2rem;
    border-radius:8px 8px 0 0;
    font-size:0.75rem; font-weight:700; letter-spacing:1.8px; text-transform:uppercase;
  }
  .form-card {
    background:#0F2033; border:1px solid #1E3A55;
    border-radius:12px; overflow:hidden; margin-bottom:1.5rem;
  }
  .form-body { padding:1.4rem 1.4rem; display:flex; flex-direction:column; gap:1.1rem; }

  .fgroup { display:flex; flex-direction:column; gap:0.35rem; }
  .fgroup label { font-size:0.85rem; font-weight:600; color:#D6E8F5; }
  .fgroup .hint { font-size:0.76rem; color:#6C8EA8; font-style:italic; margin-top:0.15rem; }
  .fgroup input, .fgroup textarea, .fgroup select {
    background:#122030; border:1.5px solid #2A4A6A;
    border-radius:8px; padding:0.65rem 0.9rem; color:#ECF0F1;
    font-size:0.92rem; width:100%; transition:border-color 0.2s;
  }
  .fgroup input::placeholder, .fgroup textarea::placeholder { color:#4A6A85; }
  .fgroup input:focus, .fgroup textarea:focus, .fgroup select:focus {
    outline:none; border-color:var(--accent);
    background:#0F2A3D;
  }
  .fgroup textarea { min-height:100px; resize:vertical; line-height:1.6; }
  .fgroup select option { background:#1B3A5C; color:#ECF0F1; }

  .fgrid2 { display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
  .fgrid3 { display:grid; grid-template-columns:1fr 1fr 1fr; gap:1rem; }

  /* Radio choices */
  .radio-group { display:flex; flex-direction:column; gap:0.45rem; }
  .radio-item {
    display:flex; align-items:center; gap:1rem;
    background:#16283A; border:1.5px solid #2A4A6A;
    border-radius:10px; padding:0.85rem 1.1rem; cursor:pointer;
    transition:all 0.18s; max-width:680px;
  }
  .radio-item:hover {
    border-color:var(--accent); background:#1A3250;
    box-shadow:0 2px 12px rgba(46,134,193,0.15);
  }
  .radio-item input[type=radio] {
    width:18px; height:18px; flex-shrink:0;
    accent-color:var(--accent); cursor:pointer;
  }
  .radio-item-body { flex:1; }
  .radio-item-title { font-weight:600; font-size:0.95rem; color:#ECF0F1; line-height:1.3; }
  .radio-item-desc  { font-size:0.82rem; color:#85A7C5; margin-top:0.25rem; line-height:1.45; }
  .radio-item.selected {
    border-color:var(--accent); background:#1A3A58;
    box-shadow:0 0 0 3px rgba(46,134,193,0.18);
  }
  .radio-item.selected .radio-item-title { color:#FFFFFF !important; }
  .radio-item.selected .radio-item-desc  { color:#A9CCE3 !important; }
  .radio-item input[type=radio]:disabled + .radio-item-body .radio-item-title { opacity:0.75; }
  .radio-item:has(input:checked) .radio-item-title { color:#FFFFFF !important; }
  .radio-item:has(input:checked) .radio-item-desc  { color:#A9CCE3 !important; }

  .req { color:var(--red); margin-left:2px; }

  /* Submit button */
  .btn-submit {
    background:linear-gradient(135deg, var(--accent), var(--teal));
    border:none; color:var(--white); padding:0.9rem 2.5rem;
    border-radius:10px; font-size:1rem; font-weight:700; cursor:pointer;
    width:100%; transition:opacity 0.2s; margin-top:0.5rem;
    font-family:'DM Sans',sans-serif;
  }
  .btn-submit:hover { opacity:0.9; }
  .btn-submit:disabled { opacity:0.5; cursor:not-allowed; }

  /* Success message */
  .success-box {
    background:rgba(39,174,96,0.1); border:1px solid rgba(39,174,96,0.4);
    border-radius:12px; padding:2rem; text-align:center; display:none;
  }
  .success-box .check { font-size:3rem; margin-bottom:0.8rem; }
  .success-box h3 { font-size:1.3rem; font-weight:700; color:var(--green); margin-bottom:0.5rem; }
  .success-box p { color:#A9CCE3; font-size:0.9rem; line-height:1.6; }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TABLEAU DE BORD ENSEIGNANT
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  .kpi-grid {
    display:grid; grid-template-columns:repeat(4,1fr); gap:1rem; margin-bottom:1.5rem;
  }
  .kpi {
    background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1);
    border-radius:12px; padding:1.2rem; text-align:center;
    transition:transform 0.2s;
  }
  .kpi:hover { transform:translateY(-2px); }
  .kpi-value { font-size:2.4rem; font-weight:700; line-height:1; margin-bottom:0.3rem; }
  .kpi-label { font-size:0.72rem; color:#A9CCE3; text-transform:uppercase; letter-spacing:1px; }

  .charts-grid {
    display:grid; grid-template-columns:1fr 1fr; gap:1.5rem; margin-bottom:1.5rem;
  }
  .chart-card {
    background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.1);
    border-radius:14px; padding:1.2rem;
  }
  .chart-title {
    font-size:0.75rem; font-weight:700; letter-spacing:1px; text-transform:uppercase;
    color:#A9CCE3; margin-bottom:1rem;
  }

  .bar-chart { display:flex; flex-direction:column; gap:0.6rem; }
  .bar-row { display:flex; align-items:center; gap:0.8rem; }
  .bar-label { font-size:0.78rem; width:110px; flex-shrink:0; color:#A9CCE3; }
  .bar-track { flex:1; background:rgba(255,255,255,0.06); border-radius:4px; height:22px; overflow:hidden; }
  .bar-fill {
    height:100%; border-radius:4px;
    background:linear-gradient(90deg, var(--accent), var(--teal));
    display:flex; align-items:center; padding-left:0.5rem;
    font-size:0.7rem; font-weight:600; color:white;
    transition:width 0.8s ease;
  }
  .bar-count { font-size:0.76rem; color:var(--lgray); width:28px; text-align:right; }

  /* Donut chart via SVG */
  .donut-wrap { display:flex; align-items:center; gap:1.2rem; margin-bottom:1rem; }
  .donut-legend { display:flex; flex-direction:column; gap:0.35rem; }
  .donut-legend-item { display:flex; align-items:center; gap:0.5rem; font-size:0.8rem; }
  .donut-dot { width:10px; height:10px; border-radius:50%; flex-shrink:0; }

  /* Filtres */
  .filters {
    display:flex; gap:0.8rem; margin-bottom:1rem; flex-wrap:wrap;
    align-items:center;
  }
  .filter-select {
    background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.15);
    color:var(--white); padding:0.4rem 0.8rem; border-radius:8px;
    font-size:0.85rem; font-family:'DM Sans',sans-serif; cursor:pointer;
  }
  .filter-select option { background:#1B3A5C; }
  .btn-refresh {
    background:rgba(46,134,193,0.2); border:1px solid var(--accent);
    color:var(--accent); padding:0.4rem 1rem; border-radius:8px;
    font-size:0.82rem; font-weight:600; cursor:pointer;
    font-family:'DM Sans',sans-serif; transition:all 0.2s;
    display:flex; align-items:center; gap:0.4rem;
  }
  .btn-refresh:hover { background:rgba(46,134,193,0.35); }

  /* Table */
  .table-wrap {
    background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.1);
    border-radius:14px; overflow:hidden;
  }
  .table-header {
    display:grid; grid-template-columns:2fr 1.2fr 0.9fr 0.9fr 0.7fr 0.9fr 0.7fr;
    background:rgba(46,134,193,0.15); padding:0.65rem 1rem;
    font-size:0.7rem; font-weight:700; letter-spacing:1px; text-transform:uppercase;
    color:#A9CCE3; border-bottom:1px solid rgba(255,255,255,0.08);
    gap:0.5rem;
  }
  .table-row {
    display:grid; grid-template-columns:2fr 1.2fr 0.9fr 0.9fr 0.7fr 0.9fr 0.7fr;
    padding:0.7rem 1rem; font-size:0.83rem; gap:0.5rem;
    border-bottom:1px solid rgba(255,255,255,0.05);
    transition:background 0.15s; align-items:center; cursor:pointer;
  }
  .table-row:hover { background:rgba(255,255,255,0.04); }
  .table-row:last-child { border-bottom:none; }

  .badge {
    display:inline-block; padding:0.18rem 0.55rem; border-radius:12px;
    font-size:0.7rem; font-weight:700; white-space:nowrap;
  }
  .badge-s1 { background:rgba(231,76,60,0.2); color:#FF7675; border:1px solid rgba(231,76,60,0.5); font-weight:700; }
  .badge-s2 { background:rgba(230,126,34,0.2); color:#F39C12; border:1px solid rgba(230,126,34,0.5); font-weight:700; }
  .badge-s3 { background:rgba(39,174,96,0.2);  color:#00B894; border:1px solid rgba(39,174,96,0.5); font-weight:700; }
  .badge-ok { background:rgba(26,188,156,0.2); color:#00CEC9; border:1px solid rgba(26,188,156,0.5); font-weight:700; }
  .badge-att{ background:rgba(240,192,64,0.2); color:#FDCB6E; border:1px solid rgba(240,192,64,0.5); font-weight:700; }

  /* Modal de correction */
  .modal-overlay {
    position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:100;
    display:none; align-items:center; justify-content:center; padding:1rem;
  }
  .modal-overlay.open { display:flex; }
  .modal {
    background:#1B2E40; border:1px solid rgba(255,255,255,0.15); border-radius:16px;
    width:100%; max-width:700px; max-height:90vh; overflow-y:auto;
    padding:2rem;
  }
  .modal-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:1.5rem; }
  .modal-title { font-size:1.2rem; font-weight:700; }
  .modal-close {
    background:rgba(255,255,255,0.1); border:none; color:var(--white);
    width:32px; height:32px; border-radius:50%; cursor:pointer; font-size:1.1rem;
    display:flex; align-items:center; justify-content:center; flex-shrink:0;
  }
  .modal-section { margin-bottom:1.2rem; }
  .modal-section-label {
    font-size:0.72rem; font-weight:700; letter-spacing:1.5px; text-transform:uppercase;
    color:var(--accent); margin-bottom:0.5rem;
  }
  .modal-value {
    background:rgba(255,255,255,0.04); border-radius:8px; padding:0.7rem 0.9rem;
    font-size:0.88rem; color:#D0DCE8; line-height:1.6;
  }
  .modal-video-link {
    color:var(--teal); text-decoration:none; font-weight:600; font-size:0.85rem;
    display:inline-flex; align-items:center; gap:0.4rem;
  }
  .modal-video-link:hover { text-decoration:underline; }
  .modal-note-area {
    display:grid; grid-template-columns:auto 1fr; gap:1rem; align-items:start;
    margin-top:1rem;
  }
  .note-input {
    background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.2);
    border-radius:8px; padding:0.5rem 0.7rem; color:var(--white);
    font-size:1.3rem; font-weight:700; width:80px; text-align:center;
    font-family:'DM Sans',sans-serif;
  }
  .comment-input {
    background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.15);
    border-radius:8px; padding:0.6rem 0.8rem; color:var(--white);
    font-size:0.88rem; width:100%; min-height:80px; resize:vertical;
    font-family:'DM Sans',sans-serif; line-height:1.6;
  }
  .note-input:focus, .comment-input:focus {
    outline:none; border-color:var(--accent); background:rgba(46,134,193,0.1);
  }
  .btn-save {
    background:linear-gradient(135deg,var(--green),var(--teal));
    border:none; color:var(--white); padding:0.7rem 2rem;
    border-radius:8px; font-size:0.9rem; font-weight:700; cursor:pointer;
    font-family:'DM Sans',sans-serif; width:100%; margin-top:0.5rem;
  }
  .btn-save:disabled { opacity:0.5; cursor:not-allowed; }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SETUP PAGE (premi√®re configuration)
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  .setup-card {
    background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.12);
    border-radius:16px; padding:2rem; max-width:700px; margin:2rem auto;
  }
  .setup-title { font-size:1.4rem; font-weight:700; margin-bottom:0.5rem; }
  .setup-sub { color:#A9CCE3; font-size:0.9rem; margin-bottom:1.5rem; line-height:1.6; }
  .setup-field { display:flex; flex-direction:column; gap:0.35rem; margin-bottom:1rem; }
  .setup-field label { font-size:0.82rem; font-weight:600; color:#A9CCE3; }
  .setup-field input {
    background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.15);
    border-radius:8px; padding:0.65rem 0.9rem; color:var(--white);
    font-size:0.9rem; font-family:'DM Sans',sans-serif;
  }
  .setup-field input:focus { outline:none; border-color:var(--accent); }
  .setup-field .hint { font-size:0.75rem; color:var(--gray); font-style:italic; }
  .btn-setup {
    background:linear-gradient(135deg,var(--accent),var(--teal));
    border:none; color:var(--white); padding:0.8rem 2rem;
    border-radius:10px; font-size:1rem; font-weight:700; cursor:pointer;
    font-family:'DM Sans',sans-serif; width:100%; margin-top:0.5rem;
  }
  .setup-step {
    display:flex; gap:0.8rem; align-items:flex-start;
    font-size:0.85rem; color:#D0DCE8; margin-bottom:0.6rem; line-height:1.5;
  }
  .setup-step-num {
    background:var(--accent); color:white; width:22px; height:22px;
    border-radius:50%; display:flex; align-items:center; justify-content:center;
    font-size:0.72rem; font-weight:700; flex-shrink:0;
  }

  @media(max-width:700px){
    .kpi-grid { grid-template-columns:1fr 1fr; }
    .charts-grid { grid-template-columns:1fr; }
    .table-header,.table-row { grid-template-columns:2fr 1fr 1fr 1fr; }
    .table-header>*:nth-child(n+5), .table-row>*:nth-child(n+5) { display:none; }
    .fgrid2,.fgrid3 { grid-template-columns:1fr; }
    .logi-form-grid { grid-template-columns:1fr!important; }
    .logi-yesno { grid-template-columns:1fr!important; }
    .logi-action-btns { grid-template-columns:1fr!important; }
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     LOGIGRAMME ‚Äî styles autonomes
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  #logigramme { font-family:'DM Sans',sans-serif; }
  .logi-wrap { max-width:820px; margin:0 auto; }

  .logi-progress { display:flex; align-items:center; gap:8px; margin-bottom:28px; justify-content:center; flex-wrap:wrap; }
  .logi-dot { width:8px; height:8px; border-radius:50%; background:rgba(255,255,255,0.15); transition:all .3s; }
  .logi-dot.active { background:var(--accent); width:24px; border-radius:4px; }
  .logi-dot.done { background:var(--teal); }

  @keyframes logiIn { from{opacity:0;transform:translateY(14px);} to{opacity:1;transform:translateY(0);} }

  .logi-card {
    background:#0F2033; border:1px solid #1E3A55;
    border-radius:14px; padding:28px 28px; margin-bottom:16px;
    position:relative; overflow:hidden;
    animation:logiIn .3s cubic-bezier(.16,1,.3,1);
  }
  .logi-card::before {
    content:''; position:absolute; top:0; left:0; right:0; height:2px;
    background:linear-gradient(90deg,var(--accent),transparent);
  }
  .logi-step-tag {
    font-size:10px; font-weight:700; letter-spacing:.2em; text-transform:uppercase;
    color:var(--accent); margin-bottom:10px; display:block;
  }
  .logi-card h2 { font-size:clamp(15px,2.2vw,20px); font-weight:700; color:#ECF0F1; margin-bottom:6px; line-height:1.3; }
  .logi-card > p { color:#85A7C5; font-size:13px; line-height:1.7; margin-bottom:16px; }

  .logi-form-grid { display:grid; grid-template-columns:1fr 1fr; gap:14px; margin-bottom:14px; }
  .logi-fgroup { display:flex; flex-direction:column; gap:5px; }
  .logi-fgroup label { font-size:11px; font-weight:600; letter-spacing:.1em; text-transform:uppercase; color:#85A7C5; }
  .logi-fgroup input, .logi-fgroup textarea {
    background:#122030; border:1.5px solid #2A4A6A; border-radius:8px;
    padding:10px 12px; color:#F0F4F8; font-family:'DM Sans',sans-serif;
    font-size:13px; outline:none; transition:border-color .2s;
  }
  .logi-fgroup input:focus, .logi-fgroup textarea:focus { border-color:var(--accent); }
  .logi-fgroup input::placeholder, .logi-fgroup textarea::placeholder { color:#4A6A85; opacity:.7; }
  .logi-fgroup textarea { min-height:56px; resize:vertical; }
  .logi-req { color:var(--red); margin-left:2px; }

  .logi-obj-section {
    background:rgba(46,134,193,0.05); border:1px solid rgba(46,134,193,0.15);
    border-radius:10px; padding:18px; margin-bottom:14px;
  }
  .logi-obj-title {
    font-size:11px; font-weight:700; letter-spacing:.15em; text-transform:uppercase;
    color:var(--accent); margin-bottom:14px;
  }
  .logi-obj-item {
    background:#0D1B2A; border:1px solid #1E3A55;
    border-radius:8px; padding:14px; margin-bottom:10px;
  }
  .logi-obj-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; }
  .logi-obj-num { font-size:11px; font-weight:700; color:var(--accent); letter-spacing:.1em; }
  .logi-btn-rm-obj {
    background:rgba(231,76,60,0.1); border:1px solid rgba(231,76,60,0.25);
    border-radius:5px; padding:3px 9px; color:#E74C3C; font-size:11px; font-weight:600; cursor:pointer;
  }
  .logi-ind-list { display:flex; flex-direction:column; gap:7px; margin-top:10px; }
  .logi-ind-row { display:flex; gap:7px; align-items:flex-start; }
  .logi-ind-row input {
    flex:1; background:#122030; border:1px solid #2A4A6A; border-radius:7px;
    padding:9px 11px; color:#ECF0F1; font-family:'DM Sans',sans-serif; font-size:12px; outline:none;
  }
  .logi-ind-row input:focus { border-color:var(--accent); }
  .logi-ind-row input::placeholder { color:#4A6A85; opacity:.7; }
  .logi-btn-rm-ind {
    background:transparent; border:1px solid #2A4A6A; border-radius:6px;
    padding:9px; color:#85A7C5; font-size:11px; cursor:pointer; flex-shrink:0;
  }
  .logi-btn-rm-ind:hover { border-color:#E74C3C; color:#E74C3C; }
  .logi-btn-add-ind {
    background:transparent; border:1px dashed rgba(46,134,193,0.3);
    border-radius:7px; padding:7px 12px; color:var(--accent); font-size:11px;
    font-weight:500; cursor:pointer; width:100%; margin-top:6px;
  }
  .logi-btn-add-ind:hover { background:rgba(46,134,193,0.07); border-color:var(--accent); }
  .logi-btn-add-obj {
    background:transparent; border:1px dashed rgba(46,134,193,0.3);
    border-radius:9px; padding:11px; color:var(--accent); font-size:12px;
    font-weight:500; cursor:pointer; width:100%;
    display:flex; align-items:center; justify-content:center; gap:7px;
  }
  .logi-btn-add-obj:hover { background:rgba(46,134,193,0.07); border-color:var(--accent); }
  .logi-btn-add-obj:disabled { opacity:.3; cursor:not-allowed; }
  .logi-ind-hint { font-size:11px; color:#6C8EA8; font-style:italic; margin-top:5px; line-height:1.5; padding:7px 9px; background:rgba(255,255,255,.03); border-radius:5px; }
  .logi-btn-primary {
    background:var(--accent); border:none; border-radius:9px; padding:13px 26px;
    color:#fff; font-family:'DM Sans',sans-serif; font-size:14px; font-weight:700;
    cursor:pointer; width:100%; margin-top:8px; letter-spacing:.04em; transition:all .2s;
  }
  .logi-btn-primary:hover { background:#2778ab; transform:translateY(-1px); }

  .logi-choices { display:flex; flex-direction:column; gap:9px; }
  .logi-choice-btn {
    background:#122030; border:1px solid #2A4A6A; border-radius:11px;
    padding:14px 18px; text-align:left; cursor:pointer; transition:all .2s;
    display:flex; align-items:center; gap:13px; color:#ECF0F1;
    font-family:'DM Sans',sans-serif; font-size:13px; line-height:1.5;
  }
  .logi-choice-btn:hover { background:#16283A; border-color:var(--accent); transform:translateX(3px); }
  .logi-choice-icon {
    width:38px; height:38px; border-radius:9px; background:rgba(46,134,193,0.12);
    display:flex; align-items:center; justify-content:center; font-size:17px; flex-shrink:0;
  }
  .logi-choice-btn strong { display:block; font-weight:600; margin-bottom:2px; color:#ECF0F1; }
  .logi-choice-btn span { font-size:12px; color:#85A7C5; }

  .logi-obs-panel {
    background:rgba(46,134,193,0.04); border:1px solid rgba(46,134,193,0.18);
    border-radius:12px; padding:20px; margin-bottom:16px;
    animation:logiIn .3s cubic-bezier(.16,1,.3,1);
  }
  .logi-obs-title {
    font-size:10px; font-weight:700; letter-spacing:.2em; text-transform:uppercase;
    color:var(--accent); margin-bottom:14px;
    display:flex; align-items:center; gap:7px;
  }
  .logi-obs-example {
    background:rgba(0,0,0,.25); border-radius:7px; padding:10px 14px;
    margin-bottom:14px; border-left:3px solid var(--accent);
  }
  .logi-obs-example .ex-lbl { font-size:10px; font-weight:700; letter-spacing:.15em; text-transform:uppercase; color:var(--accent); margin-bottom:5px; }
  .logi-obs-example p { font-size:12px; color:#D0DCE8; line-height:1.6; margin:0; }
  .logi-check-list { display:flex; flex-direction:column; gap:7px; margin-bottom:14px; }
  .logi-check-item {
    display:flex; align-items:flex-start; gap:11px; padding:9px 13px;
    background:#0D1B2A; border:1px solid #1E3A55; border-radius:7px; cursor:pointer; transition:all .2s;
  }
  .logi-check-item:hover { border-color:var(--accent); background:rgba(46,134,193,0.05); }
  .logi-check-item input[type=checkbox] { width:15px; height:15px; accent-color:var(--accent); cursor:pointer; flex-shrink:0; margin-top:2px; }
  .logi-check-item label { font-size:12px; color:#D0DCE8; cursor:pointer; line-height:1.5; }
  .logi-check-item.checked { border-color:var(--teal); background:rgba(26,188,156,0.05); }
  .logi-check-item.checked label { color:var(--teal); }
  .logi-obs-free-lbl { font-size:11px; font-weight:600; letter-spacing:.1em; text-transform:uppercase; color:#85A7C5; margin-bottom:5px; display:block; }
  .logi-obs-free {
    width:100%; background:#122030; border:1.5px solid #2A4A6A; border-radius:7px;
    padding:10px 12px; color:#ECF0F1; font-family:'DM Sans',sans-serif; font-size:12px;
    outline:none; resize:vertical; min-height:60px; transition:border-color .2s;
  }
  .logi-obs-free:focus { border-color:var(--accent); }
  .logi-obs-free::placeholder { color:#4A6A85; opacity:.7; }

  .logi-yesno { display:grid; grid-template-columns:1fr 1fr; gap:11px; margin-top:14px; }
  .logi-btn-yes {
    background:rgba(26,188,156,0.1); border:1px solid rgba(26,188,156,0.3);
    border-radius:10px; padding:14px 18px; cursor:pointer; color:var(--teal);
    font-family:'DM Sans',sans-serif; font-weight:700; font-size:13px; transition:all .2s;
    display:flex; align-items:center; justify-content:center; gap:7px;
  }
  .logi-btn-yes:hover { background:rgba(26,188,156,0.2); transform:translateY(-2px); }
  .logi-btn-no {
    background:rgba(230,126,34,0.1); border:1px solid rgba(230,126,34,0.3);
    border-radius:10px; padding:14px 18px; cursor:pointer; color:var(--orange);
    font-family:'DM Sans',sans-serif; font-weight:700; font-size:13px; transition:all .2s;
    display:flex; align-items:center; justify-content:center; gap:7px;
  }
  .logi-btn-no:hover { background:rgba(230,126,34,0.2); transform:translateY(-2px); }

  .logi-nav-btns { display:flex; gap:11px; margin-top:18px; flex-wrap:wrap; }
  .logi-btn-back {
    background:transparent; border:1px solid #2A4A6A; border-radius:9px;
    padding:10px 18px; color:#85A7C5; font-family:'DM Sans',sans-serif; font-size:12px; cursor:pointer; transition:all .2s;
  }
  .logi-btn-back:hover { border-color:var(--accent); color:#ECF0F1; }
  .logi-btn-restart {
    background:rgba(46,134,193,0.1); border:1px solid rgba(46,134,193,0.3);
    border-radius:9px; padding:10px 18px; color:var(--accent);
    font-family:'DM Sans',sans-serif; font-size:12px; font-weight:700; cursor:pointer; transition:all .2s;
  }
  .logi-btn-restart:hover { background:rgba(46,134,193,0.2); transform:translateY(-1px); }

  .logi-breadcrumb { display:flex; align-items:center; gap:5px; flex-wrap:wrap; margin-bottom:16px; font-size:11px; color:#6C8EA8; }
  .logi-breadcrumb span { color:var(--accent); font-weight:500; }
  .logi-breadcrumb .sep { opacity:.4; }
  .logi-val-error { color:#E74C3C; font-size:12px; margin-top:7px; display:none; }

  /* Result */
  .logi-result-card { border-radius:14px; padding:28px; margin-bottom:16px; animation:logiIn .4s cubic-bezier(.16,1,.3,1); }
  .logi-result-header { display:flex; align-items:flex-start; gap:18px; margin-bottom:20px; }
  .logi-family-badge { width:52px; height:52px; border-radius:12px; background:rgba(0,0,0,.3); display:flex; align-items:center; justify-content:center; font-size:22px; flex-shrink:0; }
  .logi-family-label { font-size:10px; font-weight:700; letter-spacing:.15em; text-transform:uppercase; opacity:.7; }
  .logi-result-section { background:rgba(0,0,0,.2); border-radius:9px; padding:14px 18px; margin-bottom:10px; }
  .logi-result-section-title { font-size:10px; font-weight:700; letter-spacing:.2em; text-transform:uppercase; margin-bottom:7px; opacity:.6; }
  .logi-result-section p { font-size:13px; line-height:1.7; color:#ECF0F1; margin:0; }
  .logi-sep { height:1px; background:#1E3A55; margin:20px 0; }
  .logi-obj-box { border-radius:9px; padding:18px; margin-bottom:10px; border-left:3px solid currentColor; }
  .logi-obj-box-lbl { font-size:10px; font-weight:700; letter-spacing:.2em; text-transform:uppercase; margin-bottom:8px; }
  .logi-obj-box p { font-size:13px; line-height:1.7; margin:0; color:#ECF0F1; }

  /* Deep dive */
  .logi-deep { background:rgba(250,204,21,0.04); border:1px solid rgba(250,204,21,0.18); border-radius:12px; padding:22px; margin-bottom:16px; }
  .logi-deep h3 { font-size:11px; font-weight:700; letter-spacing:.2em; text-transform:uppercase; color:#F0C040; margin-bottom:5px; }
  .logi-deep .dd-desc { font-size:12px; color:#85A7C5; margin-bottom:14px; line-height:1.6; }
  .logi-deep-check { display:flex; flex-direction:column; gap:7px; margin-bottom:14px; }
  .logi-deep-item {
    display:flex; align-items:flex-start; gap:11px; padding:9px 13px;
    background:#0D1B2A; border:1px solid #1E3A55; border-radius:7px; cursor:pointer; transition:all .2s;
  }
  .logi-deep-item:hover { border-color:#F0C040; background:rgba(240,192,64,0.04); }
  .logi-deep-item input[type=checkbox] { width:15px; height:15px; accent-color:#F0C040; cursor:pointer; flex-shrink:0; margin-top:2px; }
  .logi-deep-item label { font-size:12px; color:#D0DCE8; cursor:pointer; line-height:1.5; }
  .logi-deep-item.checked { border-color:#F0C040; background:rgba(240,192,64,0.06); }
  .logi-deep-item.checked label { color:#F0C040; }

  /* Summary */
  .logi-summary { background:#0F2033; border:1px solid #1E3A55; border-radius:14px; padding:28px; margin-bottom:16px; }
  .logi-summary h3 { font-size:13px; font-weight:700; color:var(--accent); letter-spacing:.1em; text-transform:uppercase; margin-bottom:18px; padding-bottom:10px; border-bottom:1px solid #1E3A55; }
  .logi-sum-row { display:flex; justify-content:space-between; align-items:flex-start; padding:9px 0; border-bottom:1px solid rgba(255,255,255,.04); gap:14px; }
  .logi-sum-row:last-child { border-bottom:none; }
  .logi-sum-lbl { font-size:11px; color:#85A7C5; font-weight:500; min-width:150px; }
  .logi-sum-val { font-size:12px; color:#ECF0F1; text-align:right; flex:1; }
  .logi-sum-hl { background:rgba(46,134,193,0.06); border:1px solid rgba(46,134,193,0.15); border-radius:9px; padding:14px 18px; margin-top:10px; }
  .logi-sum-hl .sh-lbl { font-size:10px; font-weight:700; letter-spacing:.2em; text-transform:uppercase; color:var(--accent); margin-bottom:5px; }
  .logi-sum-hl p { font-size:12px; line-height:1.7; color:#ECF0F1; }
  .logi-obs-sum-block { background:rgba(0,0,0,.15); border-radius:7px; padding:10px 14px; margin-top:7px; }
  .logi-obs-sum-block .osb-lbl { font-size:10px; font-weight:700; letter-spacing:.15em; text-transform:uppercase; color:#6C8EA8; margin-bottom:5px; }
  .logi-obs-sum-block ul { list-style:none; padding:0; margin:0; }
  .logi-obs-sum-block li { font-size:11px; color:#85A7C5; padding:2px 0 2px 9px; border-left:2px solid rgba(46,134,193,0.3); margin-bottom:3px; }

  /* Revised objectives */
  .logi-revised { background:#0F2033; border:1px solid #1E3A55; border-radius:14px; padding:28px; margin-bottom:16px; }
  .logi-revised h3 { font-size:13px; font-weight:700; color:var(--teal); letter-spacing:.1em; text-transform:uppercase; margin-bottom:7px; padding-bottom:10px; border-bottom:1px solid #1E3A55; }
  .logi-revised .sec-desc { font-size:12px; color:#85A7C5; margin-bottom:18px; line-height:1.6; }
  .logi-rev-global { background:rgba(26,188,156,0.06); border:1px solid rgba(26,188,156,0.2); border-radius:9px; padding:14px 18px; margin-bottom:18px; }
  .logi-rev-global label { font-size:11px; font-weight:700; letter-spacing:.15em; text-transform:uppercase; color:var(--teal); display:block; margin-bottom:7px; }
  .logi-rev-global textarea { width:100%; background:#122030; border:1.5px solid rgba(26,188,156,0.2); border-radius:7px; padding:10px; color:#ECF0F1; font-family:'DM Sans',sans-serif; font-size:13px; outline:none; resize:vertical; min-height:50px; }
  .logi-rev-global textarea:focus { border-color:var(--teal); }
  .logi-rev-obj-item { background:rgba(26,188,156,0.04); border:1px solid rgba(26,188,156,0.15); border-radius:9px; padding:16px; margin-bottom:10px; }
  .logi-rev-obj-item label { font-size:11px; font-weight:700; letter-spacing:.1em; text-transform:uppercase; color:var(--teal); display:block; margin-bottom:7px; }
  .logi-rev-obj-item input { width:100%; background:#122030; border:1.5px solid rgba(26,188,156,0.2); border-radius:7px; padding:9px 11px; color:#ECF0F1; font-family:'DM Sans',sans-serif; font-size:12px; outline:none; margin-bottom:8px; }
  .logi-rev-obj-item input:focus { border-color:var(--teal); }
  .logi-rev-ind-row { display:flex; gap:7px; margin-bottom:5px; }
  .logi-rev-ind-row input { flex:1; background:#122030; border:1px solid #2A4A6A; border-radius:7px; padding:8px 10px; color:#ECF0F1; font-family:'DM Sans',sans-serif; font-size:11px; outline:none; }
  .logi-rev-ind-row input:focus { border-color:var(--teal); }
  .logi-btn-add-rev-ind { background:transparent; border:1px dashed rgba(26,188,156,0.25); border-radius:5px; padding:6px 11px; color:var(--teal); font-size:10px; cursor:pointer; margin-top:3px; }
  .logi-btn-add-rev-ind:hover { background:rgba(26,188,156,0.06); }
  .logi-action-btns { display:grid; grid-template-columns:1fr 1fr; gap:11px; margin-top:18px; }
  .logi-btn-print { background:rgba(26,188,156,0.1); border:1px solid rgba(26,188,156,0.3); border-radius:9px; padding:13px 18px; color:var(--teal); font-family:'DM Sans',sans-serif; font-size:12px; font-weight:700; cursor:pointer; transition:all .2s; display:flex; align-items:center; justify-content:center; gap:7px; }
  .logi-btn-print:hover { background:rgba(26,188,156,0.2); transform:translateY(-1px); }
  .logi-btn-copy-wrap { background:rgba(142,68,173,0.1); border:1px solid rgba(142,68,173,0.3); border-radius:9px; padding:13px 18px; color:var(--purple); font-family:'DM Sans',sans-serif; font-size:12px; font-weight:700; cursor:pointer; transition:all .2s; display:flex; align-items:center; justify-content:center; gap:7px; }
  .logi-btn-copy-wrap:hover { background:rgba(142,68,173,0.2); transform:translateY(-1px); }
  /* ‚îÄ‚îÄ Bouton transfert logigramme ‚Üí formulaire ‚îÄ‚îÄ */
  .logi-btn-transfer { display:block; width:100%; background:linear-gradient(135deg,#1A7A5E,#16A085); color:#fff; border:none; border-radius:12px; padding:18px 24px; font-size:15px; font-weight:700; cursor:pointer; margin-top:20px; transition:all .2s; text-align:center; }
  .logi-btn-transfer:hover { transform:translateY(-2px); box-shadow:0 6px 20px rgba(26,160,133,.35); }
  /* ‚îÄ‚îÄ Champs verrouill√©s (venant du logigramme) ‚îÄ‚îÄ */
  .field-locked { background:rgba(26,188,156,.06) !important; border-color:rgba(26,188,156,.25) !important; color:#B0C8C2 !important; cursor:not-allowed !important; }
  .field-locked-badge { font-size:9px; font-weight:700; letter-spacing:.1em; text-transform:uppercase; color:#1ABC9C; background:rgba(26,188,156,.12); border:1px solid rgba(26,188,156,.25); border-radius:4px; padding:2px 7px; margin-left:8px; }
  /* ‚îÄ‚îÄ Banni√®re logigramme obligatoire ‚îÄ‚îÄ */
  .logi-required-banner { background:rgba(231,76,60,.08); border:1px solid rgba(231,76,60,.25); border-radius:10px; padding:14px 18px; margin-bottom:20px; display:flex; align-items:center; gap:12px; }
  .logi-required-banner.done { background:rgba(26,188,156,.08); border-color:rgba(26,188,156,.25); }
  .logi-req-icon { font-size:22px; }
  .logi-req-text { flex:1; }
  .logi-req-text strong { display:block; font-size:13px; color:#E74C3C; }
  .logi-required-banner.done .logi-req-text strong { color:#1ABC9C; }
  .logi-req-text span { font-size:11px; color:#85A7C5; }
  .logi-req-goto { background:rgba(231,76,60,.15); border:1px solid rgba(231,76,60,.3); color:#E74C3C; border-radius:7px; padding:7px 14px; font-size:11px; font-weight:700; cursor:pointer; white-space:nowrap; transition:all .2s; }
  .logi-required-banner.done .logi-req-goto { background:rgba(26,188,156,.15); border-color:rgba(26,188,156,.3); color:#1ABC9C; }
  /* ‚îÄ‚îÄ R√©sum√© final soumission ‚îÄ‚îÄ */
  #form-summary { display:none; padding:24px 0; }
  .fsumm-wrap { background:var(--card); border:1px solid var(--border); border-radius:16px; overflow:hidden; max-width:820px; margin:0 auto; }
  .fsumm-header { background:linear-gradient(135deg,#1A7A5E,#16A085); padding:28px 32px; text-align:center; }
  .fsumm-header h2 { color:#fff; margin:0 0 6px; font-size:22px; }
  .fsumm-header p { color:rgba(255,255,255,.8); margin:0; font-size:13px; }
  .fsumm-section { padding:20px 28px; border-bottom:1px solid var(--border); }
  .fsumm-section:last-child { border-bottom:none; }
  .fsumm-section-title { font-size:10px; font-weight:700; letter-spacing:.2em; text-transform:uppercase; color:#6C8EA8; margin-bottom:14px; }
  .fsumm-row { display:flex; gap:10px; padding:8px 0; border-bottom:1px solid rgba(255,255,255,.04); }
  .fsumm-row:last-child { border-bottom:none; }
  .fsumm-lbl { font-size:11px; color:#6C8EA8; min-width:160px; flex-shrink:0; padding-top:1px; }
  .fsumm-val { font-size:12px; color:#B8D4E8; flex:1; white-space:pre-wrap; }
  .fsumm-obj-block { background:rgba(26,188,156,.05); border:1px solid rgba(26,188,156,.15); border-radius:8px; padding:13px 16px; margin-bottom:10px; }
  .fsumm-obj-title { font-size:11px; font-weight:700; color:#1ABC9C; margin-bottom:6px; }
  .fsumm-obj-desc { font-size:12px; color:#B8D4E8; margin-bottom:8px; }
  .fsumm-ind { font-size:11px; color:#85A7C5; padding:2px 0 2px 12px; border-left:2px solid rgba(26,188,156,.3); margin-bottom:3px; }
  .fsumm-actions { display:flex; gap:12px; padding:20px 28px; flex-wrap:wrap; }
  .fsumm-btn-print { background:rgba(52,152,219,.1); border:1px solid rgba(52,152,219,.3); color:var(--accent); border-radius:9px; padding:12px 20px; font-size:12px; font-weight:700; cursor:pointer; transition:all .2s; }
  .fsumm-btn-copy { background:rgba(26,188,156,.1); border:1px solid rgba(26,188,156,.3); color:#1ABC9C; border-radius:9px; padding:12px 20px; font-size:12px; font-weight:700; cursor:pointer; transition:all .2s; }
  .fsumm-btn-new { background:rgba(231,76,60,.1); border:1px solid rgba(231,76,60,.3); color:#E74C3C; border-radius:9px; padding:12px 20px; font-size:12px; font-weight:700; cursor:pointer; transition:all .2s; }
  .fsumm-copy-confirm { font-size:11px; color:#1ABC9C; padding:4px 28px; min-height:20px; }
  .logi-copy-confirm { text-align:center; font-size:12px; color:var(--teal); margin-top:8px; height:16px; }

  .logi-banner {
    background:rgba(46,134,193,0.07); border:1px solid rgba(46,134,193,0.2);
    border-radius:10px; padding:14px 18px; margin-bottom:20px;
    font-size:12px; color:#85A7C5; line-height:1.6;
    display:flex; align-items:flex-start; gap:10px;
  }
  .logi-banner strong { color:var(--accent); }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     √âCRAN DE CONNEXION SUPABASE
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  #login-screen {
    position:fixed; inset:0; background:var(--navy); z-index:200;
    display:flex; align-items:center; justify-content:center; padding:1rem;
  }
  #login-screen.hidden { display:none; }
  .login-card {
    background:#0F2033; border:1px solid #1E3A55; border-radius:16px;
    padding:2.5rem; width:100%; max-width:420px;
    box-shadow:0 20px 60px rgba(0,0,0,0.5);
  }
  .login-logo { font-size:2.5rem; text-align:center; margin-bottom:0.5rem; }
  .login-title { font-size:1.3rem; font-weight:700; text-align:center; margin-bottom:0.3rem; }
  .login-sub { font-size:0.85rem; color:#A9CCE3; text-align:center; margin-bottom:2rem; line-height:1.5; }
  .login-field { display:flex; flex-direction:column; gap:0.4rem; margin-bottom:1rem; }
  .login-field label { font-size:0.82rem; font-weight:600; color:#D6E8F5; }
  .login-field input {
    background:#122030; border:1.5px solid #2A4A6A; border-radius:8px;
    padding:0.7rem 1rem; color:#ECF0F1; font-size:0.92rem;
    font-family:'DM Sans',sans-serif; width:100%; transition:border-color 0.2s;
  }
  .login-field input:focus { outline:none; border-color:var(--accent); }
  .btn-login {
    width:100%; background:linear-gradient(135deg, var(--accent), var(--teal));
    border:none; color:white; padding:0.85rem; border-radius:10px;
    font-size:1rem; font-weight:700; cursor:pointer; margin-top:0.5rem;
    font-family:'DM Sans',sans-serif; transition:opacity 0.2s;
  }
  .btn-login:hover { opacity:0.9; }
  .btn-login:disabled { opacity:0.5; cursor:not-allowed; }
  .login-error {
    background:rgba(231,76,60,0.1); border:1px solid rgba(231,76,60,0.3);
    border-radius:8px; padding:0.7rem; color:#E74C3C; font-size:0.82rem;
    margin-bottom:1rem; display:none; text-align:center;
  }
  .login-toggle {
    text-align:center; margin-top:1rem; font-size:0.82rem; color:#A9CCE3;
  }
  .login-toggle button {
    background:none; border:none; color:var(--teal); cursor:pointer;
    font-size:0.82rem; font-weight:600; text-decoration:underline;
  }
  .login-role-badge {
    display:inline-block; padding:0.2rem 0.6rem; border-radius:12px;
    font-size:0.7rem; font-weight:700; margin-left:0.4rem;
  }
  .role-enseignant { background:rgba(46,134,193,0.2); color:var(--accent); border:1px solid rgba(46,134,193,0.4); }
  .role-etudiant { background:rgba(26,188,156,0.2); color:var(--teal); border:1px solid rgba(26,188,156,0.4); }
  /* Masquer l'onglet dashboard pour les √©tudiants */
  body.role-etudiant #tab-dashboard { display:none; }
  body.role-enseignant .etudiant-only { display:none !important; }
  /* Masquer l'onglet config pour tout le monde en prod */
  #tab-setup { display:none; }
  /* Notification de feedback pour l'√©tudiant */
  .feedback-banner {
    background:rgba(26,188,156,0.1); border:1px solid rgba(26,188,156,0.3);
    border-radius:10px; padding:1.2rem 1.5rem; margin-bottom:1.5rem; display:none;
  }
  .feedback-banner.visible { display:block; }
  .feedback-banner h4 { color:var(--teal); margin-bottom:0.4rem; font-size:0.95rem; }
  .feedback-banner p { color:#A9CCE3; font-size:0.85rem; line-height:1.5; }
  .feedback-note { font-size:1.5rem; font-weight:700; color:var(--teal); margin-bottom:0.3rem; }

</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     CONFIG BANNER ‚Äî √Ä REMPLIR UNE SEULE FOIS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     √âCRAN DE CONNEXION SUPABASE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="login-screen">
  <div class="login-card">
    <div class="login-logo">üèãÔ∏è</div>
    <div class="login-title">Analyse Vid√©o ‚Äî √âducation physique</div>
    <div class="login-sub">C√©gep de l'Abitibi-T√©miscamingue<br>Connecte-toi pour acc√©der √† l'application</div>
    <div class="login-error" id="login-error"></div>
    <div id="login-form-section">
      <div class="login-field">
        <label>Adresse courriel</label>
        <input type="email" id="login-email" placeholder="prenom.nom@cegepat.qc.ca" autocomplete="email" />
      </div>
      <div class="login-field">
        <label>Mot de passe</label>
        <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />
      </div>
      <button class="btn-login" id="btn-login" onclick="doLogin()">Se connecter</button>
      <div class="login-toggle">
        Pas encore de compte ? <button onclick="toggleRegister(true)">Cr√©er un compte</button>
      </div>
    </div>
    <div id="register-form-section" style="display:none">
      <div class="login-field">
        <label>Pr√©nom</label>
        <input type="text" id="reg-prenom" placeholder="Pr√©nom" />
      </div>
      <div class="login-field">
        <label>Nom</label>
        <input type="text" id="reg-nom" placeholder="Nom de famille" />
      </div>
      <div class="login-field">
        <label>Adresse courriel</label>
        <input type="email" id="reg-email" placeholder="prenom.nom@cegepat.qc.ca" autocomplete="email" />
      </div>
      <div class="login-field">
        <label>Mot de passe (min. 8 caract√®res)</label>
        <input type="password" id="reg-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="new-password" />
      </div>
      <button class="btn-login" id="btn-register" onclick="doRegister()">Cr√©er mon compte</button>
      <div class="login-toggle">
        D√©j√† un compte ? <button onclick="toggleRegister(false)">Se connecter</button>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     HEADER
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="app-header">
  <div class="app-header-top">
    <div class="app-title">Analyse vid√©o ‚Äî <span>√âducation physique</span></div>
    <div class="user-pill">
      <div class="user-dot"></div>
      <span id="user-display">Connexion...</span>
      <button onclick="doLogout()" title="Se d√©connecter" style="background:none;border:none;color:rgba(255,255,255,0.5);cursor:pointer;font-size:1rem;padding:0 0 0 8px;line-height:1;" onmouseover="this.style.color='#E74C3C'" onmouseout="this.style.color='rgba(255,255,255,0.5)'">‚èª</button>
    </div>
  </div>
  <div class="tabs">
    <button class="tab-btn active" onclick="showTab('logigramme',this)">üîç Logigramme</button>
    <button class="tab-btn etudiant-only" onclick="showTab('formulaire',this)">üìã Mon analyse</button>
    <button class="tab-btn etudiant-only" onclick="showTab('historique',this)" id="tab-historique-btn">üìö Mes d√©p√¥ts</button>
    <button class="tab-btn" onclick="showTab('dashboard',this)" id="tab-dashboard">üìä Tableau de bord</button>
    <button class="tab-btn" onclick="showTab('setup',this)" id="tab-setup">‚öôÔ∏è Mon compte</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB 1 ‚Äî FORMULAIRE √âTUDIANT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="formulaire" class="section">

  <div class="error-box" id="form-error"></div>

  <!-- Banni√®re feedback enseignant pour √©tudiant -->
  <div class="feedback-banner" id="feedback-banner">
    <h4>üì¨ Ton enseignant a corrig√© ta derni√®re analyse !</h4>
    <div class="feedback-note" id="feedback-note-val"></div>
    <p id="feedback-comment-val"></p>
  </div>

  <!-- R√©sum√© final apr√®s soumission -->
  <div id="form-summary">
    <div class="fsumm-wrap" id="fsumm-content">
      <div class="fsumm-header">
        <div style="font-size:44px;margin-bottom:10px">‚úÖ</div>
        <h2>Analyse soumise avec succ√®s !</h2>
        <p>Voici le r√©sum√© complet de ton analyse. Tu peux l'imprimer ou le copier.</p>
      </div>
      <div id="fsumm-body"></div>
      <div class="fsumm-actions">
        <button class="fsumm-btn-print" onclick="window.print()">üñ®Ô∏è Imprimer</button>
        <button class="fsumm-btn-copy" onclick="fsummCopy()">üìã Copier le texte</button>
        <button class="fsumm-btn-new" onclick="fsummReset()">‚Ü∫ Nouvelle analyse</button>
      </div>
      <div class="fsumm-copy-confirm" id="fsumm-copy-confirm"></div>
    </div>
  </div>

  <form id="analyse-form" onsubmit="submitForm(event)" novalidate>

    <!-- Banni√®re logigramme obligatoire -->
    <div class="logi-required-banner" id="logi-req-banner">
      <div class="logi-req-icon">üîç</div>
      <div class="logi-req-text">
        <strong>Logigramme obligatoire avant la soumission</strong>
        <span>Tu dois compl√©ter le logigramme d'identification pour pouvoir soumettre ton analyse.</span>
      </div>
      <button type="button" class="logi-req-goto" onclick="showTab('logigramme',document.querySelector('.tab-btn:nth-child(2)'))">Aller au logigramme ‚Üí</button>
    </div>

    <!-- Section A ‚Äî Informations -->
    <div class="form-card">
      <div class="form-section-header" style="background:rgba(46,134,193,0.15); color:var(--accent);">
        üîµ Section A ‚Äî Informations g√©n√©rales
      </div>
      <div class="form-body">
        <div class="fgrid3">
          <div class="fgroup">
            <label>Activit√© sportive <span class="req">*</span></label>
            <input type="text" id="f-activite" placeholder="Ex: Natation" />
          </div>
          <div class="fgroup">
            <label>Technique analys√©e <span class="req">*</span></label>
            <input type="text" id="f-technique" placeholder="Ex: Crawl ‚Äî Entr√©e de bras" />
          </div>
          <div class="fgroup">
            <label>Groupe <span class="req">*</span></label>
            <select id="f-groupe">
              <option value="">Choisir...</option>
              <option>Groupe 01</option>
              <option>Groupe 02</option>
              <option>Groupe 03</option>
              <option>Groupe 04</option>
            </select>
          </div>
        </div>
        <div class="fgrid2">
          <div class="fgroup">
            <label>Num√©ro de s√©ance <span class="req">*</span></label>
            <input type="text" id="f-seance" placeholder="Ex: S√©ance 3" />
          </div>
          <div class="fgroup">
            <label>Date</label>
            <input type="date" id="f-date" />
          </div>
        </div>
      </div>
    </div>

    <!-- Section A suite ‚Äî Famille d'erreurs -->
    <div class="form-card">
      <div class="form-section-header" style="background:rgba(46,134,193,0.15); color:var(--accent);">
        üîµ Section A (suite) ‚Äî Famille d'erreurs, objectifs et observations
      </div>
      <div class="form-body">
        <div class="fgroup">
          <label class="field-locked-label">Famille d'erreurs <span class="req">*</span><span class="field-locked-badge">üîí Du logigramme</span></label>
          <p class="hint">Coche UNE seule famille ‚Äî celle qui correspond le mieux √† l'erreur principale</p>
          <div class="radio-group" id="rg-famille">
            <label class="radio-item"><input type="radio" name="famille" value="F1 ‚Äî Rupture de la cha√Æne cin√©tique" /><div class="radio-item-body"><div class="radio-item-title">F1 ‚Äî Rupture de la cha√Æne cin√©tique</div><div class="radio-item-desc">La s√©quence corps ‚Üí bras ‚Üí jambes est d√©sordonn√©e ou incompl√®te</div></div></label>
            <label class="radio-item"><input type="radio" name="famille" value="F2 ‚Äî Mauvais transfert d'√©nergie" /><div class="radio-item-body"><div class="radio-item-title">F2 ‚Äî Mauvais transfert d'√©nergie</div><div class="radio-item-desc">L'√©nergie g√©n√©r√©e n'est pas transmise efficacement vers le geste final</div></div></label>
            <label class="radio-item"><input type="radio" name="famille" value="F3 ‚Äî D√©salignement segmentaire" /><div class="radio-item-body"><div class="radio-item-title">F3 ‚Äî D√©salignement segmentaire</div><div class="radio-item-desc">Un ou plusieurs segments corporels ne sont pas align√©s correctement</div></div></label>
            <label class="radio-item"><input type="radio" name="famille" value="F4 ‚Äî Manque de rel√¢chement musculaire" /><div class="radio-item-body"><div class="radio-item-title">F4 ‚Äî Manque de rel√¢chement musculaire</div><div class="radio-item-desc">La rigidit√© emp√™che la fluidit√© et l'√©conomie du mouvement</div></div></label>
            <label class="radio-item"><input type="radio" name="famille" value="F5 ‚Äî D√©ficit de contr√¥le de l'√©quilibre" /><div class="radio-item-body"><div class="radio-item-title">F5 ‚Äî D√©ficit de contr√¥le de l'√©quilibre</div><div class="radio-item-desc">Le centre de gravit√© n'est pas bien contr√¥l√© pendant l'action</div></div></label>
            <label class="radio-item"><input type="radio" name="famille" value="F6 ‚Äî Timing / synchronisation d√©ficiente" /><div class="radio-item-body"><div class="radio-item-title">F6 ‚Äî Timing / synchronisation d√©ficiente</div><div class="radio-item-desc">Les segments ne se coordonnent pas au bon moment</div></div></label>
          </div>
        </div>
        <div class="fgroup">
          <label class="field-locked-label">Objectif global <span class="req">*</span><span class="field-locked-badge">üîí Du logigramme</span></label>
          <textarea id="f-objectif" placeholder="D√©cris l'objectif principal de ton analyse..."></textarea>
        </div>
        <div class="fgroup">
          <label class="field-locked-label">Observations collect√©es <span class="req">*</span><span class="field-locked-badge">üîí Du logigramme</span></label>
          <p class="hint">Colle ici le r√©sum√© copi√© depuis l'outil GitHub, ou √©cris directement</p>
          <textarea id="f-observations" rows="5" placeholder="Tes observations sur le mouvement analys√©..."></textarea>
        </div>
        <div class="fgroup">
          <label class="field-locked-label">Objectifs r√©vis√©s <span class="req">*</span><span class="field-locked-badge">üîí Du logigramme</span></label>
          <textarea id="f-objectifs-rev" placeholder="Formule tes objectifs avec des indicateurs concrets et observables..."></textarea>
        </div>
      </div>
    </div>

    <!-- Section B ‚Äî Stades Newell -->
    <div class="form-card">
      <div class="form-section-header" style="background:rgba(142,68,173,0.15); color:var(--purple);">
        üü£ Section B ‚Äî Stades de ma√Ætrise (Bernstein, 1967 ; Vereijken et al., 1992 ; Button et al., 2020)
      </div>
      <div class="form-body">
        <div class="fgroup">
          <label>Mon stade AVANT la correction <span class="req">*</span></label>
          <div class="radio-group">
            <label class="radio-item"><input type="radio" name="stade-avant" value="Stade 1 ‚Äî Verrouillage (Gel moteur)" /><div class="radio-item-body"><div class="radio-item-title" style="color:var(--red)">‚ñ† Stade 1 ‚Äî Verrouillage <span style="font-size:10px;opacity:.7">(gel moteur)</span></div><div class="radio-item-desc">Je cherche comment bouger ‚Äî mes segments se rigidifient, le geste est produit en bloc</div></div></label>
            <label class="radio-item"><input type="radio" name="stade-avant" value="Stade 2 ‚Äî Exploration" /><div class="radio-item-body"><div class="radio-item-title" style="color:var(--orange)">‚óÜ Stade 2 ‚Äî Exploration <span style="font-size:10px;opacity:.7">(d√©gel, exploration coordinative)</span></div><div class="radio-item-desc">Je lib√®re progressivement mes segments ‚Äî les erreurs varient, certaines r√©p√©titions r√©ussissent</div></div></label>
            <label class="radio-item"><input type="radio" name="stade-avant" value="Stade 3 ‚Äî Exploitation" /><div class="radio-item-body"><div class="radio-item-title" style="color:var(--green)">‚óè Stade 3 ‚Äî Exploitation</div><div class="radio-item-desc">Mon geste est fluide, automatis√© ‚Äî j'utilise les forces m√©caniques de fa√ßon √©conomique</div></div></label>
          </div>
        </div>
        <div class="fgroup">
          <label>Justifie ton choix AVANT <span class="req">*</span></label>
          <textarea id="f-just-avant" placeholder="Qu'est-ce que tu observes dans ta vid√©o qui t'am√®ne √† ce stade ?"></textarea>
        </div>
        <div class="fgroup">
          <label>Mon stade APR√àS la correction <span class="req">*</span></label>
          <div class="radio-group">
            <label class="radio-item"><input type="radio" name="stade-apres" value="Stade 1 ‚Äî Verrouillage (Gel moteur)" /><div class="radio-item-body"><div class="radio-item-title" style="color:var(--red)">‚ñ† Stade 1 ‚Äî Verrouillage <span style="font-size:10px;opacity:.7">(gel moteur)</span></div><div class="radio-item-desc">Mes segments restent rigides ‚Äî le geste est encore produit en bloc malgr√© la correction</div></div></label>
            <label class="radio-item"><input type="radio" name="stade-apres" value="Stade 2 ‚Äî Exploration" /><div class="radio-item-body"><div class="radio-item-title" style="color:var(--orange)">‚óÜ Stade 2 ‚Äî Exploration <span style="font-size:10px;opacity:.7">(d√©gel, exploration coordinative)</span></div><div class="radio-item-desc">Mes erreurs commencent √† varier ‚Äî certaines r√©p√©titions s'am√©liorent, d'autres non</div></div></label>
            <label class="radio-item"><input type="radio" name="stade-apres" value="Stade 3 ‚Äî Exploitation" /><div class="radio-item-body"><div class="radio-item-title" style="color:var(--green)">‚óè Stade 3 ‚Äî Exploitation</div><div class="radio-item-desc">Mon geste est fluide, automatis√© ‚Äî je m'adapte au contexte et exploite les forces m√©caniques</div></div></label>
          </div>
        </div>
        <div class="fgroup">
          <label>Justifie ton choix APR√àS <span class="req">*</span></label>
          <textarea id="f-just-apres" placeholder="Qu'est-ce qui a chang√© ? Comment ta vid√©o finale le confirme-t-elle ?"></textarea>
        </div>
      </div>
    </div>

    <!-- Section C ‚Äî Vid√©os -->
    <div class="form-card">
      <div class="form-section-header" style="background:rgba(26,188,156,0.15); color:var(--teal);">
        üü¢ Section C ‚Äî Vid√©os YouTube
      </div>
      <div class="form-body">
        <div class="fgrid2">
          <div class="fgroup">
            <label>Vid√©o initiale ‚Äî AVANT <span class="req">*</span></label>
            <input type="url" id="f-vid-avant" placeholder="https://youtube.com/watch?v=..." />
          </div>
          <div class="fgroup">
            <label>Vid√©o finale ‚Äî APR√àS <span class="req">*</span></label>
            <input type="url" id="f-vid-apres" placeholder="https://youtube.com/watch?v=..." />
          </div>
        </div>
        <div class="fgrid3">
          <div class="fgroup">
            <label>√âducatif 1 <span class="req">*</span></label>
            <input type="url" id="f-edu1" placeholder="https://youtube.com/..." />
          </div>
          <div class="fgroup">
            <label>√âducatif 2 <span style="font-size:0.7rem;color:var(--gray)">(facultatif)</span></label>
            <input type="url" id="f-edu2" placeholder="https://youtube.com/..." />
          </div>
          <div class="fgroup">
            <label>√âducatif 3 <span style="font-size:0.7rem;color:var(--gray)">(facultatif)</span></label>
            <input type="url" id="f-edu3" placeholder="https://youtube.com/..." />
          </div>
        </div>
        <div class="fgroup">
          <label>Description des exercices √©ducatifs <span class="req">*</span></label>
          <textarea id="f-edu-desc" placeholder="Pour chaque √©ducatif : nom, lien avec la famille d'erreurs, ce que tu travailles, r√©sultat observ√©..." rows="5"></textarea>
        </div>
      </div>
    </div>

    <!-- Section D ‚Äî R√©flexion -->
    <div class="form-card">
      <div class="form-section-header" style="background:rgba(230,126,34,0.15); color:var(--orange);">
        üü† Section D ‚Äî R√©flexion personnelle
      </div>
      <div class="form-body">
        <div class="fgroup">
          <label>Q1 ‚Äî Qu'est-ce que tu as observ√© de plus surprenant dans ta vid√©o initiale ? <span class="req">*</span></label>
          <p class="hint">D√©cris ce que tu ne voyais pas sans la vid√©o ‚Äî ce que l'≈ìil nu ne captait pas</p>
          <textarea id="f-q1"></textarea>
        </div>
        <div class="fgroup">
          <label>Q2 ‚Äî Quel lien fais-tu entre la famille d'erreurs et tes sensations pendant l'action ? <span class="req">*</span></label>
          <p class="hint">Ressentais-tu ce probl√®me dans ton corps sans le voir ? Comment l'as-tu d√©couvert ?</p>
          <textarea id="f-q2"></textarea>
        </div>
        <div class="fgroup">
          <label>Q3 ‚Äî Justifie ton identification au stade de ma√Ætrise ‚Äî AVANT et APR√àS <span class="req">*</span></label>
          <p class="hint">Pourquoi ce stade avant ? Quels indices dans ta vid√©o (gel moteur, exploration coordinative, exploitation) justifient ton choix ?</p>
          <textarea id="f-q3"></textarea>
        </div>
        <div class="fgroup">
          <label>Q4 ‚Äî En quoi tes exercices √©ducatifs ont-ils contribu√© √† atteindre ton objectif ? <span class="req">*</span></label>
          <p class="hint">Quel √©ducatif a eu le plus d'impact ? Pourquoi ? Comment le sais-tu concr√®tement ?</p>
          <textarea id="f-q4"></textarea>
        </div>
        <div class="fgrid2">
          <div class="fgroup">
            <label>Ce que je vais travailler √† l'entra√Ænement <span class="req">*</span></label>
            <textarea id="f-plan-avant" placeholder="Ex: Je vais me concentrer sur le rel√¢chement du poignet lors de mes 3 premiers sets..."></textarea>
          </div>
          <div class="fgroup">
            <label>Ce que je vais filmer et observer <span class="req">*</span></label>
            <textarea id="f-plan-apres" placeholder="Ex: Je vais filmer mon geste de profil √† la 3e s√©rie pour comparer avec la vid√©o initiale..."></textarea>
          </div>
        </div>
      </div>
    </div>

    <div style="display:flex;gap:1rem;flex-wrap:wrap;align-items:center;">
      <button type="submit" class="btn-submit" id="btn-submit" style="flex:1;min-width:200px;">
        Soumettre mon analyse
    </button>
      <button type="button" id="btn-brouillon" onclick="saveBrouillon()" style="background:rgba(255,255,255,0.07);border:1px solid rgba(255,255,255,0.15);color:rgba(255,255,255,0.6);border-radius:12px;padding:0 1.5rem;cursor:pointer;font-family:inherit;font-size:0.9rem;white-space:nowrap;transition:all .2s;" onmouseover="this.style.background='rgba(255,255,255,0.12)'" onmouseout="this.style.background='rgba(255,255,255,0.07)'">
        üíæ Compl√©ter plus tard
      </button>
    </div>

  </form>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB 2 ‚Äî LOGIGRAMME (identique √† l'outil GitHub, int√©gr√©)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="historique" class="section">
  <div style="max-width:900px;margin:0 auto;padding:1.5rem 1rem;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;">
      <h2 style="color:var(--accent);margin:0;font-size:1.3rem;">üìö Mes d√©p√¥ts d'analyses</h2>
      <button class="btn-refresh" onclick="loadStudentHistory()">üîÑ Rafra√Æchir</button>
    </div>
    <div id="historique-list">
      <div class="loading"><div class="spinner"></div> Chargement...</div>
    </div>
  </div>
</div>

<div id="logigramme" class="section active">
  <div class="logi-wrap">
    <div class="logi-banner">
      <span>üîç</span>
      <div><strong>Logigramme d'identification des familles d'erreurs</strong><br>
      Utilise cet outil <em>avant</em> de remplir ton analyse. Il d√©tecte automatiquement ta famille d'erreurs selon ton sport et g√©n√®re un r√©sum√© √† copier dans le formulaire.</div>
    </div>
    <div class="logi-progress" id="logi-progress-bar">
      <div class="logi-dot active"></div><div class="logi-dot"></div>
      <div class="logi-dot"></div><div class="logi-dot"></div>
      <div class="logi-dot"></div><div class="logi-dot"></div>
      <div class="logi-dot"></div>
    </div>
    <div id="logi-tree"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB 3 ‚Äî TABLEAU DE BORD ENSEIGNANT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="dashboard" class="section">

  <div class="error-box" id="dash-error"></div>

  <div class="filters">
    <input type="text" class="filter-select" id="filter-etudiant" placeholder="üîç Nom √©tudiant..." oninput="applyFilters()" style="max-width:180px;" />
    <select class="filter-select" id="filter-groupe" onchange="applyFilters()">
      <option value="">Tous les groupes</option>
      <option>Groupe 01</option><option>Groupe 02</option>
      <option>Groupe 03</option><option>Groupe 04</option>
    </select>
    <select class="filter-select" id="filter-statut" onchange="applyFilters()">
      <option value="">Tous les statuts</option>
      <option>En attente</option><option>Corrig√©</option><option>Brouillon</option>
    </select>
    <select class="filter-select" id="filter-famille" onchange="applyFilters()">
      <option value="">Toutes les familles</option>
      <option>F1</option><option>F2</option><option>F3</option>
      <option>F4</option><option>F5</option><option>F6</option>
    </select>
    <button class="btn-refresh" onclick="loadDashboard()">
      <span id="refresh-icon">üîÑ</span> Rafra√Æchir
    </button>
  </div>

  <!-- KPIs -->
  <div class="kpi-grid" id="kpi-grid">
    <div class="loading"><div class="spinner"></div> Chargement...</div>
  </div>

  <!-- Charts -->
  <div class="charts-grid" id="charts-grid" style="display:none">
    <div class="chart-card">
      <div class="chart-title">üìä Familles d'erreurs ‚Äî Distribution</div>
      <div class="bar-chart" id="chart-familles"></div>
    </div>
    <div class="chart-card">
      <div class="chart-title">üéØ Progression stades Newell</div>
      <div>
        <div style="font-size:0.72rem;color:#A9CCE3;font-weight:600;margin-bottom:0.4rem">AVANT</div>
        <div class="donut-wrap">
          <svg id="donut-avant" width="90" height="90" viewBox="0 0 36 36" style="flex-shrink:0"></svg>
          <div class="donut-legend" id="legend-avant"></div>
        </div>
        <div style="font-size:0.72rem;color:#A9CCE3;font-weight:600;margin-bottom:0.4rem;margin-top:0.6rem">APR√àS</div>
        <div class="donut-wrap">
          <svg id="donut-apres" width="90" height="90" viewBox="0 0 36 36" style="flex-shrink:0"></svg>
          <div class="donut-legend" id="legend-apres"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Table -->
  <div style="font-size:0.75rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:#A9CCE3;margin-bottom:0.6rem;">
    üìã Analyses ‚Äî cliquer pour corriger
  </div>
  <div class="table-wrap">
    <div class="table-header">
      <div>√âtudiant</div><div>Famille</div>
      <div>Stade AVANT</div><div>Stade APR√àS</div>
      <div>Note</div><div>Statut</div><div>Vid√©os</div>
    </div>
    <div id="table-body">
      <div class="loading" style="padding:1.5rem"><div class="spinner"></div> Chargement depuis Supabase...</div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     TAB 3 ‚Äî CONFIGURATION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="setup" class="section">
  <div class="setup-card">
    <div class="setup-title">‚öôÔ∏è Mon compte</div>
    <div class="setup-sub">
      Informations de connexion et gestion du compte.
      L'application est h√©berg√©e sur <strong>Supabase</strong> ‚Äî conforme √† la Loi 25 du Qu√©bec.
    </div>
    <div id="account-info" style="background:rgba(46,134,193,0.08);border:1px solid rgba(46,134,193,0.2);border-radius:10px;padding:1.2rem;margin-bottom:1.5rem">
      <div style="font-size:0.75rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--accent);margin-bottom:0.8rem">Compte connect√©</div>
      <div id="account-email" style="color:#ECF0F1;font-size:0.9rem;margin-bottom:0.4rem"></div>
      <div id="account-role" style="margin-top:0.3rem"></div>
    </div>
    <button class="btn-setup" onclick="doLogout()" style="background:rgba(231,76,60,0.2);border:1px solid rgba(231,76,60,0.4);color:#E74C3C;width:auto;padding:0.6rem 1.5rem">
      üö™ Se d√©connecter
    </button>
    <div style="margin-top:2rem;padding:1rem;background:rgba(255,255,255,0.03);border-radius:8px;font-size:0.8rem;color:#6C8EA8;line-height:1.7">
      <strong style="color:#A9CCE3">Conformit√© Loi 25 (Qu√©bec) :</strong><br>
      ‚Ä¢ Donn√©es h√©berg√©es sur Supabase (serveurs au Canada/√âtats-Unis)<br>
      ‚Ä¢ Chaque √©tudiant acc√®de uniquement √† ses propres donn√©es (Row Level Security)<br>
      ‚Ä¢ Les vid√©os sont stock√©es dans des buckets priv√©s Supabase Storage<br>
      ‚Ä¢ Aucune donn√©e n'est partag√©e avec des tiers sans consentement<br>
      ‚Ä¢ Les mots de passe sont chiffr√©s et jamais stock√©s en clair
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MODAL CORRECTION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="modal-overlay" id="modal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="modal-title">Correction</div>
      <button class="modal-close" onclick="closeModal()">‚úï</button>
    </div>
    <div id="modal-content"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     Supabase JS SDK
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.js"></script>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     LOGIGRAMME ‚Äî JavaScript complet (adapt√© du GitHub)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   LOGIGRAMME ‚Äî Variables globales
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
var logi = {
  studentInfo:{}, navHistory:[], breadcrumbTrail:[],
  currentStep:'ident', detectedFamily:null, stepObservations:{},
  objCount:0, indCounters:{}, revObjCount:0, revIndCounters:{}
};

// ‚îÄ‚îÄ D√©tection du sport ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function logiDetectActivity(s){
  s=(s||'').toLowerCase();
  // ‚îÄ‚îÄ Ski : sous-disciplines d'abord (avant le test g√©n√©rique "ski") ‚îÄ‚îÄ
  if(/ski.de.fond|ski.nordique|fond|nordique|skating.ski|classique.ski|biathlon/.test(s)) return 'ski_fond';
  if(/ski.acrobat|acrobat|mogul|bosse|halfpipe|aerials|saut.ski|ski.saut/.test(s)) return 'ski_acrobatique';
  if(/freeride|hors.piste|powder|big.mountain|randonn.e.ski|ski.alpinisme/.test(s)) return 'ski_freeride';
  if(/ski.alpin|slalom|g.ant|descente|carving|ski/.test(s)) return 'ski'; // ski alpin = d√©faut
  if(/snowboard|glisse/.test(s)) return 'ski';
  // ‚îÄ‚îÄ Gym : sous-disciplines d'abord (avant le test g√©n√©rique "gym") ‚îÄ‚îÄ
  if(/gym.rythmique|rythmique|ruban|massue|cerceau.gym|gym.engin/.test(s)) return 'gym_rythmique';
  if(/gym.acrobat|acrobatique.gym|port.|voltige|pyramide|base.gym|voltigeur/.test(s)) return 'gym_acrobatique';
  if(/gym.artistique|artistique|poutre|barre.fixe|barres.asym|cheval.saut|anneaux|sol.gym/.test(s)) return 'gym_artistique';
  if(/gymn|trampoline/.test(s)) return 'gym_artistique'; // gym g√©n√©rique ‚Üí artistique
  // ‚îÄ‚îÄ Autres sports ‚îÄ‚îÄ
  if(/natation|crawl|nage|brasse|papillon|dos.crawl/.test(s)) return 'natation';
  if(/basket|basketball/.test(s)) return 'basket';
  if(/tennis|badminton|squash|raquette/.test(s)) return 'raquette';
  if(/soccer|football|foot/.test(s)) return 'soccer';
  if(/yoga|pilates/.test(s)) return 'yoga';
  if(/course|sprint|jogging|athl|marathon|demi.fond/.test(s)) return 'course';
  if(/art.martial|judo|ka[rk]at|ta.kwondo|boxe|lutte|mma|jiujitsu|jiu.jitsu|kung.fu|krav|aikido/.test(s)) return 'martial';
  if(/volley/.test(s)) return 'volley';
  if(/hockey/.test(s)) return 'hockey';
  if(/golf/.test(s)) return 'golf';
  if(/cycl|velo|vtt|triathlon/.test(s)) return 'cyclisme';
  if(/danse|contemporain|hip.hop|ballet|salsa|jazz/.test(s)) return 'danse';
  if(/escalade|grimpe|bloc/.test(s)) return 'escalade';
  if(/aviron|canot|kayak|pagaie/.test(s)) return 'aviron';
  if(/baseball|softball/.test(s)) return 'baseball';
  if(/rugby|ultimate|frisbee/.test(s)) return 'rugby';
  if(/acrobat/.test(s)) return 'gym_acrobatique'; // acrobatie g√©n√©rique
  return 'general';
}
// Combine activit√© + technique pour la d√©tection
function logiActKey(){
  var combined=(logi.studentInfo.activite||'')+' '+(logi.studentInfo.technique||'');
  return logiDetectActivity(combined);
}

// ‚îÄ‚îÄ Donn√©es d'observation par √©tape et par sport ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
var LOGI_OBS = {
  posture:{
    natation:["Mon corps est horizontal et align√© en surface (pas de jambes qui tombent)","Ma t√™te est dans le prolongement de la colonne, regard vers le bas","Mes √©paules sont basses et d√©tendues (pas contract√©es vers les oreilles)","Mon bassin est √† la surface ou l√©g√®rement sous la surface","Mon corps ne pivote pas excessivement avant le d√©but du mouvement de bras"],
    basket:["Mes pieds sont √† largeur d'√©paules ou l√©g√®rement plus larges","Mes genoux sont fl√©chis (position athl√©tique)","Mon poids est sur l'avant du pied (pas sur les talons)","Mon tronc est l√©g√®rement pench√© vers l'avant","Mon regard est dirig√© vers la cible avant de d√©clencher le geste"],
    raquette:["Je suis en position d'attente (genoux fl√©chis, pieds actifs, poids √©quilibr√©)","Ma raquette est tenue devant moi, bras d√©contract√©","Mon centre de gravit√© est bas pour permettre une r√©action rapide","Mes √©paules sont d√©contract√©es et non contract√©es","Mon regard suit la trajectoire de l'objet d√®s sa sortie"],
    soccer:["Mon poids est √©quilibr√© sur les deux appuis avant le geste","Mes genoux sont l√©g√®rement fl√©chis, corps en position athl√©tique","Mon tronc est orient√© dans la bonne direction selon l'action","Mon pied d'appui est positionn√© √† c√¥t√© du ballon (ni trop pr√®s ni trop loin)","Mes √©paules sont orient√©es vers la cible"],
    yoga:["Mon bassin est en position neutre (ni bascul√© en avant ni en arri√®re)","Ma colonne est dans son alignement naturel (courbes respect√©es)","Mes √©paules sont √©loign√©es des oreilles","Mon poids est √©quilibr√© sur mes appuis (pieds ou mains)","Mes articulations sont align√©es (cheville-genou-hanche ou poignet-coude-√©paule)"],
    course:["Mon tronc est l√©g√®rement inclin√© vers l'avant (pas droit ni courb√©)","Mon regard est dirig√© devant, pas vers le sol","Mes √©paules sont basses et d√©contract√©es","Mes bras sont fl√©chis √† environ 90¬∞","Mes pieds attaquent le sol sous mon centre de gravit√©"],
    ski:["Mes genoux sont fl√©chis et orient√©s vers l'avant des skis","Mon poids est centr√© sur le milieu du pied (ni talon ni pointe)","Mon tronc est inclin√© vers l'avant, face √† la pente","Mes b√¢tons sont tenus en avant du corps, coudes fl√©chis","Ma t√™te est relev√©e, regard vers le bas de la pente"],
    martial:["Ma garde est adapt√©e √† la discipline (pieds √† la bonne largeur, poids r√©parti)","Mon centre de gravit√© est bas (flexion des genoux)","Mes poings ou avant-bras prot√®gent mon centre sans me bloquer","Mon tronc est l√©g√®rement pivot√© pour prot√©ger la ligne centrale","Mon regard est sur l'adversaire, pas sur ses membres"],
    volley:["Mon poids est sur l'avant du pied, genoux fl√©chis avant chaque action","Mes bras sont devant moi, coudes l√©g√®rement fl√©chis en attente","Mon regard est sur le ballon d√®s son envol","Mon centre de gravit√© est bas pour permettre les d√©placements rapides","Mon tronc est droit et stable avant la frappe"],
    hockey:["Mes genoux sont fl√©chis, poids l√©g√®rement sur l'avant des patins","Mon b√¢ton est en position basse devant moi","Mon tronc est inclin√© vers l'avant, dos plat (pas arrondi)","Mon regard est sur la rondelle ou l'espace de jeu","Mon poids est centr√© sur les deux patins avant l'action"],
    golf:["Mes pieds sont √† largeur d'√©paules, orteils l√©g√®rement vers l'ext√©rieur","Mes genoux sont l√©g√®rement fl√©chis (ni raides ni trop pli√©s)","Mon dos est droit et inclin√© vers la balle (flexion depuis les hanches)","Mon poids est √©quilibr√© sur les deux pieds, au milieu du pied","Mes bras tombent naturellement, les mains sous les √©paules"],
    cyclisme:["Mon dos est plat (pas arrondi) en position de p√©dalage","Mes √©paules sont d√©contract√©es, coudes l√©g√®rement fl√©chis","Ma position sur la selle permet une l√©g√®re flexion du genou en bas de p√©dale","Ma t√™te est dans le prolongement de la colonne (pas trop lev√©e)","Mon bassin est stable sur la selle (pas de balancement lat√©ral)"],
    danse:["Mon axe central est vertical, cr√¢ne dans le prolongement de la colonne","Mes √©paules sont basses et ouvertes (pas rentr√©es)","Mon bassin est en position neutre","Mon poids est sur l'avant du pied selon le style","Mon regard est orient√© selon la chor√©graphie (pas vers le sol par d√©faut)"],
    escalade:["Mes hanches sont proches du mur (pas de fesses en arri√®re)","Mon poids est sur mes pieds (pas enti√®rement dans mes bras)","Mes bras sont l√©g√®rement fl√©chis (pas compl√®tement tendus en permanence)","Mon regard anticipe les prises suivantes, pas seulement la prise actuelle","Mon corps est stable avant chaque mouvement de main"],
    aviron:["Mon dos est droit en phase de catch (entr√©e de rame dans l'eau)","Ma compression est compl√®te (genoux fl√©chis, corps l√©g√®rement en avant)","Mes √©paules sont basses, bras tendus avant la prise","Mon regard est vers l'avant de l'embarcation","Mon poids est centr√© sur les appuie-pieds"],
    baseball:["Mes pieds sont √† largeur d'√©paules, genoux fl√©chis en position d'attente","Mon poids est sur l'arri√®re du pied (pied pivot) avant le swing","Ma batte est en position haute, coudes actifs","Mon regard est sur le lanceur d√®s sa pr√©paration","Mon tronc est orient√© vers le receveur (pas encore ouvert)"],
    rugby:["Mon centre de gravit√© est bas avant le contact (genoux fl√©chis)","Mon dos est droit dans les actions de contact","Mon regard est sur la cible ou l'espace avant l'action","Mon poids est √©quilibr√© avant le d√©part ou la r√©ception","Mes √©paules sont orient√©es dans la direction de l'action"],
    general:["Mon centre de gravit√© est bas et stable avant le d√©but du mouvement","Mon poids est √©quilibr√© sur mes appuis","Mon bassin est en position neutre (ni bascul√© ni bloqu√©)","Mes √©paules sont d√©contract√©es et align√©es","Mon regard est orient√© vers la cible ou la direction de l'action"],
    ski_fond:["Mon tronc est inclin√© vers l'avant depuis les hanches (pas le dos arrondi)","Mes genoux sont l√©g√®rement fl√©chis, poids sur l'avant du pied","Mes bras sont en opposition naturelle avec les jambes (bras gauche / jambe droite)","Mes b√¢tons sont tenus en avant, coudes fl√©chis √† environ 90¬∞","Mon regard est dirig√© vers l'avant de la piste, pas vers mes skis"],
    ski_acrobatique:["Mes genoux sont profond√©ment fl√©chis, pr√™ts √† absorber l'impact des bosses","Mon tronc est droit et stable (pas affaiss√©), regard vers le bas de la pente","Mes b√¢tons sont tenus l√©g√®rement en avant, coudes actifs","Mon poids est r√©parti √©quitablement, pr√™t √† s'adapter √† chaque bosse","Mes √©paules sont orient√©es vers le bas de la piste quelle que soit la direction des skis"],
    ski_freeride:["Mon centre de gravit√© est bas et centr√©, pr√™t √† s'adapter au terrain variable","Mes genoux sont flexibles et actifs (pas verrouill√©s)","Mon regard scrute le terrain en avance pour anticiper les changements","Mon poids est l√©g√®rement en arri√®re sur les skis (pour les neiges profondes)","Mes √©paules restent orient√©es vers le bas de la pente malgr√© les irr√©gularit√©s"],
    gym_artistique:["Mon corps est en gainage actif ‚Äî abdominaux engag√©s, fessiers contract√©s","Mes √©paules sont actives et √©loign√©es des oreilles (pas passives)","Mon alignement t√™te-√©paules-hanches-pieds est visible avant chaque √©l√©ment","Mes orteils sont point√©s dans les positions de tenue","Mon regard est fixe sur un point de rep√®re (√©vite le vertige, maintient l'axe)"],
    gym_rythmique:["Mon axe vertical est parfait ‚Äî t√™te, √©paules, hanches et pieds align√©s","Mes √©paules sont basses et ouvertes, bras expressifs m√™me au repos","Mes pieds sont en positions classiques (premi√®re, troisi√®me ou cinqui√®me position)","Mon regard est expressif et orient√© selon la chor√©graphie","Mon corps est en extension l√©g√®re ‚Äî pas d'affaissement ni de rigidit√© excessive"],
    gym_acrobatique:["Le porteur : pieds √©cart√©s, genoux fl√©chis, dos plat ‚Äî base stable et ancr√©e au sol","Le voltigeur : corps en gainage actif avant chaque √©l√©ment","Les deux : regard coordonn√© ‚Äî le porteur regarde le voltigeur, le voltigeur regarde devant","Le porteur : centre de gravit√© bas pour maximiser la stabilit√©","Le voltigeur : position de d√©part compacte ou en extension selon l'√©l√©ment"]
  },
  chaine:{
    natation:["La rotation du tronc initie chaque coup de bras (le corps pivote avant le bras)","Mon √©paule entre en premier dans l'eau, pas ma main √† plat","Mon bras entre dans l'axe (ni trop √† l'int√©rieur ni trop √† l'ext√©rieur)","Mon coude reste √©lev√© pendant la traction sous l'eau","La pouss√©e se termine jusqu'√† la cuisse avant la sortie du bras"],
    basket:["Le mouvement commence par une flexion/extension des jambes","L'√©nergie monte des jambes vers le tronc puis vers le bras","Mon coude est align√© sous le ballon pendant la mont√©e","Ma main guide quitte le ballon avant le rel√¢ch√© (ne pousse pas)","Mon poignet s'incline vers l'avant en fin de geste (effet de fouet)"],
    raquette:["La rotation des hanches pr√©c√®de la rotation des √©paules","La rotation des √©paules pr√©c√®de le mouvement du bras","Le bras et la raquette arrivent en dernier dans la cha√Æne","Mon coude m√®ne la raquette en phase de pr√©paration","La finition du geste se prolonge apr√®s le contact"],
    soccer:["Ma jambe d'appui est stable et plant√©e avant le coup de pied","Le mouvement commence par la hanche (pas seulement le genou)","Mon tronc se tourne vers la cible pour ajouter de la force","Mon pied frappe avec la bonne surface (coup√© = int√©rieur, puis√© = cou-de-pied)","Mon geste se prolonge vers la cible apr√®s le contact"],
    yoga:["L'initiation du mouvement part du centre (bassin/tronc) vers la p√©riph√©rie","Les articulations distales (mains, pieds) s'engagent apr√®s le centre","Ma respiration accompagne le mouvement (expiration sur l'effort)","Aucun segment ne se verrouille avant que le segment central soit stabilis√©","La transition entre deux postures passe par une position interm√©diaire contr√¥l√©e"],
    course:["Ma foul√©e est initi√©e par la hanche (pas seulement la jambe)","Mon bras balan√ßoir est coordonn√© avec la jambe oppos√©e","Ma cheville se stabilise au moment de l'appui (propulsion efficace)","Mon talon monte vers les fesses en phase de r√©cup√©ration (pas de tra√Ænage)","Mon tronc reste stable sans rotation excessive des √©paules"],
    ski:["La rotation d√©bute par les hanches/bassin avant les genoux","Les genoux guident la direction des skis","Mes bras restent devant comme balan√ßoir (pas de rotation des √©paules)","La prise de carre est initi√©e par la cheville avant le genou","Mon poids se transf√®re d'un ski √† l'autre de fa√ßon fluide"],
    martial:["La frappe ou le d√©placement part du bassin/hanches (koshi/hara)","L'√©paule et le bras arrivent en dernier dans la cha√Æne de frappe","Mon appui au sol est ferme au moment de l'impact","Le d√©placement de jambes pr√©c√®de la technique de bras","L'√©nergie est rel√¢ch√©e au point d'impact, pas avant"],
    volley:["La frappe (smash) part de la rotation des √©paules avant le bras","Mon bras de frappe arrive en dernier apr√®s le balancement du tronc","La manchette engage les jambes et le tronc, pas seulement les bras","Mon impulsion au saut vient des jambes avant les bras","La passe haute part des doigts en dernier dans la cha√Æne"],
    hockey:["Le tir part de la rotation des hanches avant les √©paules","Le transfert de poids (pied arri√®re vers avant) pr√©c√®de le tir","Mes √©paules tournent avant que le b√¢ton n'acc√©l√®re","Le claquement de poignet arrive en tout dernier (effet de fouet)","Mon tronc s'ouvre vers la cible avant la fin du geste"],
    golf:["Le down-swing s'initie par la rotation des hanches (pas les √©paules)","Les √©paules suivent les hanches, les bras suivent les √©paules","Le club arrive en dernier dans la cha√Æne (acc√©l√©ration maximale √† l'impact)","Mon poids se transf√®re du pied arri√®re au pied avant pendant le swing","Le back-swing monte de fa√ßon contr√¥l√©e depuis les √©paules"],
    cyclisme:["La puissance vient de l'extension compl√®te de la hanche avant le genou","Mon genou pousse vers le bas en coordination avec la hanche","La cheville accompagne (flexion/extension) le mouvement de p√©dale","Mon tronc reste stable et ne compense pas le mouvement des jambes","Les deux jambes travaillent en opposition coordonn√©e"],
    danse:["Le mouvement s'initie depuis le centre (bassin/plexus) selon le style","Les membres s'engagent apr√®s le centre (bras et jambes en dernier)","Chaque segment prolonge l'√©nergie du segment pr√©c√©dent","La t√™te et le regard arrivent en dernier dans les turns","Aucun segment ne se ferme avant que le suivant soit engag√©"],
    escalade:["Le mouvement de main vient apr√®s la stabilisation des pieds et des hanches","La pouss√©e vient des jambes (pas uniquement du tirage des bras)","La rotation des hanches permet d'atteindre les prises √©loign√©es","L'√©nergie remonte du pied d'appui vers la main qui saisit","Le corps se rapproche du mur par la hanche avant le bras"],
    aviron:["La pouss√©e commence par l'extension des jambes (pas le d√©bascul du dos)","Le dos bascule en arri√®re apr√®s l'extension des jambes","Les bras tirent en dernier dans la cha√Æne","La r√©cup√©ration suit l'ordre inverse : bras, dos, jambes","Chaque phase est compl√®te avant la suivante"],
    baseball:["Le swing s'initie par la rotation des hanches (pas les √©paules)","Le transfert de poids (pied arri√®re vers avant) d√©clenche la cha√Æne","Les bras et la batte arrivent en dernier (acc√©l√©ration maximale √† l'impact)","Les √©paules suivent les hanches avec un l√©ger d√©calage","Le poignet claque en dernier lieu au moment du contact"],
    rugby:["Le pass vient de la rotation du tronc, les bras amplifient","Le plaquage part des jambes et des hanches avant les √©paules","Le coup de pied suit la cha√Æne hanche-genou-pied","L'√©lan du corps soutient chaque geste de bras","Le pas de course engage les hanches avant les √©paules"],
    general:["Le mouvement est initi√© par le tronc ou le bassin, pas par les membres","L'√©nergie se propage segment par segment (proximal vers distal)","Les membres sup√©rieurs ou inf√©rieurs arrivent en dernier dans la cha√Æne","Aucun segment ne se verrouille trop t√¥t et ne bloque la propagation","Le geste se prolonge naturellement apr√®s le point d'action"],
    ski_fond:["La pouss√©e commence par l'extension compl√®te de la jambe arri√®re (jusqu'√† la pointe du pied)","Le b√¢ton est plant√© au niveau du pied avant, l'√©paule tire ensuite","Le tronc initie la rotation vers l'avant avant que le bras ne pousse","La jambe de glisse absorbe le transfert de poids sans fl√©chir excessivement","Le balancement des bras et des jambes est strictement en opposition altern√©e"],
    ski_acrobatique:["L'absorption des bosses part des chevilles, remonte aux genoux, puis aux hanches","L'impulsion au saut part des jambes ‚Äî extension explosive depuis les genoux et les hanches","Mes bras s'√©l√®vent pour initier la rotation ou maintenir l'√©quilibre en l'air","Le tronc reste stable pendant que les jambes travaillent ind√©pendamment","La r√©ception absorbe l'√©nergie de fa√ßon progressive : chevilles ‚Üí genoux ‚Üí hanches"],
    ski_freeride:["Chaque virage d√©bute par la rotation des hanches avant les genoux","L'absorption des irr√©gularit√©s part des chevilles et remonte","Mes bras sont actifs en balancier pour maintenir l'orientation du tronc","Le transfert de poids d'un ski √† l'autre est initi√© par le bassin","Le plant√© de b√¢ton d√©clenche la rotation du tronc pour le virage suivant"],
    gym_artistique:["L'appel de saut vient de l'extension explosive des jambes ‚Äî les bras amplifient ensuite","En roulade : le contact sol remonte progressivement des pieds vers les √©paules (segment par segment)","En roue / flip : la rotation part des hanches avant que les bras n'acc√©l√®rent","En suspension (barre, anneaux) : les √©paules s'activent avant les bras","La r√©ception absorbe l'√©nergie du haut vers le bas : √©paules ‚Üí hanches ‚Üí genoux ‚Üí chevilles"],
    gym_rythmique:["Le mouvement de l'engin (ruban, ballon, cerceau) part de l'√©paule, pas du poignet seul","La rotation du corps initie le mouvement des bras, qui guident ensuite l'engin","Les arabesques et pivots partent du centre (bassin/tronc) avant les membres","La rotation du poignet pour le ruban part du coude avant le poignet","Mon pied d'appui est stable pendant que le corps et l'engin se d√©placent"],
    gym_acrobatique:["Le porteur : la pouss√©e part des jambes ‚Üí hanches ‚Üí √©paules ‚Üí mains","Le voltigeur : l'appel part des jambes, les bras amplifient et guident la rotation","Les port√©s en statique : la force du porteur vient du gainage, pas des bras seuls","La r√©ception du voltigeur : √©nergie absorb√©e des pieds vers les hanches","La synchronisation porteur/voltigeur : le porteur initie avant que le voltigeur ne r√©agisse"]
  },
  timing:{
    natation:["Il y a une acc√©l√©ration visible en milieu de traction (pas une vitesse constante)","La pouss√©e finale du bras est plus rapide que la phase d'entr√©e","Le battement de jambes s'intensifie au moment de la rotation du corps","La sortie du bras de l'eau est rapide et d√©tendue","Il n'y a pas de pause ou de fl√©chissement entre l'entr√©e et la traction"],
    basket:["L'extension des jambes et celle du bras sont synchronis√©es","Il y a une acc√©l√©ration visible au moment du rel√¢ch√© du ballon","La mont√©e du bras est continue sans pause interm√©diaire","Le ballon part au sommet de l'extension (pas avant, pas apr√®s)","Le geste complet est fluide, sans saccades"],
    raquette:["L'acc√©l√©ration maximale de la raquette se produit au moment du contact","La pr√©paration (back-swing) est compl√®te avant l'arriv√©e de la balle","Le mouvement ne ralentit pas avant le contact","La finition (prolongement du geste) montre une d√©c√©l√©ration naturelle, pas forc√©e","Le rythme pr√©paration-contact-finition est fluide et continu"],
    soccer:["L'acc√©l√©ration du pied est maximale au moment du contact avec le ballon","Le recul du pied (back-swing) est complet avant le contact","Le contact est ferme et d√©cisif (pas h√©sitant)","Le suivi du mouvement (prolongement du geste) se prolonge dans la direction vis√©e","Il n'y a pas de d√©c√©l√©ration visible avant le contact"],
    yoga:["La transition entre postures suit un rythme d√©lib√©r√© (ni trop rapide ni trop lent)","Chaque position interm√©diaire est contr√¥l√©e avant la suivante","La respiration dicte le rythme du mouvement","Il n'y a pas d'h√©sitation ou de perte de fluidit√© en milieu de transition","L'effort s'intensifie au bon moment (expiration = effort maximal)"],
    course:["Le contact au sol est bref (pas de p√©riode d'appui prolong√©e)","La propulsion se produit derri√®re le corps (pas sous lui)","Le rythme bras-jambes est stable et coordonn√©","La phase de vol est visible et proportionnelle √† la vitesse","Il n'y a pas de ralentissement perceptible entre les foul√©es"],
    ski:["L'engagement de la carre se produit au sommet du virage (pas trop tard)","Le transfert de poids d'un ski √† l'autre est fluide et au bon moment","Le plant√© de b√¢ton d√©clenche la rotation des hanches","La phase de glisse est utilis√©e, pas perdue en freinage","L'acc√©l√©ration est visible en sortie de virage"],
    martial:["La vitesse maximale est atteinte juste avant ou au point d'impact","La frappe ne commence pas √† d√©c√©l√©rer avant le contact","La r√©cup√©ration (retrait de la technique) est rapide","Le d√©placement de jambes et la technique de bras sont synchronis√©s","Il n'y a pas de t√©l√©graphie (annonce visible du geste avant son ex√©cution)"],
    volley:["L'acc√©l√©ration du bras de frappe est maximale au contact du ballon","L'impulsion au saut est compl√®te avant la frappe (pas en mont√©e)","La pr√©paration du bras est compl√®te avant l'arriv√©e du ballon","La finition du geste de smash est ample et naturelle apr√®s le contact","Il n'y a pas de pause entre la mont√©e et la frappe"],
    hockey:["L'acc√©l√©ration du b√¢ton est maximale au moment du contact avec la rondelle","Le claquement de poignet se produit au bon moment selon le tir","Il n'y a pas de pause entre le chargement et le tir","La vitesse du b√¢ton augmente du d√©but jusqu'√† l'impact","Le transfert de poids pr√©c√®de le tir (timing coordonn√©)"],
    golf:["Le down-swing acc√©l√®re progressivement jusqu'√† l'impact","Il n'y a pas de d√©c√©l√©ration avant l'impact","Le rythme back-swing/down-swing est fluide (environ 3:1)","Le prolongement du geste est long et naturel apr√®s l'impact","L'impact se produit quand le club est au bas de l'arc de swing"],
    cyclisme:["La puissance maximale est appliqu√©e entre 3h et 6h sur le cadran de la p√©dale","En sprint : l'acc√©l√©ration est progressive et soutenue jusqu'√† la ligne","La cadence est maintenue de fa√ßon constante","La pouss√©e et la traction sont bien coordonn√©es","Les deux jambes ont un rythme r√©gulier sans √†-coups"],
    danse:["Chaque mouvement arrive au bon temps de la musique","Les accents musicaux correspondent aux accents du mouvement","L'acc√©l√©ration et la d√©c√©l√©ration suivent le phras√© musical","Les transitions entre mouvements sont fluides et sans temps mort","La pr√©paration du mouvement suivant est amorc√©e avant la fin du mouvement en cours"],
    escalade:["Le mouvement est d√©clench√© quand les trois points d'appui sont stables","La saisie de la prise se fait avec pr√©cision","Il n'y a pas de pause inutile entre deux mouvements","La vitesse est adapt√©e au type de voie","Le d√©placement est fluide : l'arr√™t ne vient que si n√©cessaire"],
    aviron:["Le catch (entr√©e de rame) est pr√©cis et au bon moment","La pouss√©e des jambes est explosive au d√©but du drive","La r√©cup√©ration est plus lente que le drive","La transition entre le drive et la r√©cup√©ration est fluide","Le rythme drive/r√©cup√©ration est r√©gulier et soutenu"],
    baseball:["Le swing d√©marre au bon moment par rapport au lancer","L'acc√©l√©ration de la batte est maximale au contact","Il n'y a pas de ralentissement avant le contact","Le prolongement du geste est complet et naturel apr√®s le contact","Le rythme chargement/swing est fluide et continu"],
    rugby:["Le pass est lib√©r√© au bon moment selon la position du soutien","Il n'y a pas d'h√©sitation visible avant les d√©cisions motrices","L'acc√©l√©ration dans la course est maximale avant le contact","Le plaquage est d√©clench√© quand le porteur est √† port√©e","La prise de d√©cision est rapide et d√©cisive"],
    general:["Il y a une phase d'acc√©l√©ration visible dans le geste (pas une vitesse constante)","L'acc√©l√©ration maximale se produit au bon moment (point d'action ou d'impact)","Le geste ne ralentit pas avant le point d'action","La finition du mouvement est fluide et naturelle","Le rythme global du mouvement est continu et sans saccades"],
    ski_fond:["La pouss√©e de jambe est explosive et se termine en extension compl√®te (pointe du pied)","La phase de glisse suit imm√©diatement la pouss√©e sans pause perceptible","Le coup de b√¢ton arrive au bon moment ‚Äî plant√© au moment o√π le pied avance","L'acc√©l√©ration est visible sur la phase de glisse (le ski avance apr√®s la pouss√©e)","Le rythme pouss√©e/glisse/pouss√©e est r√©gulier et soutenu sans rupture"],
    ski_acrobatique:["L'absorption commence avant le sommet de la bosse (anticipation, pas r√©action)","L'impulsion au saut se produit au bon moment ‚Äî ni trop t√¥t ni trop tard par rapport √† la l√®vre","La rotation (si pr√©sente) est initi√©e d√®s le d√©part du saut, pas en l'air","La r√©ception est pr√©par√©e avant de toucher le sol (jambes pr√™tes √† absorber)","Le rythme entre les bosses est r√©gulier ‚Äî pas d'acc√©l√©ration incontr√¥l√©e"],
    ski_freeride:["L'engagement du virage se fait au bon moment selon la pente et la neige","La lecture du terrain se fait plusieurs m√®tres en avance (pas en r√©action)","L'acc√©l√©ration en sortie de virage est utilis√©e, pas frein√©e","Le plant√© de b√¢ton arrive au bon moment pour initier le virage","Il n'y a pas de pause ou d'h√©sitation sur des terrains variables"],
    gym_artistique:["L'impulsion est explosive et compl√®te avant de quitter le sol","La phase de vol est maximale selon l'effort fourni (hauteur ou distance visible)","Les rotations ont une vitesse contr√¥l√©e et se terminent avant la r√©ception","La r√©ception est pr√©par√©e en l'air (corps en position avant le contact)","Il n'y a pas de pause involontaire au sommet du saut ou √† mi-rotation"],
    gym_rythmique:["Les mouvements de l'engin arrivent au bon temps musical","Les lancers sont lib√©r√©s au moment pr√©cis de l'accent musical ou du geste","La r√©ception de l'engin est anticip√©e ‚Äî corps en position avant l'arriv√©e","Les acc√©l√©rations et d√©c√©l√©rations du corps suivent le phras√© musical","Les transitions entre figures sont fluides et sans temps mort"],
    gym_acrobatique:["Le lancer/propulsion est synchronis√© ‚Äî porteur et voltigeur agissent au m√™me moment","L'impulsion du voltigeur est explosive et compl√®te avant de quitter le porteur","Les rotations (saltos, vrilles) ont une vitesse contr√¥l√©e","La r√©ception est pr√©par√©e avant le contact ‚Äî le voltigeur est en position en l'air","Il n'y a pas de d√©calage visible entre le signal et l'action des deux partenaires"]
  },
  tension:{
    natation:["Mes √©paules ne remontent pas vers les oreilles pendant la nage","Ma m√¢choire est d√©contract√©e (pas de dents serr√©es visible)","Mon cou n'est pas tendu lors de la respiration","Mes mains entrent dans l'eau de fa√ßon d√©tendue (doigts s√©par√©s, pas cramp√©s)","La tension augmente clairement quand je suis fatigu√© ou press√©"],
    basket:["Mes √©paules sont basses et d√©contract√©es pendant l'envol du tir","Mon visage ne montre pas de grimace d'effort excessif","Ma main de soutien ne pousse pas sur le ballon au moment du rel√¢ch√©","Mon poignet est souple (pas bloqu√©) au moment du tir","La tension appara√Æt ou augmente quand je suis surveill√© ou press√©"],
    raquette:["Ma prise de raquette n'est pas trop serr√©e (r√®gle des 3 doigts)","Mon avant-bras n'est pas contract√© en permanence entre les √©changes","Mes √©paules descendent entre les points (pas de tension accumul√©e)","Mon visage est d√©contract√© pendant la frappe","La tension s'accentue en fin de match ou sous pression"],
    soccer:["Mes bras sont d√©contract√©s et ne se contractent pas inutilement pendant le geste","Mes √©paules ne se crispent pas avant la frappe","Mon pied de frappe n'est pas cramp√© ou excessivement rigid√© avant le contact","Mon expression faciale reste neutre et concentr√©e pendant le geste","La tension est davantage pr√©sente en situation de match que √† l'entra√Ænement"],
    yoga:["Mes √©paules s'√©loignent des oreilles dans toutes les positions","Ma m√¢choire et mon visage sont d√©contract√©s en cours de posture","Mes mains ne se contractent pas quand elles ne sont pas en appui","Ma respiration reste fluide (elle ne se bloque pas dans les positions difficiles)","Les segments du corps au repos (qui ne portent pas) sont d√©tendus"],
    course:["Mes poings ne sont pas serr√©s (main form√©e comme si je tenais un ≈ìuf)","Mes √©paules restent basses et n'oscillent pas vers le haut","Mon visage et ma m√¢choire sont d√©contract√©s","Ma nuque et mon cou ne sont pas tendus","La tension appara√Æt clairement en fin de course ou en mont√©e"],
    ski:["Mes bras ne sont pas contract√©s ou coll√©s au corps","Mes m√¢choires et mon visage sont d√©contract√©s dans les passages difficiles","Mes pieds ne serrent pas les chaussures excessivement","Mes genoux ne sont pas bloqu√©s (ils absorbent les irr√©gularit√©s)","La tension augmente sur les pistes difficiles ou en pr√©sence de public"],
    martial:["Mes √©paules ne remontent pas avant chaque technique","Mon visage ne se contracte pas avant la frappe (signalement involontaire)","Mes segments en repos (bras non actif, jambe d'appui) sont d√©tendus","Ma prise est ferme au point d'impact, mais d√©contract√©e avant et apr√®s","La tension globale augmente quand l'adversaire est actif ou impr√©visible"],
    volley:["Mes √©paules sont basses entre les actions (pas accumulation de tension)","Mon cou et ma m√¢choire sont d√©contract√©s pendant le jeu","Mes bras de manchette ne sont pas rigides (absorption possible)","Mes poignets sont souples lors des passes hautes","La tension augmente clairement lors des balles difficiles ou en fin de set"],
    hockey:["Ma prise de b√¢ton n'est pas trop serr√©e entre les actions","Mes √©paules descendent entre les jou√©es","Mon cou n'est pas tendu lors des d√©placements","Mes bras ne sont pas coll√©s au corps de fa√ßon rigide","La tension augmente sur les mises en jeu ou en zone de pression"],
    golf:["Ma prise n'est pas trop serr√©e (pression de 4 sur 10)","Mes avant-bras sont d√©contract√©s au d√©but du back-swing","Mes √©paules ne remontent pas au d√©but du swing","Ma m√¢choire et mon visage sont d√©contract√©s pendant le swing","La tension appara√Æt sur les trous √† enjeux ou avec des observateurs"],
    cyclisme:["Mes mains ne serrent pas excessivement le guidon","Mes √©paules ne remontent pas vers les oreilles en p√©dalant","Mon cou est d√©contract√© (pas de tension en regardant devant)","Mes bras ont une l√©g√®re flexion d√©contract√©e (absorbent les vibrations)","La tension augmente en mont√©e, en sprint ou en descente technique"],
    danse:["Mes √©paules sont basses et ouvertes (pas contract√©es) tout au long","Ma m√¢choire est d√©contract√©e, mon expression est naturelle","Les segments qui ne dansent pas sont d√©tendus (ex : bras en attente)","Ma respiration est visible et non bloqu√©e","La tension augmente sur les passages techniques ou devant un public"],
    escalade:["Mes avant-bras ne sont pas en permanence contract√©s (ph√©nom√®ne de pompage)","Mes √©paules descendent entre les mouvements","Mes pieds ne poussent pas excessivement sur les prises (gaspillage d'√©nergie)","Ma respiration est audible et r√©guli√®re (pas bloqu√©e)","La tension augmente en zone de difficult√© ou √† l'approche d'un mouvement cl√©"],
    aviron:["Mon dos n'est pas hypertendu entre les coups","Mes √©paules ne remontent pas √† chaque traction","Ma m√¢choire est d√©contract√©e pendant l'effort","Mes mains tiennent la rame sans crispation excessive","La tension globale augmente clairement en fin de course ou en sprint"],
    baseball:["Ma prise de batte est ferme mais pas crisp√©e","Mes √©paules ne remontent pas avant le swing","Mon avant-bras directeur est d√©contract√© jusqu'au d√©part du swing","Mon visage ne trahit pas l'effort avant le contact","La tension augmente sur les lancers rapides ou en situation de match"],
    rugby:["Mes √©paules ne sont pas contract√©es en permanence pendant le jeu","Mes mains ne serrent pas le ballon trop fort entre les actions","Mon cou et mes m√¢choires sont d√©contract√©s hors des contacts","Ma respiration n'est pas bloqu√©e dans les phases statiques (m√©l√©e, lineout)","La tension augmente sur les phases de contact ou en d√©fense"],
    general:["Des segments non actifs dans le geste se contractent visiblement","Mes √©paules ou ma m√¢choire semblent tendues pendant le mouvement","La tension augmente sous pression, sous fatigue ou quand je suis observ√©","Mes mains ou mes bras se crispent de fa√ßon involontaire","Mon geste manque de fluidit√© √† cause de cette rigidit√©"],
    ski_fond:["Mes √©paules ne remontent pas vers les oreilles lors des coups de b√¢tons","Ma prise de b√¢ton se rel√¢che naturellement apr√®s la pouss√©e (doigts s'ouvrent)","Mon cou et ma m√¢choire sont d√©contract√©s pendant l'effort","Mes bras ne sont pas rigides ‚Äî ils accompagnent le mouvement naturellement","La tension augmente clairement en mont√©e ou lors d'un changement de rythme"],
    ski_acrobatique:["Mon tronc n'est pas rigide ‚Äî il reste souple pour absorber les chocs","Mes √©paules ne se crispent pas lors des impacts","Ma m√¢choire et mon visage sont d√©contract√©s malgr√© la vitesse","Mes mains ne serrent pas les b√¢tons excessivement entre les bosses","La tension augmente visiblement sur les passages rapides ou √† l'approche du saut"],
    ski_freeride:["Mon corps reste souple pour s'adapter aux surprises du terrain","Mes √©paules ne se crispent pas lors des irr√©gularit√©s ou des chocs","Mes genoux fonctionnent comme amortisseurs (pas bloqu√©s)","Ma respiration est r√©guli√®re m√™me sur les passages techniques","La tension augmente clairement sur les terrains expos√©s ou tr√®s raides"],
    gym_artistique:["Mon gainage est actif mais non crisp√© ‚Äî la tension est productive, pas parasite","Mon visage est neutre (pas de grimace excessive r√©v√©lant un effort non ma√Ætris√©)","Les groupes musculaires non sollicit√©s sont d√©contract√©s pendant l'ex√©cution","Ma respiration ne se bloque pas dans les phases statiques (√©quilibre, tenu)","La tension visible augmente sur les √©l√©ments difficiles ou en situation de comp√©tition"],
    gym_rythmique:["Mes √©paules sont basses et expressives ‚Äî pas crisp√©es pendant les mouvements d'engin","Ma m√¢choire est d√©contract√©e, mon expression est naturelle et engag√©e","Mon poignet est souple pour les mouvements de ruban (pas rigide)","Les segments au repos entre deux figures sont d√©contract√©s mais actifs","La tension s'accentue clairement sur les figures techniques complexes ou en comp√©tition"],
    gym_acrobatique:["Le porteur : gainage actif mais non crisp√© pendant les port√©s","Le voltigeur : corps tendu en gainage pendant les figures, pas crisp√©","Les deux : visages d√©contract√©s malgr√© l'effort et la concentration","Le porteur : √©paules et bras ne tremblent pas sous le poids (signe de bonne technique)","La tension visible augmente sur les figures difficiles ou √† l'entra√Ænement d'un nouvel √©l√©ment"]
  },
  transfert:{
    natation:["Ma main acc√©l√®re en cours de traction (pas une vitesse constante)","La pouss√©e se prolonge jusqu'√† la cuisse (pas arr√™t√©e √† la hanche)","L'eau est visiblement acc√©l√©r√©e vers l'arri√®re par ma main/avant-bras","Mon corps avance visiblement apr√®s chaque coup de bras","Il n'y a pas de pause ou de perte d'√©lan entre deux tractions"],
    basket:["Le ballon tourne vers l'arri√®re (backspin) au rel√¢ch√© (signe d'un bon transfert)","Mon poignet accompagne le tir jusqu'√† la fin (main retomb√©e vers le bas)","La trajectoire du ballon est en arc, pas tendue","Le ballon quitte ma main du bout des doigts (pas de la paume)","Ma main reste point√©e vers le panier apr√®s le rel√¢ch√©"],
    raquette:["La balle quitte la raquette avec une acc√©l√©ration visible","Mon poignet et mon avant-bras se d√©tendent naturellement apr√®s le contact","La finition de mon geste est ample (pas coup√©e ou arr√™t√©e)","La trajectoire de ma balle correspond √† mon intention","Je ne force pas ou ne bloque pas au moment du contact"],
    soccer:["Le ballon quitte mon pied avec la force pr√©vue (ni trop, ni trop peu)","La trajectoire correspond √† l'intention (hauteur, direction, courbe)","Mon pied ne se bloque pas au moment du contact","Mon corps continue dans la direction de la frappe apr√®s le contact","Il n'y a pas de perte d'√©quilibre ou d'arr√™t brutal apr√®s la frappe"],
    yoga:["L'effort produit au centre se ressent dans le segment final (extension, √©quilibre)","Mes extr√©mit√©s (mains, pieds) ne sont pas contract√©es quand elles devraient √™tre actives","La stabilit√© de ma posture vient du centre, pas des extr√©mit√©s","Je peux tenir la posture sans forcer excessivement aux extr√©mit√©s","L'√©nergie circule jusqu'√† mes doigts et orteils dans les postures ouvertes"],
    course:["Ma propulsion est visible (phase de vol r√©elle, pas seulement transfert de poids)","Mon pied pousse jusqu'√† l'extension compl√®te de la cheville","Le bras oppos√© accompagne l'impulsion (coordination bras-jambe)","Mon genou avant monte haut (bon transfert de la pouss√©e en √©l√©vation)","Je ne perds pas d'√©nergie lat√©ralement (d√©placement frontal efficace)"],
    ski:["Mon ski int√©rieur s'all√®ge (transfert r√©el du poids sur le ski ext√©rieur)","Le ski ext√©rieur fl√©chit sous le poids (prise de carre efficace)","Ma vitesse augmente ou se maintient en sortie de virage","L'√©nergie g√©n√©r√©e par le virage est convertie en vitesse, pas en freinage","Mes skis restent parall√®les et r√©pondent √† mes intentions"],
    martial:["Mon adversaire ou le sac re√ßoit clairement l'√©nergie de ma frappe","Ma technique ne s'arr√™te pas avant l'impact (frappe en surface, pas en profondeur)","Mon kiai ou ma contraction musculaire se produit au bon moment (impact)","La trajectoire de ma technique est directe, sans d√©tour inutile","Je ne perds pas d'√©quilibre apr√®s la technique (transfert contr√¥l√©)"],
    volley:["Le ballon quitte mon bras/main avec une acc√©l√©ration visible","La trajectoire du smash est pr√©cise et intentionnelle","Ma manchette oriente vraiment le ballon (pas seulement un bloc passif)","La finition de mon geste de service est longue (pas coup√©e)","L'√©nergie de mon saut est convertie en puissance de frappe"],
    hockey:["La rondelle atteint la cible avec la force et la direction voulues","Le poignet claque en fin de tir (effet de fouet visible)","Mon corps ne se d√©s√©quilibre pas apr√®s le tir","Le b√¢ton suit la direction de la cible apr√®s le tir","La rondelle part avec la vitesse souhait√©e selon le type de tir"],
    golf:["La balle part dans la direction cibl√©e avec la distance voulue","Le divot est cr√©√© apr√®s la balle (pas avant)","Le club suit la balle dans la direction de la cible apr√®s l'impact","Mon poids est compl√®tement sur le pied avant en fin de swing","Mes hanches sont ouvertes vers la cible en fin de swing"],
    cyclisme:["Ma puissance est ressentie sur l'ensemble du tour de p√©dale","Mon v√©lo acc√©l√®re de fa√ßon proportionnelle √† mon effort","Aucune √©nergie n'est perdue lat√©ralement (pas de roulis excessif du bassin)","Mes pieds poussent jusqu'√† l'extension quasi compl√®te de la jambe","En sprint : la vitesse augmente jusqu'√† la fin"],
    danse:["L'√©nergie du mouvement atteint les extr√©mit√©s (doigts, orteils, regard)","Mes mains et pieds prolongent le geste jusqu'√† sa fin naturelle","Il n'y a pas de mouvements tronqu√©s ou arr√™t√©s pr√©matur√©ment","Chaque geste a la qualit√© de mouvement souhait√©e (fluide, percutant, suspendu)","Le partenaire ou le public per√ßoit clairement l'intention du mouvement"],
    escalade:["Ma main saisit la prise avec la force n√©cessaire","L'√©nergie de la pouss√©e des jambes se traduit en d√©placement vers le haut","Mon corps se d√©place vers la prise suivante sans √†-coups","Mes pieds restent stables sur la prise jusqu'√† la fin du mouvement","Je ne glisse pas ou ne perds pas l'appui apr√®s le mouvement"],
    aviron:["L'embarcation acc√©l√®re clairement apr√®s chaque coup","La rame sort proprement de l'eau sans √©claboussure excessive","Mon corps ne se d√©s√©quilibre pas apr√®s la traction","Il n'y a pas de perte de vitesse due √† une mauvaise sortie de rame","L'√©nergie produite est convertie en distance par coup"],
    baseball:["La balle part dans la direction et avec la force pr√©vues","Le contact est au centre de la batte (sweet spot)","Le prolongement du geste est complet dans l'axe de la trajectoire voulue","Mon corps ne se d√©s√©quilibre pas apr√®s le swing","Mon poignet claque naturellement √† la fin du swing"],
    rugby:["Le pass atteint le receveur avec la force et la direction voulues","Le coup de pied envoie le ballon √† la trajectoire pr√©vue","Mon corps continue dans la direction de l'action apr√®s le geste","Il n'y a pas de perte d'√©quilibre apr√®s le plaquage","Le geste produit le r√©sultat tactique souhait√©"],
    general:["L'√©nergie g√©n√©r√©e par mon corps atteint bien sa cible (objet, adversaire, direction)","Mon segment terminal (main, pied, t√™te) acc√©l√®re en fin de geste","Je ne bloque pas ou ne freine pas le geste avant le point d'action","La finition du mouvement est compl√®te (pas coup√©e en cours de route)","Le r√©sultat observ√© correspond √† l'intention (direction, force, pr√©cision)"],
    ski_fond:["Mon ski de glisse avance clairement apr√®s chaque pouss√©e (√©nergie convertie en distance)","La pouss√©e de b√¢ton se prolonge jusqu'√† l'extension compl√®te du bras derri√®re","Mon corps se projette vers l'avant apr√®s chaque cycle (pas de stationnement)","L'√©nergie ne se perd pas lat√©ralement (d√©placement rectiligne efficace)","La cadence est maintenue ‚Äî chaque cycle produit une glisse proportionnelle √† l'effort"],
    ski_acrobatique:["L'√©nergie des jambes se convertit en hauteur lors du saut (pas en perte d'√©quilibre)","La r√©ception absorbe l'√©nergie sans m'arr√™ter brutalement","Mes skis restent parall√®les et orient√©s √† la r√©ception","Le saut produit la hauteur voulue selon l'effort fourni","L'√©nergie cin√©tique est maintenue tout au long du parcours (pas de freinage involontaire)"],
    ski_freeride:["L'√©nergie de la pente est convertie en vitesse contr√¥l√©e, pas en d√©s√©quilibre","Chaque virage d√©charge l'√©nergie accumul√©e de fa√ßon progressive","Mes skis r√©pondent √† mes intentions (direction, vitesse, pression)","La neige profonde est utilis√©e comme appui ‚Äî mon ski flotte plut√¥t qu'il ne s'enfonce","Je ne perds pas d'√©nergie en mouvements parasites (haut du corps stable)"],
    gym_artistique:["La hauteur ou l'amplitude du saut est maximale selon l'effort fourni","La r√©ception est stable ‚Äî l'√©nergie est absorb√©e sans d√©s√©quilibre","L'√©nergie des rotations se transf√®re proprement (pas de chute ou de pas de correction)","Le geste final (tenu, position) est pr√©cis et contr√¥l√©","Le r√©sultat correspond √† l'intention ‚Äî hauteur, rotation, direction comme planifi√©"],
    gym_rythmique:["L'√©nergie du corps se transmet jusqu'√† l'engin (ruban suit le corps, pas l'inverse)","Les lancers atteignent la hauteur voulue avec la rotation pr√©vue","La r√©ception de l'engin est propre et sans correction de trajectoire","L'√©nergie du geste corporel atteint les extr√©mit√©s ‚Äî doigts, orteils, regard","Le mouvement de l'engin correspond √† l'intention chor√©graphique"],
    gym_acrobatique:["La propulsion du porteur se convertit en hauteur pour le voltigeur","La r√©ception du voltigeur est stable ‚Äî pas de correction ni de pas de rattrapage","Les port√©s statiques sont tenus sans oscillations (√©nergie bien centr√©e)","L'√©nergie de la rotation se dissipe proprement √† la r√©ception","Le r√©sultat (hauteur, rotation, stabilit√©) est proportionnel √† l'effort investi par le porteur"]
  },
  anticipation:{
    natation:["Je d√©clenche ma rotation avant que le bras oppos√© ne termine sa pouss√©e","Ma respiration est anticip√©e (rotation de t√™te avant le besoin d'air)","Mon bras entre dans l'eau avant que l'autre n'ait fini sa traction","Mon virage est pr√©par√© plusieurs brasses avant le mur","Je ne m'arr√™te ou ne fl√©chis pas en attendant de reprendre le mouvement"],
    basket:["Je me d√©place vers ma position de tir avant de recevoir la balle","Ma pr√©paration (mise en position de tir) commence d√®s que je re√ßois la balle","Mon regard identifie l'espace libre avant d'engager le dribble","Je lis la d√©fense et ajuste avant que la pression arrive","Je r√©agis avant que l'adversaire ait compl√©t√© son d√©placement"],
    raquette:["Je commence √† me d√©placer avant que la balle n'ait quitt√© la raquette adverse","Je lis la position du corps de l'adversaire pour deviner la direction","Ma pr√©paration (back-swing) est compl√®te avant l'arriv√©e de la balle","Je reviens en position centrale entre chaque √©change","Mon pied d'appui est plant√© avant que la balle arrive"],
    soccer:["Je regarde autour de moi avant de recevoir le ballon","Mon orientation et ma touche de balle sont pr√©par√©es avant l'impact","Je me d√©marque avant que mon co√©quipier regarde vers moi","Je lis la trajectoire du ballon t√¥t et me positionne en cons√©quence","Ma d√©cision (passer, tirer, dribbler) est prise avant de recevoir le ballon"],
    martial:["Je d√©tecte les intentions de l'adversaire avant qu'il n'engage (lecture posturale)","Ma d√©fense r√©pond aux mouvements adverses, pas √† l'impact","Je place mon garde ou mon d√©placement avant que la technique adverse soit lanc√©e","Je ne r√©agis pas uniquement aux mains (je lis le corps entier)","Mon contre-attaque est d√©clench√© pendant ou juste apr√®s la technique adverse (pas longtemps apr√®s)"],
    volley:["Je me d√©place vers la zone de r√©ception avant que le ballon ne soit frapp√©","Je lis la position des bras adverses pour deviner la direction du smash","Ma pr√©paration est compl√®te avant l'arriv√©e du ballon","Je couvre la zone et me positionne avant de voir la trajectoire finale","Mon saut de smash est planifi√© avant la passe haute du passeur"],
    hockey:["Je me d√©place vers l'espace libre avant que la rondelle y arrive","Je lis la direction du jeu depuis la posture du porteur de rondelle","Ma d√©cision est prise avant de recevoir la passe","Je cr√©e de l'espace avant d'en avoir besoin","Je ne suis pas surpris par des situations de jeu pr√©visibles"],
    baseball:["Je lis la prise du lanceur pour anticiper le type de lancer","En d√©fense, je me positionne selon la situation de jeu","Je d√©marre en direction de la balle avant qu'elle ne touche le sol","Mon chargement est bien tim√© par rapport au release du lanceur","Ma d√©cision de swing est prise au bon moment"],
    rugby:["Je lis le jeu adverse pour pr√©voir o√π la balle va aller","Je me positionne en soutien avant que le porteur ne soit plaqu√©","Ma ligne de course est amorc√©e avant de recevoir le ballon","Je d√©tecte les espaces libres avant qu'ils ne se ferment","Je r√©agis √† la posture adverse, pas seulement √† ses actions"],
    general:["Je me d√©place ou me pr√©pare avant que la situation soit compl√®tement engag√©e","Je lis les indices disponibles (position, trajectoire, rythme) avant d'agir","Ma pr√©paration est compl√®te avant d'avoir besoin d'agir","Je ne suis pas surpris par des situations pr√©visibles","Mon action est d√©clench√©e avant que la fen√™tre d'opportunit√© se ferme"]
  }
};

// ‚îÄ‚îÄ Approfondissement (DEEP) par famille et sport ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
var LOGI_DEEP = {
  f1:{
    natation:["Je bouge les bras sans que le tronc ne tourne","Mon corps reste plat (pas de rotation axiale)","Je ¬´pagaie¬ª sans engager l'√©paule","Ma propulsion vient seulement des bras, pas du corps entier","Mes deux bras semblent travailler de fa√ßon sym√©trique et ind√©pendante"],
    basket:["Mon tir part uniquement du bras (pas des jambes)","Mes jambes ne poussent pas vers le haut pendant le tir","Mon tronc ne s'engage pas dans le geste","Ma d√©tente est absente ou tr√®s faible","Le tir manque de port√©e ou de pr√©cision malgr√© un bon positionnement"],
    volley:["Je frappe le ballon avec seulement le bras (pas de rotation du tronc)","Mon impulsion au saut est faible car les bras ne participent pas","Mes √©paules ne tournent pas avant la frappe","Ma manchette manque de force car le tronc ne s'engage pas","Le geste est en bloc (haut et bas du corps ind√©pendants)"],
    hockey:["Mon tir vient uniquement du bras (pas de rotation des hanches)","Je ne transf√®re pas mon poids lors du tir","Mon tronc ne s'ouvre pas vers la cible","La rondelle manque de vitesse malgr√© un effort visible","Le geste de tir est rigide et cloisonn√©"],
    golf:["Mon swing vient des bras et non des hanches","Mon tronc ne tourne pas avant les √©paules","Je manque de distance malgr√© un effort important","Mon poids ne se transf√®re pas correctement","Le swing semble en bloc, sans s√©quence claire"],
    escalade:["Je me d√©place uniquement √† la force des bras","Mes jambes ne poussent pas : elles sont passives","Mon corps reste loin du mur (hanches non engag√©es)","Je tire uniquement avec les bras sans pousser les pieds","Le mouvement co√ªte cher en √©nergie pour un r√©sultat limit√©"],
    aviron:["Je tire avec les bras sans pousser les jambes d'abord","Mon dos bascule avant que les jambes ne soient √©tendues","La cha√Æne jambes-dos-bras n'est pas respect√©e","Je produis de l'effort sans avancer proportionnellement","Le bateau ne glisse pas malgr√© une force apparente"],
    general:["Je bouge un membre sans engager le tronc","Le mouvement semble cloisonn√© (haut vs bas du corps)","L'√©lan du mouvement ne se propage pas","Le geste manque de fluidit√© entre le bas et le haut du corps","Mon effort n'est pas converti en r√©sultat proportionnel"],
    ski_fond:["Ma pouss√©e de jambe s'arr√™te avant l'extension compl√®te (pointe du pied non utilis√©e)","Mes bras et jambes ne sont pas en opposition (synchronisation rompue)","Le b√¢ton est plant√© trop tard ou trop t√¥t par rapport au pied","Mon tronc ne s'incline pas vers l'avant pour amplifier la pouss√©e","La glisse est courte malgr√© un effort important"],
    ski_acrobatique:["L'absorption des bosses vient seulement des genoux (chevilles et hanches non engag√©es)","L'impulsion au saut vient du dos, pas des jambes","Mon tronc ne reste pas stable pendant que les jambes absorbent","La r√©ception se fait en bloc (pas d'absorption progressive)","Mon effort au saut n'est pas converti en hauteur proportionnelle"],
    ski_freeride:["Mes virages viennent uniquement des genoux (hanches non engag√©es)","Le plant√© de b√¢ton n'initie pas la rotation du tronc","Mon haut du corps pivote ind√©pendamment de mes jambes","Le transfert de poids d'un ski √† l'autre est absent ou trop tardif","Je freine au lieu d'utiliser l'√©nergie accumul√©e"],
    gym_artistique:["L'appel au saut vient des bras sans extension des jambes","En roulade, le dos touche le sol en bloc (pas segment par segment)","Les membres travaillent ind√©pendamment du tronc","Le tronc ne gainage pas : il est passif pendant les √©l√©ments","La r√©ception est dure car le corps n'a pas pr√©par√© l'absorption"],
    gym_rythmique:["Le mouvement de l'engin part du poignet seulement (√©paule non engag√©e)","Mon corps ne g√©n√®re pas le mouvement ‚Äî c'est le bras seul qui travaille","Les pivots partent des √©paules avant le bassin","L'√©nergie du corps ne se transmet pas jusqu'√† l'engin","Le geste corporel et l'engin sont d√©synchronis√©s"],
    gym_acrobatique:["Le porteur pousse avec les bras seulement (jambes non engag√©es)","La cha√Æne jambes-hanches-√©paules-mains n'est pas respect√©e pour le porteur","Le voltigeur utilise seulement les bras pour l'appel (pas les jambes)","La synchronisation porteur/voltigeur est absente (d√©calage visible)","L'√©nergie du porteur ne se convertit pas en hauteur pour le voltigeur"]
  },
  f2:{
    natation:["Ma traction a une vitesse uniforme du d√©but √† la fin","Il n'y a pas de phase d'acc√©l√©ration visible sous l'eau","Mon bras ¬´glisse¬ª plut√¥t que de pousser","Ma pouss√©e finale n'est pas plus forte que ma traction","Mon avancement per√ßu s'arr√™te avant la fin du geste"],
    basket:["Je pousse le ballon √† vitesse constante du bas en haut","Il n'y a pas d'explosion visible au niveau du poignet","Le ballon part trop t√¥t ou trop lentement","Mon saut et mon tir ne sont pas synchronis√©s","Le tir manque de port√©e malgr√© un bon positionnement"],
    general:["Le geste est g√©om√©triquement correct mais manque de punch","La vitesse est uniforme l√† o√π elle devrait exploser","Il n'y a pas de moment d'explosion visible","Le r√©sultat du geste (distance, force, pr√©cision) est en dessous de l'attendu","Je fais le bon geste mais sans l'√©nergie suffisante au bon moment"],
    ski_fond:["La pouss√©e de jambe est pr√©sente mais sans explosion finale (pointe du pied passive)","Le coup de b√¢ton est r√©gulier mais sans acc√©l√©ration marqu√©e","La glisse est courte malgr√© une technique apparemment correcte","Mon rythme est r√©gulier mais sans variation d'intensit√©","Je produis l'effort mais l'avancement est en dessous de l'attendu"],
    ski_acrobatique:["L'impulsion au saut est pr√©sente mais sans explosion (hauteur insuffisante)","Le timing d'absorption est pr√©sent mais sans vivacit√©","Mes mouvements sont au bon endroit mais manquent de dynamisme","Le saut produit moins de hauteur qu'attendu pour l'effort fourni","La r√©ception est correcte mais sans l'amortissement explosif n√©cessaire"],
    ski_freeride:["Mes virages sont techniquement corrects mais sans √©nergie en sortie","Je fais les bons mouvements mais sans convertir la pente en vitesse","Le plant√© de b√¢ton est l√† mais sans d√©clenchement √©nergique du virage","Je contr√¥le mais sans exploiter le terrain √† mon avantage","Ma technique est pr√©sente mais mon ski manque de vivacit√©"],
    gym_artistique:["L'impulsion est pr√©sente mais sans explosion (hauteur insuffisante)","La r√©ception est correcte mais sans le dynamisme attendu","Les rotations sont pr√©sentes mais manquent de vitesse angulaire","Je fais les bons √©l√©ments mais ils manquent d'amplitude","Le timing est l√† mais l'√©nergie est constante l√† o√π elle devrait exploser"],
    gym_rythmique:["Les mouvements sont au bon temps mais sans accent musical marqu√©","Les lancers atteignent la hauteur mais sans la vivacit√© attendue","Le geste est juste mais sans expressivit√© ni dynamisme","Je manipule l'engin correctement mais sans √©nergie dans les moments cl√©s","Les transitions sont pr√©sentes mais sans fluidit√© acc√©l√©r√©e"],
    gym_acrobatique:["La propulsion est pr√©sente mais sans l'explosion n√©cessaire pour la hauteur","La synchronisation est l√† mais sans √©nergie dans les moments cl√©s","Les port√©s sont stables mais sans la fluidit√© et le dynamisme attendus","Le voltigeur manque de hauteur malgr√© une technique apparemment correcte","Les figures sont r√©alis√©es mais sans l'amplitude pr√©vue"]
  },
  f3:{
    natation:["Mes jambes tombent en dessous de la surface","Mon bassin est bas dans l'eau, cr√©ant de la r√©sistance","Ma t√™te est trop haute ou trop basse","Mon corps ne forme pas une ligne droite dans l'eau","L'alignement se d√©grade quand je fatigue"],
    basket:["Mes pieds ne sont pas √† largeur d'√©paules avant le tir","Je suis sur mes talons au moment d'initier le tir","Mon tronc se penche en arri√®re pendant le tir","Ma base est instable (je d√©s√©quilibre apr√®s le tir)","Ma t√™te ne regarde pas la cible avant de tirer"],
    yoga:["Mon bassin bascule excessivement dans la posture","Mes √©paules s'√©l√®vent ou s'affaissent","Mes articulations portantes ne sont pas align√©es","Ma colonne s'arrondit dans des postures qui demandent de l'allongement","La posture est compens√©e par une autre partie du corps"],
    general:["Mon corps n'est pas pr√™t avant de commencer le geste","Mon alignement est d√©fectueux avant m√™me que le mouvement ne commence","Je compense le mauvais alignement avec un effort excessif ailleurs","Ma posture de d√©part change selon le niveau de fatigue","Je suis instable pendant ou apr√®s l'action"],
    ski_fond:["Mon dos est arrondi au lieu d'√™tre inclin√© depuis les hanches","Mes bras ne sont pas en opposition avec mes jambes d√®s le d√©part","Mon poids est sur les talons au lieu de l'avant du pied","Ma posture s'affaisse clairement avec la fatigue ou en mont√©e","Mon tronc est trop vertical ‚Äî je n'utilise pas l'inclinaison pour avancer"],
    ski_acrobatique:["Mes genoux ne sont pas suffisamment fl√©chis avant d'aborder les bosses","Mon poids est en arri√®re (sur les talons) ce qui cause des d√©s√©quilibres","Mes √©paules ne sont pas orient√©es vers le bas de la piste","Ma posture change et s'affaisse √† l'approche des √©l√©ments difficiles","Je suis instable avant m√™me d'atteindre la premi√®re bosse"],
    ski_freeride:["Mon centre de gravit√© est trop haut pour le terrain variable","Mes genoux sont trop tendus (verrouill√©s) pour absorber les surprises","Je ne lis pas le terrain en avance ‚Äî ma posture r√©agit au lieu d'anticiper","Mon poids n'est pas adapt√© au type de neige (trop en avant en poudreuse)","Ma posture est rigide au lieu d'√™tre adaptable"],
    gym_artistique:["Mon gainage est absent avant les √©l√©ments (corps mou)","Mes √©paules sont passives (affaiss√©es) au lieu d'√™tre actives","Mon alignement t√™te-√©paules-hanches-pieds est d√©faillant avant l'√©l√©ment","Mes orteils ne sont pas point√©s dans les positions de tenue","Mon regard n'est pas fixe ‚Äî absence de point de rep√®re"],
    gym_rythmique:["Mon axe vertical est d√©vi√© avant m√™me de commencer la figure","Mes √©paules sont mont√©es ou rentr√©es (pas basses et ouvertes)","Mes pieds ne sont pas en bonne position classique au d√©part","Mon regard est vague plut√¥t qu'expressif et orient√©","Mon corps est affaiss√© ou rigide au lieu d'√™tre en extension l√©g√®re"],
    gym_acrobatique:["Le porteur n'a pas une base stable (genoux pas assez fl√©chis, dos arrondi)","Le voltigeur n'est pas en gainage actif avant l'√©l√©ment","Le regard des deux partenaires n'est pas coordonn√©","Le porteur a son centre de gravit√© trop haut pour une base stable","La position de d√©part du voltigeur est incorrecte pour l'√©l√©ment pr√©vu"]
  },
  f4:{
    natation:["Mes √©paules remontent √† chaque respiration","Mes mains entrent dans l'eau de fa√ßon cramp√©e","Mon cou est tendu pendant la nage","Ma respiration est saccad√©e ou bloqu√©e","La tension augmente clairement apr√®s quelques longueurs"],
    basket:["Ma main de soutien pousse sur le ballon au rel√¢ch√©","Mon poignet est bloqu√© au moment du tir","Mon bras d'appui ne s'√©carte pas naturellement","Ma m√¢choire est serr√©e au moment du tir","La tension est plus visible quand je suis surveill√©"],
    general:["Des muscles non actifs sont visiblement contract√©s","Le geste manque de souplesse et de fluidit√©","La tension augmente avec la fatigue ou la pression","Mon geste semble ¬´rigide¬ª compar√© au mod√®le","Le bruit de mon d√©placement ou ma respiration trahit la tension"],
    ski_fond:["Mes √©paules remontent √† chaque coup de b√¢ton","Mes mains serrent les b√¢tons m√™me apr√®s la pouss√©e (pas de rel√¢chement)","Mon cou et ma m√¢choire sont tendus pendant l'effort","Mes bras sont rigides entre les coups (pas fluides)","La tension augmente clairement en mont√©e ou dans les sections techniques"],
    ski_acrobatique:["Mon tronc est rigide au lieu d'absorber les chocs","Mes √©paules se crispent visiblement √† l'impact des bosses","Ma m√¢choire est serr√©e dans les passages rapides","Mes mains serrent les b√¢tons excessivement dans les passages difficiles","La tension globale augmente √† l'approche du saut ou des √©l√©ments acrobatiques"],
    ski_freeride:["Mon corps est rigide au lieu de s'adapter au terrain (pas d'absorption)","Mes genoux sont verrouill√©s sur les irr√©gularit√©s (bloqu√©s)","Mes √©paules se crispent sur les passages expos√©s ou raides","Ma respiration est bloqu√©e dans les sections difficiles","La tension est clairement visible sur les terrains inconnus ou tr√®s raides"],
    gym_artistique:["Mon gainage est excessivement crisp√© (tension parasite visible)","Mon visage montre une grimace r√©v√©lant un effort non ma√Ætris√©","Ma respiration se bloque dans les phases statiques (√©quilibre, tenu)","Des groupes musculaires non sollicit√©s se contractent pendant l'ex√©cution","La tension augmente sur les √©l√©ments difficiles ou en situation de comp√©tition"],
    gym_rythmique:["Mon poignet est rigide pour les mouvements de ruban (pas souple)","Mes √©paules remontent et se crispent pendant les figures","Mon expression faciale dispara√Æt ‚Äî la tension prend le dessus","Les segments au repos sont crisp√©s au lieu d'√™tre actifs mais d√©contract√©s","La tension s'accentue clairement sur les figures complexes ou devant un jury"],
    gym_acrobatique:["Le porteur tremble visiblement sous le poids (tension mal g√©r√©e)","Le voltigeur est crisp√© en gainage (tension parasite dans les segments non actifs)","Les visages trahissent l'effort excessif ou la peur","Le porteur contracte les √©paules et le cou inutilement","La tension collective augmente sur les figures nouvelles ou difficiles"]
  },
  f5:{
    basket:["Je re√ßois la balle et ensuite je cherche quoi faire","Je suis toujours derri√®re l'action adverse","Mon regard est sur le ballon, pas sur le terrain","Je r√©agis apr√®s que l'adversaire ait d√©j√† engag√©","Je me fais surprendre par des situations pr√©visibles"],
    raquette:["Ma pr√©paration commence apr√®s que la balle ait rebondi","Je suis souvent en d√©s√©quilibre ou sans temps pour bien frapper","Je subis les balles au lieu de les attaquer","Mon regard reste sur ma raquette au lieu de lire l'adversaire","Je manque de temps pour effectuer un bon tir"],
    martial:["Je r√©agis √† l'impact et non aux signaux pr√©curseurs","Mes parades arrivent trop tard","Mon regard suit les mains adverses plut√¥t que le corps entier","Je suis souvent touch√© par des techniques que je voyais venir","Ma contre-attaque arrive longtemps apr√®s la technique adverse"],
    general:["Je r√©agis toujours apr√®s que la situation soit d√©j√† engag√©e","Mon d√©placement est toujours en retard","Je manque de temps pour effectuer le geste correctement","Je suis surpris par des situations pr√©visibles","Je lis l'information trop tard pour en profiter"],
    ski_fond:["Je r√©agis aux variations du terrain au lieu de les anticiper","Mon rythme de pouss√©e s'adapte trop tard aux changements de pente","Je pr√©pare le b√¢ton apr√®s que le pied soit d√©j√† pass√©","Les changements de direction m'arrivent trop vite","Je lis le terrain seulement quand je suis dessus, pas en avance"],
    ski_acrobatique:["Je commence l'absorption sur le sommet de la bosse, pas avant","Mon impulsion au saut est trop tardive par rapport √† la l√®vre","Je vois la bosse et je r√©agis ‚Äî je n'anticipe pas sa forme","Ma pr√©paration √† la r√©ception commence trop tard (en l'air)","Je suis surpris par des bosses pourtant visibles de loin"],
    ski_freeride:["Je lis le terrain trop tard ‚Äî je dois r√©agir √† la derni√®re seconde","Mes virages sont toujours en retard par rapport au terrain","Les obstacles ou variations me surprennent malgr√© leur visibilit√©","Je n'ai jamais le temps de me mettre en bonne position avant d'agir","Je subis le terrain au lieu de le choisir"],
    gym_artistique:["Je pr√©pare la r√©ception trop tard (position pas pr√™te en l'air)","Les rotations se terminent apr√®s le contact sol (pas avant)","Je r√©agis √† la gravit√© au lieu d'anticiper la trajectoire","Ma pr√©paration des √©l√©ments encha√Æn√©s commence trop tard","Je suis souvent pris de court dans les s√©quences de plusieurs √©l√©ments"],
    gym_rythmique:["Je r√©agis √† l'engin au lieu de l'anticiper (lancer non pr√©par√©)","Ma pr√©paration pour la r√©ception de l'engin commence trop tard","Je suis souvent en mauvaise position quand l'engin arrive","Les transitions ne sont pas anticip√©es ‚Äî je r√©agis au lieu de pr√©parer","Je perds le temps musical parce que je n'anticipe pas les accents"],
    gym_acrobatique:["Le voltigeur n'est pas pr√™t au moment o√π le porteur initie","Le porteur r√©agit au poids du voltigeur au lieu d'anticiper","La synchronisation est absente ‚Äî l'un attend que l'autre ait commenc√©","Les signaux non-verbaux ne sont pas lus ou sont ignor√©s","Les corrections arrivent trop tard pour √™tre efficaces"]
  },
  f6:{
    natation:["Ma main entre dans l'eau √† plat (paume vers le bas) au lieu du bout des doigts","Ma traction n'acc√©l√®re pas vers la fin","Je bloque mon coude au lieu de le laisser guider","La pouss√©e n'atteint pas la cuisse (s'arr√™te trop t√¥t)","Mon mouvement de bras semble court ou tronqu√©"],
    basket:["Le ballon ne tourne pas (pas de backspin au rel√¢ch√©)","Mon poignet ne s'incline pas vers l'avant au rel√¢ch√©","Je ¬´pousse¬ª le ballon au lieu de le ¬´le faire partir¬ª","Ma finition est bloqu√©e (main reste rigide apr√®s le rel√¢ch√©)","La trajectoire du ballon est trop tendue (pas assez d'arc)"],
    general:["Mon geste s'arr√™te avant que l'√©nergie atteigne la cible","Je bloque le segment terminal au lieu de le rel√¢cher","Le r√©sultat (force, pr√©cision, distance) est nettement en dessous de l'effort fourni","Mon geste ressemble √† une pouss√©e l√† o√π il devrait y avoir un fouet","La finition du mouvement est courte ou abrupte"],
    ski_fond:["Ma pouss√©e de jambe s'arr√™te √† mi-chemin (pas d'extension jusqu'√† la pointe)","Le coup de b√¢ton se bloque au lieu de se prolonger jusqu'√† l'arri√®re","La glisse est courte malgr√© une pouss√©e apparemment compl√®te","Mon bras ne se prolonge pas en arri√®re apr√®s le coup de b√¢ton","L'√©nergie ne se convertit pas en glisse ‚Äî elle s'arr√™te au sol"],
    ski_acrobatique:["L'impulsion au saut s'arr√™te avant l'extension compl√®te des jambes","L'√©nergie de la pouss√©e ne se convertit pas en hauteur","La r√©ception absorbe l'√©nergie trop brusquement (arr√™t brutal)","Les rotations se terminent avant d'atteindre la position finale","Le saut est nettement moins haut que pr√©vu pour l'effort fourni"],
    ski_freeride:["L'√©nergie du virage est perdue en freinage au lieu d'√™tre convertie en vitesse","La sortie de virage ne produit pas l'acc√©l√©ration attendue","Mon ski ne r√©pond pas √† l'intention ‚Äî l'√©nergie se perd","Les transitions entre virages perdent toute l'√©nergie accumul√©e","Je freine involontairement au lieu de laisser le ski glisser"],
    gym_artistique:["L'√©nergie du saut ne se convertit pas en hauteur maximale","La r√©ception absorbe l'√©nergie de fa√ßon trop abrupte (pas progressive)","Les rotations se terminent avant la position finale voulue","Le geste final n'est pas tenu (manque d'√©nergie r√©siduelle)","L'amplitude est nettement en dessous de l'effort fourni"],
    gym_rythmique:["L'√©nergie du geste ne se transmet pas jusqu'√† l'engin (ruban mou)","Le lancer n'atteint pas la hauteur voulue malgr√© l'effort","La r√©ception de l'engin est perturb√©e (trajectoire non ma√Ætris√©e)","Le mouvement corporel s'arr√™te avant que l'engin soit lib√©r√©","L'√©nergie s'arr√™te aux √©paules ou au coude ‚Äî ne va pas jusqu'au poignet"],
    gym_acrobatique:["La propulsion ne se convertit pas en hauteur pour le voltigeur","Le porteur bloque l'√©nergie au lieu de la rel√¢cher vers le voltigeur","La r√©ception est brutale ‚Äî l'√©nergie n'est pas absorb√©e progressivement","Les port√©s statiques ne sont pas tenus (√©nergie insuffisante maintenue)","Le r√©sultat (hauteur, rotation) est en dessous de l'effort du porteur"]
  }
};

// ‚îÄ‚îÄ Familles ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
var LOGI_FAMILIES = {
  f1:{num:1,title:"Rupture de la cha√Æne cin√©tique",color:"#4f9cf9",bg:"rgba(79,156,249,0.08)",border:"rgba(79,156,249,0.2)",icon:"‚õìÔ∏è",
    description:"Le mouvement est produit en bloc ou par segments isol√©s, sans transfert d'√©nergie de la base vers l'extr√©mit√©.",
    signes:"Mouvement rigide ou en blocs. Les segments du bas et du haut du corps ne se coordonnent pas.",
    objectif:"Initier chaque mouvement par la base (bassin/tronc) et laisser l'√©nergie se propager segment par segment.",
    exercice:"Exercices de dissociation bassin/√©paules, gestes en cha√Æne simplifi√©s."},
  f2:{num:2,title:"D√©faut de timing et d'acc√©l√©ration",color:"#a78bfa",bg:"rgba(167,139,250,0.08)",border:"rgba(167,139,250,0.2)",icon:"‚è±Ô∏è",
    description:"La g√©om√©trie du geste est correcte, mais l'acc√©l√©ration arrive au mauvais moment ou est absente.",
    signes:"Le geste ressemble au mod√®le mais manque d'explosion. La vitesse est constante l√† o√π elle devrait exploser.",
    objectif:"Identifier le moment pr√©cis d'acc√©l√©ration maximale et produire une impulsion d√©cisive.",
    exercice:"Indicateurs sonores ou visuels pour marquer le moment d'acc√©l√©ration. Comparer en vid√©o avec le mod√®le."},
  f3:{num:3,title:"D√©sorganisation posturale de base",color:"#f97316",bg:"rgba(249,115,22,0.08)",border:"rgba(249,115,22,0.2)",icon:"üßê",
    description:"L'alignement du corps (bassin, centre de gravit√©, orientation des segments) est inad√©quat avant ou pendant l'action.",
    signes:"Posture affaiss√©e, bassin mal orient√©, poids mal r√©parti. Le corps n'est pas pr√™t avant que le geste commence.",
    objectif:"√âtablir une posture de d√©part fonctionnelle : alignement du bassin, r√©partition √©quilibr√©e du poids.",
    exercice:"V√©rifier la posture de d√©part en vid√©o. Travailler le gainage et la proprioception."},
  f4:{num:4,title:"Coactivation musculaire parasite",color:"#f43f5e",bg:"rgba(244,63,94,0.08)",border:"rgba(244,63,94,0.2)",icon:"‚ö°",
    description:"Des groupes musculaires non impliqu√©s se contractent involontairement, cr√©ant de la rigidit√©. C'est un indicateur que la t√¢che d√©passe les ressources cognitives actuelles.",
    signes:"Tension visible dans les √©paules, la m√¢choire, les poings. Rigidit√© qui s'accentue sous pression.",
    objectif:"R√©duire la charge cognitive pour permettre un rel√¢chement musculaire progressif.",
    exercice:"Simplifier la t√¢che. Exercices de rel√¢chement cibl√© sur les segments parasites identifi√©s."},
  f5:{num:5,title:"D√©faut d'anticipation perceptivo-motrice",color:"#22d3a0",bg:"rgba(34,211,160,0.08)",border:"rgba(34,211,160,0.2)",icon:"üëÅÔ∏è",
    description:"L'action est d√©clench√©e apr√®s l'information plut√¥t qu'avant. Le d√©butant r√©agit, l'expert anticipe.",
    signes:"Toujours en retard. L'action d√©marre trop tard par rapport √† l'adversaire ou √† l'objet.",
    objectif:"Lire les indices pr√©coces (posture, trajectoire, contexte) pour initier l'action avant que l'information soit compl√®te.",
    exercice:"Exercices de lecture de jeu sans ballon. Comparer en vid√©o le moment de d√©clenchement vs le mod√®le."},
  f6:{num:6,title:"Mauvaise gestion du transfert d'√©nergie segmentaire",color:"#FBBF24",bg:"rgba(251,191,36,0.08)",border:"rgba(251,191,36,0.25)",icon:"üåä",
    description:"L'athl√®te n'a pas encore int√©gr√© le rel√¢chement progressif des segments distaux pour cr√©er un effet d'acc√©l√©ration en cascade.",
    signes:"L'√©nergie ne se rend pas √† la cible. Le geste semble forc√© ou tronqu√©. Le terminal ne s'acc√©l√®re pas.",
    objectif:"Rel√¢cher progressivement les segments distaux pour permettre l'acc√©l√©ration en cascade.",
    exercice:"Pratiquer en ralenti en se concentrant sur le rel√¢chement du segment terminal."}
};

// ‚îÄ‚îÄ √âtapes de l'arbre ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
var LOGI_STEPS = {
  start:{id:'start',tag:'√âtape 1 ‚Äî Type d\'habilet√©',question:"Ton habilet√© motrice est-elle ferm√©e ou ouverte ?",
    info:"Une habilet√© motrice <strong>ferm√©e</strong> se r√©alise dans un environnement stable et pr√©visible ‚Äî tu contr√¥les le moment o√π tu l'inities. Une habilet√© <strong>ouverte</strong> s'adapte en temps r√©el √† un environnement changeant.",
    choices:[
      {label:"Habilet√© ferm√©e",desc:"Environnement stable ‚Äî natation, golf, lancer franc, plongeon, ski, yoga, course‚Ä¶",icon:"üéØ",next:'closed_posture'},
      {label:"Habilet√© ouverte",desc:"Environnement changeant ‚Äî basketball, soccer, tennis, badminton, arts martiaux‚Ä¶",icon:"üîÑ",next:'open_anticipation'}
    ]},
  closed_posture:{id:'closed_posture',tag:'√âtape 2 ‚Äî Posture de d√©part',question:"Ta posture de d√©part est-elle fonctionnelle ?",obsKey:'posture',yesno:true,yes:'closed_chain',no:'result_f3'},
  closed_chain:{id:'closed_chain',tag:'√âtape 3 ‚Äî Cha√Æne cin√©tique',question:"Le mouvement est-il initi√© par ton tronc/bassin et se propage-t-il segment par segment vers tes membres ?",obsKey:'chaine',yesno:true,yes:'closed_timing',no:'result_f1'},
  closed_timing:{id:'closed_timing',tag:'√âtape 4 ‚Äî Timing et acc√©l√©ration',question:"Y a-t-il une acc√©l√©ration d√©cisive au bon moment dans ton geste ?",obsKey:'timing',yesno:true,yes:'closed_tension',no:'result_f2'},
  closed_tension:{id:'closed_tension',tag:'√âtape 5 ‚Äî Tension musculaire',question:"Des muscles non impliqu√©s se contractent-ils involontairement pendant le geste ?",obsKey:'tension',yesno:true,yes:'result_f4',no:'closed_transfer'},
  closed_transfer:{id:'closed_transfer',tag:'√âtape 6 ‚Äî Transfert d\'√©nergie',question:"L'√©nergie g√©n√©r√©e par ton corps arrive-t-elle bien jusqu'√† ta cible ?",obsKey:'transfert',yesno:true,yes:'no_error',no:'result_f6'},
  open_anticipation:{id:'open_anticipation',tag:'√âtape 2 ‚Äî Anticipation',question:"Est-ce que tu d√©clenches ton action avant d'avoir toute l'information disponible ?",obsKey:'anticipation',yesno:true,yes:'open_posture',no:'result_f5'},
  open_posture:{id:'open_posture',tag:'√âtape 3 ‚Äî Posture de d√©part',question:"Ta posture de d√©part est-elle fonctionnelle avant chaque action ?",obsKey:'posture',yesno:true,yes:'open_chain',no:'result_f3'},
  open_chain:{id:'open_chain',tag:'√âtape 4 ‚Äî Cha√Æne cin√©tique',question:"Le mouvement est-il initi√© par ton tronc/bassin et se propage-t-il vers tes membres ?",obsKey:'chaine',yesno:true,yes:'open_tension',no:'result_f1'},
  open_tension:{id:'open_tension',tag:'√âtape 5 ‚Äî Tension musculaire',question:"Des muscles non impliqu√©s se contractent-ils involontairement pendant le geste ?",obsKey:'tension',yesno:true,yes:'result_f4',no:'open_transfer'},
  open_transfer:{id:'open_transfer',tag:'√âtape 6 ‚Äî Transfert d\'√©nergie',question:"L'√©nergie g√©n√©r√©e par ton corps arrive-t-elle bien jusqu'√† ta cible ?",obsKey:'transfert',yesno:true,yes:'no_error',no:'result_f6'},
  no_error:{id:'no_error',special:'noerror'},
  result_f1:{id:'result_f1',family:'f1'},result_f2:{id:'result_f2',family:'f2'},
  result_f3:{id:'result_f3',family:'f3'},result_f4:{id:'result_f4',family:'f4'},
  result_f5:{id:'result_f5',family:'f5'},result_f6:{id:'result_f6',family:'f6'}
};

// ‚îÄ‚îÄ Exemples contextuels par √©tape et sport ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
var LOGI_EXAMPLES = {
  posture:{natation:"En natation : observe le moment juste avant que ton bras entre dans l'eau. Ton corps est-il horizontal ? Ton bassin est-il √† la surface ?",basket:"Au basketball : observe ta position juste avant de d√©clencher le tir. Tes genoux sont-ils fl√©chis ? Ton poids est-il sur l'avant du pied ?",raquette:"Au tennis/badminton : observe ta position d'attente entre les points. Es-tu en position athl√©tique, genoux fl√©chis, raquette devant toi ?",yoga:"En yoga : observe la posture de d√©part avant chaque transition. Ton bassin est-il neutre ? Tes √©paules sont-elles loin des oreilles ?",course:"En course : observe les premiers m√®tres. Ton tronc est-il l√©g√®rement inclin√© en avant ? Ton regard est-il devant toi ?",ski:"En ski alpin : observe ta position en haut de la piste avant d'engager. Tes genoux sont-ils fl√©chis ? Ton poids est-il centr√© ?",ski_fond:"En ski de fond : ton tronc est-il inclin√© vers l'avant depuis les hanches (pas le dos arrondi) ? Tes bras sont-ils en opposition avec tes jambes ?",ski_acrobatique:"En ski acrobatique : tes genoux sont-ils suffisamment fl√©chis pour absorber les bosses ? Tes √©paules sont-elles orient√©es vers le bas de la piste ?",ski_freeride:"En freeride : ton regard anticipe-t-il le terrain plusieurs m√®tres en avance ? Ton centre de gravit√© est-il adapt√© √† la neige profonde ?",martial:"En arts martiaux : observe ta garde initiale. Ton centre de gravit√© est-il bas ? Ta garde te prot√®ge-t-elle sans te bloquer ?",gym_artistique:"En gymnastique artistique : observe ton alignement avant l'√©l√©ment. Ton gainage est-il actif ? Tes orteils sont-ils point√©s ?",gym_rythmique:"En gymnastique rythmique : ton axe vertical est-il parfait ? Tes √©paules sont-elles basses et ton regard expressif selon la chor√©graphie ?",gym_acrobatique:"En gymnastique acrobatique : le porteur a-t-il une base stable (genoux fl√©chis, dos plat) ? Le voltigeur est-il en gainage actif avant l'√©l√©ment ?",general:"Observe ta position juste avant que le geste commence. Ton corps est-il pr√™t √† agir efficacement ?"},
  chaine:{natation:"En natation (crawl) : est-ce que ton tronc pivote avant que ton bras ne commence √† tirer ? La rotation de l'√©paule pr√©c√®de-t-elle la traction de la main ?",basket:"Au basketball (lancer franc) : est-ce que tes jambes poussent vers le haut avant que ton bras ne monte ? L'√©nergie monte-t-elle des jambes vers le bout des doigts ?",raquette:"Au tennis : est-ce que tes hanches tournent avant tes √©paules ? Et tes √©paules avant ton bras ? Le bras arrive-t-il en dernier ?",yoga:"En yoga : l'effort part-il de ton centre (bassin, abdominaux) avant de se propager vers tes bras ou jambes ?",ski:"En ski alpin : la rotation d√©bute-t-elle par les hanches ? Tes genoux suivent-ils, puis les chevilles ?",ski_fond:"En ski de fond : la pouss√©e de jambe va-t-elle jusqu'√† la pointe du pied ? Le b√¢ton est-il plant√© au niveau du pied avant que l'√©paule tire ?",ski_acrobatique:"En ski acrobatique : l'absorption des bosses remont-elle bien des chevilles aux genoux puis aux hanches ? L'impulsion au saut part-elle des jambes ?",ski_freeride:"En freeride : chaque virage d√©bute-t-il par la rotation des hanches avant les genoux ? Le plant√© de b√¢ton d√©clenche-t-il bien la rotation du tronc ?",martial:"En arts martiaux : ta frappe part-elle du bassin (koshi) avant que l'√©paule et le bras ne s'engagent ?",course:"En course : ta foul√©e est-elle initi√©e par la hanche ? Ton bras balan√ßoir est-il coordonn√© avec la jambe oppos√©e ?",gym_artistique:"En gymnastique artistique : l'appel au saut vient-il des jambes avant que les bras n'amplifient ? En roulade, le dos suit-il segment par segment ?",gym_rythmique:"En gymnastique rythmique : le mouvement de l'engin part-il de l'√©paule, pas du poignet seul ? La rotation du corps pr√©c√®de-t-elle le mouvement des bras ?",gym_acrobatique:"En gymnastique acrobatique : la pouss√©e du porteur part-elle des jambes vers les hanches puis les √©paules ? Le voltigeur utilise-t-il ses jambes pour l'appel ?",general:"Le mouvement part-il de ton centre (bassin/tronc) avant de se propager vers tes membres ?"},
  timing:{natation:"En natation : y a-t-il une acc√©l√©ration visible en milieu de traction (pas une vitesse constante du d√©but √† la fin) ?",basket:"Au tir en basketball : y a-t-il une explosion visible au moment o√π le ballon quitte ta main ?",raquette:"Au tennis/badminton : l'acc√©l√©ration de ta raquette est-elle maximale exactement au moment du contact ?",ski:"En ski alpin : le transfert de poids d'un ski √† l'autre se fait-il au bon moment (sommet du virage) ?",ski_fond:"En ski de fond : la pouss√©e de jambe est-elle explosive et compl√®te (jusqu'√† la pointe du pied) ? Le coup de b√¢ton arrive-t-il au bon moment ?",ski_acrobatique:"En ski acrobatique : l'absorption commence-t-elle avant le sommet de la bosse (anticipation) ? L'impulsion au saut se produit-elle au bon moment par rapport √† la l√®vre ?",ski_freeride:"En freeride : l'engagement du virage se fait-il au bon moment selon la pente ? Lis-tu le terrain plusieurs m√®tres en avance ?",martial:"En arts martiaux : ta frappe acc√©l√®re-t-elle jusqu'√† l'impact, sans ralentir avant le contact ?",course:"En course : ton contact au sol est-il bref ? Ta propulsion se produit-elle clairement derri√®re ton corps ?",gym_artistique:"En gymnastique artistique : l'impulsion est-elle explosive et compl√®te avant de quitter le sol ? La r√©ception est-elle pr√©par√©e en l'air ?",gym_rythmique:"En gymnastique rythmique : chaque mouvement arrive-t-il au bon temps musical ? Les lancers sont-ils lib√©r√©s au moment pr√©cis de l'accent ?",gym_acrobatique:"En gymnastique acrobatique : porteur et voltigeur agissent-ils de fa√ßon synchronis√©e ? La r√©ception est-elle pr√©par√©e avant le contact sol ?",general:"Y a-t-il une phase d'acc√©l√©ration claire dans le geste ? Le mouvement ne ralentit-il pas avant le point d'action ?"},
  tension:{natation:"En natation : observe tes √©paules et ton cou ‚Äî remontent-ils √† chaque coup de bras ? Tes mains entrent-elles cramp√©es dans l'eau ?",basket:"Au basketball : ta main non-dominante pousse-t-elle encore sur le ballon au moment du rel√¢ch√© ? Ton poignet est-il bloqu√© ?",raquette:"Au tennis : ta prise est-elle trop serr√©e ? Tes avant-bras sont-ils contract√©s en permanence ?",yoga:"En yoga : ta respiration se bloque-t-elle dans les positions difficiles ? Tes m√¢choires sont-elles serr√©es ?",martial:"En arts martiaux : tes √©paules remontent-elles avant chaque technique ? Ton visage se contracte-t-il avant la frappe ?",course:"En course : tes poings sont-ils serr√©s ? Tes √©paules oscillent-elles vers le haut ?",ski_fond:"En ski de fond : ta prise de b√¢ton se rel√¢che-t-elle apr√®s la pouss√©e (doigts qui s'ouvrent) ? Tes √©paules remontent-elles vers les oreilles lors des coups ?",ski_acrobatique:"En ski acrobatique : ton tronc reste-t-il souple pour absorber les chocs (pas rigide) ? Tes √©paules se crispent-elles √† l'impact des bosses ?",ski_freeride:"En freeride : ton corps reste-t-il souple pour s'adapter au terrain variable ? Tes genoux fonctionnent-ils comme amortisseurs (pas bloqu√©s) ?",gym_artistique:"En gymnastique artistique : ton gainage est-il productif (pas crisp√©) ? Ta respiration se bloque-t-elle dans les phases statiques ?",gym_rythmique:"En gymnastique rythmique : ton poignet est-il souple pour le ruban (pas rigide) ? Tes √©paules sont-elles basses et expressives ?",gym_acrobatique:"En gymnastique acrobatique : le porteur tremble-t-il sous le poids (rigidit√©) ? Le voltigeur est-il crisp√© en gainage pendant les figures ?",general:"Observe les segments qui ne travaillent pas directement ‚Äî sont-ils d√©tendus ou contract√©s ?"},
  anticipation:{natation:"En natation : d√©clenches-tu ta rotation avant que le bras oppos√© ait fini sa pouss√©e ?",basket:"Au basketball : te d√©places-tu vers ta position avant de recevoir la balle ? Prends-tu ta d√©cision avant de recevoir ?",raquette:"Au tennis/badminton : commences-tu √† te d√©placer avant que la balle quitte la raquette adverse ?",soccer:"Au soccer : regardes-tu autour de toi avant de recevoir le ballon ? Ta d√©cision est-elle d√©j√† prise √† la r√©ception ?",martial:"En arts martiaux : d√©tectes-tu les intentions de l'adversaire avant qu'il engage ? R√©agis-tu √† sa posture ou √† l'impact ?",general:"Agis-tu avant que la situation soit compl√®tement d√©voil√©e, ou toujours apr√®s ?"},
  transfert:{natation:"En natation : ta main acc√©l√®re-t-elle en fin de traction ? La pouss√©e se prolonge-t-elle jusqu'√† la cuisse ?",basket:"Au basketball : le ballon tourne-t-il vers l'arri√®re (backspin) au rel√¢ch√© ? Ton poignet s'incline-t-il vers le panier apr√®s le tir ?",raquette:"Au tennis : la balle quitte-t-elle la raquette avec une acc√©l√©ration visible ? Ta finition est-elle ample ?",soccer:"Au soccer : le ballon suit-il l'intention vis√©e (direction, force, hauteur) ? Ton pied ne bloque-t-il pas avant le contact ?",ski:"En ski alpin : ton ski int√©rieur s'all√®ge-t-il (transfert r√©el du poids) ? Ta vitesse augmente-t-elle en sortie de virage ?",ski_fond:"En ski de fond : ton ski de glisse avance-t-il clairement apr√®s chaque pouss√©e ? La pouss√©e de b√¢ton se prolonge-t-elle jusqu'√† l'extension compl√®te du bras ?",ski_acrobatique:"En ski acrobatique : l'√©nergie de tes jambes se convertit-elle en hauteur au saut ? Tes skis restent-ils parall√®les et orient√©s √† la r√©ception ?",ski_freeride:"En freeride : chaque virage d√©charge-t-il l'√©nergie accumul√©e de fa√ßon progressive ? Tes skis r√©pondent-ils √† tes intentions (direction, vitesse, pression) ?",martial:"En arts martiaux : l'adversaire ou le sac re√ßoit-il clairement l'√©nergie de ta frappe ? Ta technique ne s'arr√™te-t-elle pas en surface ?",gym_artistique:"En gymnastique artistique : la r√©ception est-elle stable (√©nergie absorb√©e sans d√©s√©quilibre) ? Le r√©sultat correspond-il √† ton intention (hauteur, rotation, direction) ?",gym_rythmique:"En gymnastique rythmique : l'engin suit-il le mouvement de ton corps (pas l'inverse) ? Les lancers atteignent-ils la hauteur voulue avec la rotation pr√©vue ?",gym_acrobatique:"En gymnastique acrobatique : la propulsion du porteur se convertit-elle en hauteur pour le voltigeur ? La r√©ception du voltigeur est-elle stable, sans pas de correction ?",general:"L'√©nergie arrive-t-elle √† destination (objet, cible, direction) ? Le segment terminal acc√©l√®re-t-il en fin de geste ?"}
};

// ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function logiEsc(s){ return (s||'').replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

function logiGetObs(obsKey){
  var ak=logiActKey();
  var pool=LOGI_OBS[obsKey];
  if(!pool) return [];
  return pool[ak]||pool.general||[];
}
function logiGetDeep(fk){
  var ak=logiActKey();
  var pool=LOGI_DEEP[fk];
  if(!pool) return [];
  return pool[ak]||pool.general||[];
}
function logiGetExample(obsKey){
  var ak=logiActKey();
  var pool=LOGI_EXAMPLES[obsKey];
  if(!pool) return '';
  return pool[ak]||pool.general||'';
}

function logiUpdateProgress(sid){
  var dots=document.querySelectorAll('#logi-progress-bar .logi-dot');
  var sm={ident:0,start:1,closed_posture:2,open_anticipation:2,closed_chain:3,open_posture:3,closed_timing:4,open_chain:4,closed_tension:4,open_tension:4,closed_transfer:5,open_transfer:5};
  var results=['result_f1','result_f2','result_f3','result_f4','result_f5','result_f6','no_error'];
  var isR=results.indexOf(sid)>=0;
  var cur=isR?6:(sm[sid]!==undefined?sm[sid]:0);
  for(var i=0;i<dots.length;i++){
    dots[i].classList.remove('active','done');
    if(i<cur) dots[i].classList.add('done');
    else if(i===cur) dots[i].classList.add('active');
  }
  if(isR){ for(var i=0;i<dots.length;i++) dots[i].classList.add('done'); }
}

function logiBreadcrumb(){
  if(!logi.breadcrumbTrail.length) return '';
  var h='<div class="logi-breadcrumb">';
  for(var i=0;i<logi.breadcrumbTrail.length;i++){
    h+='<span>'+logi.breadcrumbTrail[i]+'</span>';
    if(i<logi.breadcrumbTrail.length-1) h+='<span class="sep">‚Ä∫</span>';
  }
  return h+'</div>';
}

function logiSaveObs(sid){
  var checks=document.querySelectorAll('.logi-obs-check:checked');
  var free=document.getElementById('logi_obs_free_'+sid);
  var checked=[];
  for(var i=0;i<checks.length;i++) checked.push(checks[i].dataset.label);
  logi.stepObservations[sid]={checked:checked,free:free?free.value.trim():''};
}

function logiToggleCheck(el){
  var item=el.closest('.logi-check-item');
  if(item) item.classList.toggle('checked',el.checked);
}
function logiToggleDeep(el){
  var item=el.closest('.logi-deep-item');
  if(item) item.classList.toggle('checked',el.checked);
}

// ‚îÄ‚îÄ Render principal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function logiRender(){
  logiUpdateProgress(logi.currentStep);
  var t=document.getElementById('logi-tree');
  if(!t) return;
  if(logi.currentStep==='ident'){ logiRenderIdent(); return; }
  var step=LOGI_STEPS[logi.currentStep];
  if(step&&step.family){ logiRenderResult(step.family); return; }
  if(step&&step.special==='noerror'){ logiRenderNoError(); return; }
  logiRenderQuestion(step);
}

// ‚îÄ‚îÄ Identification ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function logiRenderIdent(){
  var today=new Date();
  var ds=today.getFullYear()+'-'+String(today.getMonth()+1).padStart(2,'0')+'-'+String(today.getDate()).padStart(2,'0');
  var h='<div class="logi-card">';
  h+='<span class="logi-step-tag">Identification ‚Äî √âtape pr√©liminaire</span>';
  h+='<h2>Identifie-toi et d√©cris ta s√©ance</h2>';
  h+='<div class="logi-form-grid">';
  h+='<div class="logi-fgroup"><label>Nom <span class="logi-req">*</span></label><input type="text" id="logi-nom" placeholder="Nom de famille"></div>';
  h+='<div class="logi-fgroup"><label>Pr√©nom <span class="logi-req">*</span></label><input type="text" id="logi-prenom" placeholder="Pr√©nom"></div>';
  h+='<div class="logi-fgroup"><label>Date</label><input type="date" id="logi-date" value="'+ds+'"></div>';
  h+='<div class="logi-fgroup"><label>N¬∞ s√©ance <span class="logi-req">*</span></label><input type="number" id="logi-seance" placeholder="Ex : 3" min="1" max="20"></div>';
  h+='<div class="logi-fgroup"><label>Activit√© physique <span class="logi-req">*</span></label><input type="text" id="logi-activite" placeholder="Ex : Natation, Basketball, Volleyball‚Ä¶" oninput="logiPreviewSport(this.value)"></div>';
  h+='<div class="logi-fgroup"><label>Groupe <span class="logi-req">*</span></label><select id="logi-groupe"><option value="">Choisir...</option><option>Groupe 01</option><option>Groupe 02</option><option>Groupe 03</option><option>Groupe 04</option></select></div>';
  h+='<div class="logi-fgroup"><label>Technique analys√©e <span class="logi-req">*</span></label><input type="text" id="logi-technique" placeholder="Ex : Crawl, Lancer franc, Service‚Ä¶"></div>';
  h+='</div>';
  h+='<div id="logi-sport-preview" style="font-size:11px;color:var(--teal);margin-bottom:10px;min-height:16px;"></div>';
  h+='</div>';
  h+='<div class="logi-card" style="margin-top:0">';
  h+='<span class="logi-step-tag">Objectifs ‚Äî Avant l\'analyse</span>';
  h+='<h2>D√©finis tes objectifs et indicateurs de performance</h2>';
  h+='<p>Ces objectifs guident ton analyse. Tu pourras les r√©viser apr√®s avoir identifi√© ta famille d\'erreurs.</p>';
  h+='<div class="logi-obj-section"><div class="logi-obj-title">üéØ Objectif global <span class="logi-req">*</span></div>';
  h+='<div class="logi-fgroup"><textarea id="logi-objGlobal" placeholder="D√©cris en une phrase l\'am√©lioration globale que tu vises."></textarea></div></div>';
  h+='<div class="logi-obj-section"><div class="logi-obj-title">üìã Objectifs strat√©giques (1 min, 5 max) <span class="logi-req">*</span></div>';
  h+='<div id="logi-objList"></div>';
  h+='<button class="logi-btn-add-obj" id="logi-btnAddObj" onclick="logiAddObjective()">+ Ajouter un objectif strat√©gique</button></div>';
  h+='<div id="logi-identError" class="logi-val-error"></div>';
  h+='<button class="logi-btn-primary" onclick="logiSubmitIdent()" style="margin-top:18px">D√©marrer l\'analyse ‚Üí</button>';
  h+='</div>';
  document.getElementById('logi-tree').innerHTML=h;
  logiAddObjective();
  window.scrollTo({top:0,behavior:'smooth'});
}

function logiPreviewSport(val){
  var ak=logiDetectActivity(val);
  var labels={natation:'üèä Natation',basket:'üèÄ Basketball',raquette:'üéæ Tennis/Raquette',soccer:'‚öΩ Soccer',yoga:'üßò Yoga/Pilates',course:'üèÉ Course/Athl√©tisme',ski:'‚õ∑Ô∏è Ski alpin',ski_fond:'‚õ∑Ô∏è Ski de fond / Nordique',ski_acrobatique:'‚õ∑Ô∏è Ski acrobatique / Moguls',ski_freeride:'‚õ∑Ô∏è Ski freeride / Hors-piste',martial:'ü•ã Arts martiaux',volley:'üèê Volleyball',hockey:'üèí Hockey',golf:'‚õ≥ Golf',cyclisme:'üö¥ Cyclisme/Triathlon',danse:'üíÉ Danse',gym_artistique:'ü§∏ Gymnasique artistique',gym_rythmique:'üéÄ Gymnasique rythmique',gym_acrobatique:'ü§º Gymnasique acrobatique',escalade:'üßó Escalade',aviron:'üö£ Aviron/Kayak',baseball:'‚öæ Baseball/Softball',rugby:'üèâ Rugby/Ultimate',general:'üèÖ Sport g√©n√©ral'};
  var el=document.getElementById('logi-sport-preview');
  if(el) el.textContent=val?'‚úì Sport d√©tect√© : '+(labels[ak]||ak)+' ‚Äî les exemples s\'adapteront automatiquement':'';
}

function logiAddObjective(prefill){
  var list=document.getElementById('logi-objList'); if(!list)return;
  var items=list.querySelectorAll('.logi-obj-item'); if(items.length>=5)return;
  logi.objCount++;
  var id='logi_obj_'+logi.objCount;
  var div=document.createElement('div'); div.className='logi-obj-item'; div.id=id;
  var canRemove=items.length>0;
  div.innerHTML='<div class="logi-obj-header"><span class="logi-obj-num">Objectif strat√©gique '+(items.length+1)+'</span>'+(canRemove?'<button class="logi-btn-rm-obj" onclick="logiRemoveObjective(\''+id+'\')">Supprimer</button>':'')+'</div>'+
    '<div class="logi-fgroup" style="margin-bottom:10px"><label>Description <span class="logi-req">*</span></label><input type="text" class="logi-obj-desc" id="logi_desc_'+id+'" placeholder="D√©cris ce que tu veux am√©liorer" value="'+(prefill&&prefill.desc?logiEsc(prefill.desc):'')+'"></div>'+
    '<div class="logi-fgroup"><label>Indicateurs <span class="logi-req">* (min. 3)</span></label><div class="logi-ind-list" id="logi_inds_'+id+'"></div>'+
    '<button class="logi-btn-add-ind" onclick="logiAddIndicator(\''+id+'\')">+ Ajouter un indicateur</button>'+
    '<div class="logi-ind-hint">Ex : ¬´ Mon coude reste √©lev√© pendant la traction ¬ª</div></div>';
  list.appendChild(div);
  if(prefill&&prefill.indicators&&prefill.indicators.length){
    for(var j=0;j<prefill.indicators.length;j++) logiAddIndicator(id,prefill.indicators[j]);
    while(document.querySelectorAll('#logi_inds_'+id+' .logi-ind-row').length<3) logiAddIndicator(id,'');
  } else { logiAddIndicator(id); logiAddIndicator(id); logiAddIndicator(id); }
  logiUpdateObjNumbers();
  var btn=document.getElementById('logi-btnAddObj');
  if(btn) btn.disabled=(list.querySelectorAll('.logi-obj-item').length>=5);
}

function logiRemoveObjective(id){ var el=document.getElementById(id); if(el)el.parentNode.removeChild(el); logiUpdateObjNumbers(); var btn=document.getElementById('logi-btnAddObj'); if(btn)btn.disabled=false; }
function logiUpdateObjNumbers(){
  var items=document.querySelectorAll('.logi-obj-item');
  for(var i=0;i<items.length;i++){
    var n=items[i].querySelector('.logi-obj-num'); if(n) n.textContent='Objectif strat√©gique '+(i+1);
    var rb=items[i].querySelector('.logi-btn-rm-obj'); if(rb) rb.style.display=i===0?'none':'';
  }
}
function logiAddIndicator(objId,val){
  var list=document.getElementById('logi_inds_'+objId); if(!list)return;
  if(!logi.indCounters[objId]) logi.indCounters[objId]=0; logi.indCounters[objId]++;
  var iid=objId+'_ind_'+logi.indCounters[objId];
  var row=document.createElement('div'); row.className='logi-ind-row'; row.id=iid;
  row.innerHTML='<input type="text" placeholder="Ce que tu vas observer en vid√©o" value="'+logiEsc(val||'')+'" id="logi_val_'+iid+'"><button class="logi-btn-rm-ind" onclick="logiRemoveIndicator(\''+iid+'\')">‚úï</button>';
  list.appendChild(row);
}
function logiRemoveIndicator(iid){ var el=document.getElementById(iid); if(el)el.parentNode.removeChild(el); }

function logiCollectObjectives(){
  var r=[]; var items=document.querySelectorAll('.logi-obj-item');
  for(var i=0;i<items.length;i++){
    var di=items[i].querySelector('.logi-obj-desc'); var desc=di?di.value.trim():'';
    var ii=items[i].querySelectorAll('.logi-ind-row input'); var inds=[];
    for(var j=0;j<ii.length;j++){ var v=ii[j].value.trim(); if(v) inds.push(v); }
    r.push({desc:desc,indicators:inds});
  }
  return r;
}

function logiSubmitIdent(){
  var nom=document.getElementById('logi-nom').value.trim();
  var prenom=document.getElementById('logi-prenom').value.trim();
  var groupe=document.getElementById('logi-groupe')?document.getElementById('logi-groupe').value:'';
  var date=document.getElementById('logi-date').value;
  var seance=document.getElementById('logi-seance').value.trim();
  var activite=document.getElementById('logi-activite').value.trim();
  var technique=document.getElementById('logi-technique').value.trim();
  var objGlobal=document.getElementById('logi-objGlobal').value.trim();
  var errEl=document.getElementById('logi-identError');
  if(!nom||!prenom||!seance||!activite||!technique||!groupe){errEl.textContent='‚ö†Ô∏è Remplis tous les champs obligatoires (incluant le groupe).';errEl.style.display='block';return;}
  if(!objGlobal){errEl.textContent='‚ö†Ô∏è Ton objectif global est obligatoire.';errEl.style.display='block';return;}
  var objs=logiCollectObjectives();
  if(!objs.length||!objs[0].desc){errEl.textContent='‚ö†Ô∏è Au moins un objectif strat√©gique est requis.';errEl.style.display='block';return;}
  for(var i=0;i<objs.length;i++){
    if(!objs[i].desc){errEl.textContent='‚ö†Ô∏è D√©cris l\'objectif strat√©gique '+(i+1)+'.';errEl.style.display='block';return;}
    if(objs[i].indicators.length<3){errEl.textContent='‚ö†Ô∏è L\'objectif '+(i+1)+' doit avoir au moins 3 indicateurs remplis.';errEl.style.display='block';return;}
  }
  logi.studentInfo={nom:nom,prenom:prenom,date:date,seance:seance,groupe:groupe,activite:activite,technique:technique,objGlobal:objGlobal,objectives:objs};
  logi.navHistory.push('ident'); logi.currentStep='start'; logiRender();
}

// ‚îÄ‚îÄ Question avec observations contextuelles ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function logiRenderQuestion(step){
  var h=logiBreadcrumb();
  var obsPoints=step.obsKey?logiGetObs(step.obsKey):[];
  var ak=logiActKey();

  if(obsPoints.length){
    h+='<div class="logi-obs-panel">';
    h+='<div class="logi-obs-title">üìπ Observe ta vid√©o ‚Äî <em style="font-weight:400;text-transform:none;letter-spacing:0">coche ce que tu constates</em></div>';
    var ex=logiGetExample(step.obsKey);
    if(ex){
      h+='<div class="logi-obs-example"><div class="ex-lbl">Exemple ‚Äî '+logiEsc(logi.studentInfo.activite)+'</div><p>'+ex+'</p></div>';
    }
    h+='<div class="logi-check-list">';
    for(var i=0;i<obsPoints.length;i++){
      var cid='logi_chk_'+logi.currentStep+'_'+i;
      h+='<div class="logi-check-item" id="logi_ci_'+cid+'"><input type="checkbox" class="logi-obs-check" id="'+cid+'" data-label="'+logiEsc(obsPoints[i])+'" onchange="logiToggleCheck(this)"><label for="'+cid+'">'+obsPoints[i]+'</label></div>';
    }
    h+='</div>';
    h+='<span class="logi-obs-free-lbl">Mes observations libres</span>';
    h+='<textarea class="logi-obs-free" id="logi_obs_free_'+logi.currentStep+'" placeholder="Note ici tout ce que tu observes dans ta vid√©o sur ce point‚Ä¶"></textarea>';
    h+='</div>';
  }

  h+='<div class="logi-card"><span class="logi-step-tag">'+step.tag+'</span><h2>'+step.question+'</h2>';
  if(step.choices){
    h+='<div class="logi-choices">';
    for(var i=0;i<step.choices.length;i++){
      var c=step.choices[i];
      h+='<button class="logi-choice-btn" onclick="logiChoose(\''+c.next+'\',\''+c.label+'\')"><div class="logi-choice-icon">'+c.icon+'</div><div><strong>'+c.label+'</strong><span>'+c.desc+'</span></div></button>';
    }
    h+='</div>';
  }
  if(step.yesno){
    h+='<p style="color:#85A7C5;font-size:12px;margin-bottom:14px;margin-top:4px;">Coche tes observations ci-dessus, puis r√©ponds.</p>';
    h+='<div class="logi-yesno"><button class="logi-btn-yes" onclick="logiSaveAndChoose(\''+step.yes+'\',\'‚úÖ Oui\')"><span>‚úÖ</span> Oui</button><button class="logi-btn-no" onclick="logiSaveAndChoose(\''+step.no+'\',\'‚ùå Non\')"><span>‚ùå</span> Non</button></div>';
  }
  h+='</div>';
  if(logi.navHistory.length>0) h+='<div class="logi-nav-btns"><button class="logi-btn-back" onclick="logiBack()">‚Üê Retour</button><button class="logi-btn-restart" onclick="logiRestart()">‚Ü∫ Recommencer</button></div>';
  document.getElementById('logi-tree').innerHTML=h;
  window.scrollTo({top:document.getElementById('logigramme').offsetTop,behavior:'smooth'});
}

function logiSaveAndChoose(nextId,label){ logiSaveObs(logi.currentStep); logiChoose(nextId,label); }
function logiChoose(nextId,label){ logi.navHistory.push(logi.currentStep); if(label) logi.breadcrumbTrail.push(label); logi.currentStep=nextId; logiRender(); }
function logiBack(){ if(logi.navHistory.length>0){ logi.currentStep=logi.navHistory.pop(); if(logi.breadcrumbTrail.length>0&&logi.currentStep!=='ident') logi.breadcrumbTrail.pop(); logiRender(); } }
function logiRestart(){ logi.studentInfo={}; logi.navHistory=[]; logi.breadcrumbTrail=[]; logi.detectedFamily=null; logi.stepObservations={}; logi.objCount=0; logi.indCounters={}; logi.revObjCount=0; logi.revIndCounters={}; logi.currentStep='ident'; logiRender(); }

// ‚îÄ‚îÄ R√©sultat ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function logiRenderResult(fk){
  logi.detectedFamily=fk; var f=LOGI_FAMILIES[fk];
  var h=logiBreadcrumb();
  h+='<div class="logi-result-card" style="background:'+f.bg+';border:1px solid '+f.border+';">';
  h+='<div class="logi-result-header"><div class="logi-family-badge" style="border:1px solid '+f.border+'">'+f.icon+'</div>';
  h+='<div><div class="logi-family-label" style="color:'+f.color+'">Famille '+f.num+' identifi√©e</div><h2 style="color:'+f.color+'">'+f.title+'</h2></div></div>';
  h+='<div class="logi-result-section"><div class="logi-result-section-title" style="color:'+f.color+'">Ce que c\'est</div><p>'+f.description+'</p></div>';
  h+='<div class="logi-result-section"><div class="logi-result-section-title" style="color:'+f.color+'">Signes observables en vid√©o</div><p>'+f.signes+'</p></div>';
  h+='<div class="logi-sep"></div>';
  h+='<div class="logi-obj-box" style="background:rgba(0,0,0,.2);color:'+f.color+';border-left-color:'+f.color+'"><div class="logi-obj-box-lbl">üéØ Objectif de correction</div><p style="color:#ECF0F1">'+f.objectif+'</p></div>';
  h+='<div class="logi-obj-box" style="background:rgba(0,0,0,.2);color:'+f.color+';border-left-color:'+f.color+'"><div class="logi-obj-box-lbl">üîß Piste d\'action</div><p style="color:#ECF0F1">'+f.exercice+'</p></div>';
  h+='</div>';
  h+=logiRenderDeepDive(fk,f);
  h+=logiRenderSummary(f);
  h+=logiRenderRevisedObj(f);
  h+='<div class="logi-nav-btns"><button class="logi-btn-back" onclick="logiBack()">‚Üê Retour</button><button class="logi-btn-restart" onclick="logiRestart()">‚Ü∫ Nouvelle analyse</button></div>';
  document.getElementById('logi-tree').innerHTML=h;
  setTimeout(function(){ logiInitRevObj(); },50);
  window.scrollTo({top:document.getElementById('logigramme').offsetTop,behavior:'smooth'});
}

function logiRenderDeepDive(fk,f){
  var pts=logiGetDeep(fk); if(!pts.length) return '';
  var h='<div class="logi-deep">';
  h+='<div style="font-size:11px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:#85A7C5;margin:18px 0 10px;">Indices d\'observation ‚Äî '+f.title+'</div>';
  h+='<p class="dd-desc">Maintenant que la famille est identifi√©e, observe ta vid√©o plus pr√©cis√©ment. Coche les signes que tu reconnais.</p>';
  h+='<div class="logi-deep-check">';
  for(var i=0;i<pts.length;i++){
    var cid='logi_deep_'+fk+'_'+i;
    h+='<div class="logi-deep-item" id="logi_dci_'+cid+'"><input type="checkbox" id="'+cid+'" data-label="'+logiEsc(pts[i])+'" onchange="logiToggleDeep(this)"><label for="'+cid+'">'+pts[i]+'</label></div>';
  }
  h+='</div>';
  h+='<span class="logi-obs-free-lbl" style="color:#85A7C5">Observations suppl√©mentaires</span>';
  h+='<textarea class="logi-obs-free" id="logi_deep_free_'+fk+'" placeholder="D√©cris avec tes propres mots ce que tu vois dans ta vid√©o‚Ä¶"></textarea>';
  h+='</div>';
  return h;
}

function logiRenderSummary(f){
  var si=logi.studentInfo;
  var dateF=si.date?si.date.split('-').reverse().join('/'):'';
  var h='<div class="logi-summary"><h3>üìå R√©sum√© de mon analyse</h3>';
  h+='<div class="logi-sum-row"><span class="logi-sum-lbl">√âtudiant(e)</span><span class="logi-sum-val">'+logiEsc(si.prenom+' '+si.nom)+'</span></div>';
  h+='<div class="logi-sum-row"><span class="logi-sum-lbl">Date</span><span class="logi-sum-val">'+logiEsc(dateF)+'</span></div>';
  h+='<div class="logi-sum-row"><span class="logi-sum-lbl">S√©ance</span><span class="logi-sum-val">S√©ance n¬∞ '+logiEsc(si.seance)+'</span></div>';
  h+='<div class="logi-sum-row"><span class="logi-sum-lbl">Activit√©</span><span class="logi-sum-val">'+logiEsc(si.activite)+'</span></div>';
  h+='<div class="logi-sum-row"><span class="logi-sum-lbl">Technique</span><span class="logi-sum-val">'+logiEsc(si.technique)+'</span></div>';
  h+='<div class="logi-sum-row"><span class="logi-sum-lbl">Famille identifi√©e</span><span class="logi-sum-val" style="color:'+f.color+';font-weight:600">Famille '+f.num+' ‚Äî '+f.title+'</span></div>';
  h+='<div class="logi-sum-hl"><div class="sh-lbl">üéØ Objectif global initial</div><p>'+logiEsc(si.objGlobal)+'</p></div>';
  if(si.objectives&&si.objectives.length){
    for(var i=0;i<si.objectives.length;i++){
      var obj=si.objectives[i];
      h+='<div class="logi-sum-hl" style="margin-top:8px;background:rgba(26,188,156,.04);border-color:rgba(26,188,156,.15)">';
      h+='<div class="sh-lbl" style="color:var(--teal)">Objectif strat√©gique '+(i+1)+'</div>';
      h+='<p style="font-weight:500;margin-bottom:7px">'+logiEsc(obj.desc)+'</p>';
      if(obj.indicators.length){h+='<ul style="list-style:none;padding:0;margin:0">';for(var j=0;j<obj.indicators.length;j++)h+='<li style="font-size:11px;color:#85A7C5;padding:2px 0 2px 11px;border-left:2px solid rgba(26,188,156,.3);margin-bottom:3px">‚Üí '+logiEsc(obj.indicators[j])+'</li>';h+='</ul>';}
      h+='</div>';
    }
  }
  var obsKeys=Object.keys(logi.stepObservations);
  if(obsKeys.length){
    h+='<div style="margin-top:14px"><div style="font-size:10px;font-weight:700;letter-spacing:.2em;text-transform:uppercase;color:#6C8EA8;margin-bottom:7px">Observations collect√©es pendant l\'analyse</div>';
    var stepLabel={closed_posture:'Posture de d√©part',open_posture:'Posture de d√©part',closed_chain:'Cha√Æne cin√©tique',open_chain:'Cha√Æne cin√©tique',closed_timing:'Timing',closed_tension:'Tension',open_tension:'Tension',closed_transfer:'Transfert',open_transfer:'Transfert',open_anticipation:'Anticipation'};
    for(var k=0;k<obsKeys.length;k++){
      var sk=obsKeys[k]; var so=logi.stepObservations[sk];
      if((so.checked&&so.checked.length)||so.free){
        h+='<div class="logi-obs-sum-block"><div class="osb-lbl">'+(stepLabel[sk]||sk)+'</div>';
        if(so.checked&&so.checked.length){h+='<ul>';for(var ci=0;ci<so.checked.length;ci++)h+='<li>‚Üí '+logiEsc(so.checked[ci])+'</li>';h+='</ul>';}
        if(so.free)h+='<p style="font-size:11px;color:#6C8EA8;margin-top:5px;font-style:italic">'+logiEsc(so.free)+'</p>';
        h+='</div>';
      }
    }
    h+='</div>';
  }
  return h+'</div>';
}

function logiRenderRevisedObj(f){
  var h='<div class="logi-revised">';
  h+='<h3>‚Üª R√©vision de mes objectifs apr√®s analyse</h3>';
  h+='<p class="sec-desc">Sur la base de ta famille identifi√©e (<strong style="color:'+f.color+'">'+f.title+'</strong>), r√©vise tes objectifs pour qu\'ils soient align√©s avec ce que tu as observ√©.</p>';
  h+='<div class="logi-rev-global"><label>üéØ Objectif global r√©vis√© <span class="logi-req">*</span></label>';
  h+='<textarea id="logi-revGlobal" placeholder="R√©√©cris ton objectif global‚Ä¶">'+logiEsc(logi.studentInfo.objGlobal||'')+'</textarea></div>';
  h+='<div id="logi-revObjList"></div>';
  h+='<button class="logi-btn-add-obj" id="logi-btnAddRevObj" onclick="logiAddRevObj()">+ Ajouter un objectif r√©vis√©</button>';
  h+='<div class="logi-action-btns" style="margin-top:20px">';
  h+='<button class="logi-btn-print" onclick="window.print()">üñ®Ô∏è Imprimer</button>';
  h+='<button class="logi-btn-copy-wrap" onclick="logiCopy()">üìã Copier le texte</button>';
  h+='</div>';
  h+='<div class="logi-copy-confirm" id="logi-copyConfirm"></div>';
  h+='<button class="logi-btn-transfer" onclick="logiTransferToForm()">‚úÖ Transf√©rer vers Mon analyse ‚Üí</button>';
  h+='<div id="logi-transfer-confirm" style="text-align:center;font-size:12px;color:#1ABC9C;margin-top:8px;min-height:18px;"></div>';
  h+='</div>';
  return h;
}

function logiInitRevObj(){
  var si=logi.studentInfo; if(!si.objectives)return;
  var list=document.getElementById('logi-revObjList'); if(!list||list.children.length>0)return;
  for(var i=0;i<si.objectives.length;i++) logiAddRevObj(si.objectives[i]);
}
function logiAddRevObj(prefill){
  var list=document.getElementById('logi-revObjList'); if(!list)return;
  var items=list.querySelectorAll('.logi-rev-obj-item'); if(items.length>=5)return;
  logi.revObjCount++; var rid='logi_rev_'+logi.revObjCount;
  var div=document.createElement('div'); div.className='logi-rev-obj-item'; div.id=rid;
  var dv=(prefill&&prefill.desc)?logiEsc(prefill.desc):'';
  div.innerHTML='<label>Objectif strat√©gique r√©vis√© '+(items.length+1)+'</label>'+
    '<input type="text" id="logi_rdesc_'+rid+'" value="'+dv+'" placeholder="D√©cris ton objectif r√©vis√© en lien avec ta famille‚Ä¶">'+
    '<div style="font-size:11px;color:#85A7C5;margin-bottom:7px;font-weight:600;text-transform:uppercase;letter-spacing:.1em">Indicateurs r√©vis√©s <span class="logi-req">*</span></div>'+
    '<div id="logi_rinds_'+rid+'"></div>'+
    '<button class="logi-btn-add-rev-ind" onclick="logiAddRevInd(\''+rid+'\')">+ Ajouter un indicateur</button>';
  list.appendChild(div);
  if(prefill&&prefill.indicators&&prefill.indicators.length){
    for(var j=0;j<prefill.indicators.length;j++) logiAddRevInd(rid,prefill.indicators[j]);
    while(document.querySelectorAll('#logi_rinds_'+rid+' .logi-rev-ind-row').length<3) logiAddRevInd(rid,'');
  } else { logiAddRevInd(rid,''); logiAddRevInd(rid,''); logiAddRevInd(rid,''); }
  var btn=document.getElementById('logi-btnAddRevObj'); if(btn) btn.disabled=(list.querySelectorAll('.logi-rev-obj-item').length>=5);
}
function logiAddRevInd(rid,val){
  var list=document.getElementById('logi_rinds_'+rid); if(!list)return;
  if(!logi.revIndCounters[rid]) logi.revIndCounters[rid]=0; logi.revIndCounters[rid]++;
  var iid=rid+'_ri_'+logi.revIndCounters[rid];
  var row=document.createElement('div'); row.className='logi-rev-ind-row'; row.id=iid;
  row.innerHTML='<input type="text" value="'+logiEsc(val||'')+'" placeholder="Ce que tu vas observer en vid√©o‚Ä¶"><button class="logi-btn-rm-ind" onclick="logiRemoveRevInd(\''+iid+'\')">‚úï</button>';
  list.appendChild(row);
}
function logiRemoveRevInd(iid){ var el=document.getElementById(iid); if(el)el.parentNode.removeChild(el); }

function logiCollectRevObj(){
  var r=[]; var items=document.querySelectorAll('.logi-rev-obj-item');
  for(var i=0;i<items.length;i++){
    var di=items[i].querySelector('input[id^="logi_rdesc_"]'); var desc=di?di.value.trim():'';
    var ii=items[i].querySelectorAll('.logi-rev-ind-row input'); var inds=[];
    for(var j=0;j<ii.length;j++){ var v=ii[j].value.trim(); if(v) inds.push(v); }
    r.push({desc:desc,indicators:inds});
  }
  return r;
}

// ‚îÄ‚îÄ Copier le texte (√† coller dans le formulaire) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function logiCopy(){
  var si=logi.studentInfo; var f=logi.detectedFamily?LOGI_FAMILIES[logi.detectedFamily]:null; if(!f)return;
  var dateF=si.date?si.date.split('-').reverse().join('/'):'';
  var rgEl=document.getElementById('logi-revGlobal'); var revGlobal=rgEl?rgEl.value.trim():'';
  var revObjs=logiCollectRevObj();
  var deepChecks=document.querySelectorAll('.logi-deep-item input:checked');
  var deepFreeEl=document.getElementById('logi_deep_free_'+logi.detectedFamily);
  var deepFree=deepFreeEl?deepFreeEl.value.trim():'';

  var t='ANALYSE VID√âO DE MES HABILET√âS SPORTIVES\n'+'='.repeat(46)+'\n';
  t+='√âtudiant(e)      : '+si.prenom+' '+si.nom+'\n';
  t+='Date            : '+dateF+'\n';
  t+='S√©ance          : '+si.seance+'\n';
  t+='Activit√©        : '+si.activite+'\n';
  t+='Technique       : '+si.technique+'\n'+'-'.repeat(46)+'\n';
  t+='OBJECTIFS INITIAUX\n';
  t+='Objectif global : '+si.objGlobal+'\n\n';
  if(si.objectives){for(var i=0;i<si.objectives.length;i++){t+='Objectif '+(i+1)+' : '+si.objectives[i].desc+'\n';for(var j=0;j<si.objectives[i].indicators.length;j++)t+='  ‚Üí '+si.objectives[i].indicators[j]+'\n';t+='\n';}}
  t+='-'.repeat(46)+'\n';
  t+='OBSERVATIONS COLLECT√âES\n';
  var stepLabel2={closed_posture:'Posture de d√©part',open_posture:'Posture de d√©part',closed_chain:'Cha√Æne cin√©tique',open_chain:'Cha√Æne cin√©tique',closed_timing:'Timing',closed_tension:'Tension',open_tension:'Tension',closed_transfer:'Transfert',open_transfer:'Transfert',open_anticipation:'Anticipation'};
  var obsKeys=Object.keys(logi.stepObservations);
  for(var k=0;k<obsKeys.length;k++){var sk=obsKeys[k];var so=logi.stepObservations[sk];if((so.checked&&so.checked.length)||so.free){t+='\n['+(stepLabel2[sk]||sk)+']\n';if(so.checked)for(var ci=0;ci<so.checked.length;ci++)t+='  ‚úî '+so.checked[ci]+'\n';if(so.free)t+='  Note : '+so.free+'\n';}}
  t+='\n'+'-'.repeat(46)+'\n';
  t+='FAMILLE D\'ERREURS IDENTIFI√âE\n';
  t+='Famille '+f.num+' ‚Äî '+f.title+'\n\n';
  t+='Description : '+f.description+'\n';
  t+='Signes observ√©s : '+f.signes+'\n';
  t+='Objectif de correction : '+f.objectif+'\n';
  t+='Piste d\'action : '+f.exercice+'\n';
  if(deepChecks.length||deepFree){
    t+='\nIndices d\'observation :\n';
    for(var i=0;i<deepChecks.length;i++)t+='  ‚úî '+deepChecks[i].dataset.label+'\n';
    if(deepFree)t+='  Note : '+deepFree+'\n';
  }
  t+='-'.repeat(46)+'\n';
  t+='OBJECTIFS R√âVIS√âS APR√àS ANALYSE\n';
  t+='Objectif global r√©vis√© : '+(revGlobal||'(non rempli)')+'\n\n';
  for(var i=0;i<revObjs.length;i++){t+='Objectif r√©vis√© '+(i+1)+' : '+(revObjs[i].desc||'(non rempli)')+'\n';for(var j=0;j<revObjs[i].indicators.length;j++)t+='  ‚Üí '+revObjs[i].indicators[j]+'\n';t+='\n';}

  if(navigator.clipboard){
    navigator.clipboard.writeText(t).then(function(){
      var el=document.getElementById('logi-copyConfirm');
      if(el){el.textContent='‚úÖ Texte copi√© ! Colle-le dans la section "Observations collect√©es" du formulaire.';setTimeout(function(){el.textContent='';},4000);}
    });
  } else {
    var ta=document.createElement('textarea');ta.value=t;document.body.appendChild(ta);ta.select();document.execCommand('copy');document.body.removeChild(ta);
    var el=document.getElementById('logi-copyConfirm');if(el){el.textContent='‚úÖ Copi√© !';setTimeout(function(){el.textContent='';},3000);}
  }
}

function logiRenderNoError(){
  var h=logiBreadcrumb();
  h+='<div class="logi-card" style="border-color:var(--teal);text-align:center;padding:32px">';
  h+='<div style="font-size:44px;margin-bottom:14px">‚úÖ</div>';
  h+='<span class="logi-step-tag" style="color:var(--teal);display:block;text-align:center">Analyse compl√®te</span>';
  h+='<h2 style="color:var(--teal);text-align:center;margin-bottom:10px">Aucune erreur prioritaire d√©tect√©e</h2>';
  h+='<p style="text-align:center;color:#85A7C5;font-size:13px">Ton mouvement semble bien organis√© sur les six dimensions. Consulte ton enseignant pour aller plus loin.</p>';
  h+='</div>';
  h+='<div class="logi-nav-btns" style="justify-content:center"><button class="logi-btn-restart" onclick="logiRestart()">‚Ü∫ Recommencer</button></div>';
  document.getElementById('logi-tree').innerHTML=h;
}

// Init du logigramme quand son onglet est activ√©
function logiInit(){
  if(!document.getElementById('logi-tree').innerHTML.trim()){
    logiRender();
  }
}
</script>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SUPABASE ‚Äî Configuration
   Conforme Loi 25 Qu√©bec ‚Äî Row Level Security activ√©e
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const SUPABASE_URL  = 'https://wvmsigeoqmrihsisrfnj.supabase.co';
const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind2bXNpZ2VvcW1yaWhzaXNyZm5qIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxNTczMjcsImV4cCI6MjA4NzczMzMyN30.bIVeDCh8ULtyICJv8oZfLiE1pi3bNS0h3L2JGgvfFBU';

// V√©rifier que le SDK est bien charg√©
if (typeof supabase === 'undefined') {
  document.addEventListener('DOMContentLoaded', function() {
    const errEl = document.getElementById('login-error');
    if (errEl) {
      errEl.textContent = 'Erreur de chargement du SDK. Vide le cache (Cmd+Shift+R) et reessaie.';
      errEl.style.display = 'block';
    }
  });
  throw new Error('SDK Supabase non charge');
}

const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STATE GLOBAL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let currentUser     = null;  // objet auth Supabase
let currentProfile  = null;  // { id, prenom, nom, role }
let allItems        = [];    // analyses charg√©es pour le dashboard
let currentItemId   = null;  // ID de l'analyse ouverte dans le modal

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INIT ‚Äî V√©rifier si d√©j√† connect√©
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function appInit() {
  const { data: { session } } = await sb.auth.getSession();
  if (session && session.user) {
    await onLoggedIn(session.user);
  } else {
    document.getElementById('login-screen').classList.remove('hidden');
  }

  // √âcouter les changements d'auth
  sb.auth.onAuthStateChange(async (event, session) => {
    if (event === 'SIGNED_IN' && session?.user) {
      await onLoggedIn(session.user);
    } else if (event === 'SIGNED_OUT') {
      onLoggedOut();
    }
  });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CONNEXION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function doLogin() {
  const email    = document.getElementById('login-email').value.trim();
  const password = document.getElementById('login-password').value;
  const errEl    = document.getElementById('login-error');
  const btn      = document.getElementById('btn-login');

  if (!email || !password) {
    errEl.textContent = 'Courriel et mot de passe requis.';
    errEl.style.display = 'block'; return;
  }
  btn.disabled = true; btn.textContent = 'Connexion...';
  errEl.style.display = 'none';

  const { data, error } = await sb.auth.signInWithPassword({ email, password });
  if (error) {
    errEl.textContent = 'Erreur : ' + (error.message.includes('Invalid') ? 'Courriel ou mot de passe incorrect.' : error.message);
    errEl.style.display = 'block';
    btn.disabled = false; btn.textContent = 'Se connecter';
  }
  // onAuthStateChange g√®re la suite
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INSCRIPTION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function doRegister() {
  const prenom   = document.getElementById('reg-prenom').value.trim();
  const nom      = document.getElementById('reg-nom').value.trim();
  const email    = document.getElementById('reg-email').value.trim();
  const password = document.getElementById('reg-password').value;
  const errEl    = document.getElementById('login-error');
  const btn      = document.getElementById('btn-register');

  if (!prenom || !nom || !email || !password) {
    errEl.textContent = 'Tous les champs sont obligatoires.'; errEl.style.display = 'block'; return;
  }
  if (password.length < 8) {
    errEl.textContent = 'Le mot de passe doit contenir au moins 8 caract√®res.'; errEl.style.display = 'block'; return;
  }
  btn.disabled = true; btn.textContent = 'Cr√©ation...';
  errEl.style.display = 'none';

  const { data, error } = await sb.auth.signUp({
    email, password,
    options: { data: { prenom, nom, role: 'etudiant' } }
  });

  if (error) {
    errEl.textContent = 'Erreur : ' + error.message;
    errEl.style.display = 'block';
    btn.disabled = false; btn.textContent = 'Cr√©er mon compte';
    return;
  }

  // Cr√©er le profil dans la table profiles
  if (data.user) {
    await sb.from('profiles').upsert({
      id: data.user.id, prenom, nom, role: 'etudiant'
    });
  }

  errEl.style.color = '#1ABC9C';
  errEl.textContent = '‚úÖ Compte cr√©√© ! V√©rifie ton courriel pour confirmer. Tu peux te connecter maintenant.';
  errEl.style.display = 'block';
  btn.disabled = false; btn.textContent = 'Cr√©er mon compte';
}

function toggleRegister(show) {
  document.getElementById('login-form-section').style.display   = show ? 'none' : 'block';
  document.getElementById('register-form-section').style.display = show ? 'block' : 'none';
  document.getElementById('login-error').style.display = 'none';
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   APR√àS CONNEXION R√âUSSIE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function onLoggedIn(user) {
  currentUser = user;

  // Charger le profil
  const { data: profile } = await sb.from('profiles').select('*').eq('id', user.id).single();
  
  if (profile) {
    currentProfile = profile;
  } else {
    // Cr√©er profil si inexistant (premier login)
    const meta = user.user_metadata || {};
    const newProfile = {
      id: user.id,
      prenom: meta.prenom || user.email.split('@')[0],
      nom: meta.nom || '',
      role: meta.role || 'etudiant'
    };
    await sb.from('profiles').upsert(newProfile);
    currentProfile = newProfile;
  }

  // Mettre √† jour l'interface
  const displayName = currentProfile.prenom + ' ' + currentProfile.nom;
  document.getElementById('user-display').textContent = displayName;
  
  // R√¥le badge
  const roleBadge = currentProfile.role === 'enseignant'
    ? '<span class="login-role-badge role-enseignant">Enseignant</span>'
    : '<span class="login-role-badge role-etudiant">√âtudiant</span>';
  document.getElementById('user-display').insertAdjacentHTML('afterend', '');

  // Appliquer le r√¥le au body
  document.body.classList.remove('role-etudiant', 'role-enseignant');
  document.body.classList.add('role-' + currentProfile.role);

  // Mettre √† jour la section compte
  document.getElementById('account-email').textContent = 'üìß ' + user.email;
  document.getElementById('account-role').innerHTML = 
    currentProfile.role === 'enseignant'
      ? '<span class="login-role-badge role-enseignant">Enseignant</span>'
      : '<span class="login-role-badge role-etudiant">√âtudiant</span>';

  // Cacher l'√©cran de login
  document.getElementById('login-screen').classList.add('hidden');

  // Pr√©-remplir les champs nom/pr√©nom dans le logigramme
  if (currentProfile.role === 'etudiant') {
    // Attendre que le DOM soit pr√™t
    setTimeout(() => {
      const logiNom = document.getElementById('logi-nom');
      const logiPrenom = document.getElementById('logi-prenom');
      if (logiNom && !logiNom.value) logiNom.value = currentProfile.nom || '';
      if (logiPrenom && !logiPrenom.value) logiPrenom.value = currentProfile.prenom || '';
      // Pr√©-remplir groupe et activit√© depuis la derni√®re analyse
      try {
        const lastGroupe   = localStorage.getItem('lastGroupe');
        const lastActivite = localStorage.getItem('lastActivite');
        const logiGroupe   = document.getElementById('logi-groupe');
        const logiActivite = document.getElementById('logi-activite');
        if (logiGroupe   && lastGroupe)   logiGroupe.value = lastGroupe;
        if (logiActivite && lastActivite) {
          logiActivite.value = lastActivite;
          if (typeof logiPreviewSport === 'function') logiPreviewSport(lastActivite);
        }
      } catch(e) {}
    }, 300);
    checkStudentFeedback();
    // Charger l'historique de l'√©tudiant
    loadStudentHistory();
    // Afficher le logigramme en premier pour l'√©tudiant
    showTab('logigramme', document.querySelector('.tab-btn:nth-child(1)'));
  } else {
    // Enseignant -> dashboard directement
    showTab('dashboard', document.getElementById('tab-dashboard'));
    loadDashboard();
  }
}

function onLoggedOut() {
  currentUser = null; currentProfile = null; allItems = [];
  document.getElementById('login-screen').classList.remove('hidden');
  document.body.classList.remove('role-etudiant', 'role-enseignant');
  document.getElementById('user-display').textContent = 'Connexion...';
}

async function doLogout() {
  await sb.auth.signOut();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   FEEDBACK √âTUDIANT ‚Äî V√©rifier corrections
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function checkStudentFeedback() {
  if (!currentUser) return;
  const { data } = await sb.from('analyses')
    .select('id, famille_erreurs, note, commentaire_prof, statut, created_at')
    .eq('user_id', currentUser.id)
    .eq('statut', 'Corrig√©')
    .order('created_at', { ascending: false })
    .limit(1);

  if (data && data.length > 0) {
    const last = data[0];
    const banner = document.getElementById('feedback-banner');
    if (banner) {
      document.getElementById('feedback-note-val').textContent = last.note ? last.note + '/5' : '‚Äî';
      document.getElementById('feedback-comment-val').textContent = last.commentaire_prof || '(aucun commentaire)';
      banner.classList.add('visible');
    }
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SOUMISSION DU FORMULAIRE ‚Üí Supabase
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
var formTransferData = null;

function logiTransferToForm() {
  if (!logi.detectedFamily) {
    alert('Tu dois compl√©ter le logigramme jusqu\u2019√† l\u2019identification de la famille avant de transf√©rer.');
    return;
  }
  var si = logi.studentInfo;
  var f  = LOGI_FAMILIES[logi.detectedFamily];

  var revGlobalEl = document.getElementById('logi-revGlobal');
  var revGlobal   = revGlobalEl ? revGlobalEl.value.trim() : (si.objGlobal || '');
  var revObjs     = logiCollectRevObj();

  if (!revGlobal) {
    alert('Remplis l\u2019objectif global r√©vis√© avant de transf√©rer.');
    revGlobalEl && revGlobalEl.focus(); return;
  }
  var validObjs = revObjs.filter(function(o){ return o.desc.trim(); });
  if (!validObjs.length) {
    alert('Ajoute au moins 1 objectif strat√©gique r√©vis√© avec ses indicateurs.'); return;
  }
  var errors = [];
  for (var i = 0; i < validObjs.length; i++) {
    var nbInd = validObjs[i].indicators.filter(function(ind){ return ind.trim(); }).length;
    if (nbInd < 3) errors.push("L'objectif strat√©gique " + (i+1) + " doit avoir au moins 3 indicateurs (actuellement : " + nbInd + ").");
  }
  if (errors.length) { alert(errors.join('\n')); return; }
  if (validObjs.length > 4) { alert('Maximum 4 objectifs strat√©giques.'); return; }

  var stepLabel = {closed_posture:'Posture de d√©part',open_posture:'Posture de d√©part',closed_chain:'Cha√Æne cin√©tique',open_chain:'Cha√Æne cin√©tique',closed_timing:'Timing',closed_tension:'Tension',open_tension:'Tension',closed_transfer:'Transfert',open_transfer:'Transfert',open_anticipation:'Anticipation'};
  var obsText = '';
  var obsKeys = Object.keys(logi.stepObservations);
  for (var k = 0; k < obsKeys.length; k++) {
    var sk = obsKeys[k]; var so = logi.stepObservations[sk];
    if ((so.checked && so.checked.length) || so.free) {
      obsText += '[' + (stepLabel[sk]||sk) + ']\n';
      if (so.checked) for (var ci = 0; ci < so.checked.length; ci++) obsText += '  ‚úî ' + so.checked[ci] + '\n';
      if (so.free) obsText += '  Note : ' + so.free + '\n';
      obsText += '\n';
    }
  }
  var deepChecks = document.querySelectorAll('.logi-deep-item input:checked');
  var deepFreeEl = document.getElementById('logi_deep_free_' + logi.detectedFamily);
  var deepFree   = deepFreeEl ? deepFreeEl.value.trim() : '';
  if (deepChecks.length || deepFree) {
    obsText += '[Indices d\'observation ‚Äî ' + f.title + ']\n';
    for (var di = 0; di < deepChecks.length; di++) obsText += '  ‚úî ' + deepChecks[di].dataset.label + '\n';
    if (deepFree) obsText += '  Note : ' + deepFree + '\n';
  }

  var revText = 'Objectif global r√©vis√© : ' + revGlobal + '\n\n';
  for (var i = 0; i < validObjs.length; i++) {
    revText += 'Objectif strat√©gique ' + (i+1) + ' : ' + validObjs[i].desc + '\n';
    for (var j = 0; j < validObjs[i].indicators.length; j++) revText += '  ‚Üí ' + validObjs[i].indicators[j] + '\n';
    revText += '\n';
  }

  formTransferData = {
    nom: si.nom, prenom: si.prenom, date: si.date, seance: si.seance, groupe: si.groupe,
    activite: si.activite, technique: si.technique,
    familleKey: logi.detectedFamily, familleTitle: f.title, familleNum: f.num, familleColor: f.color, familleIcon: f.icon,
    objGlobal: revGlobal, objStrategiques: validObjs, observations: obsText, objRevises: revText
  };

  function setLocked(id, val) {
    var el = document.getElementById(id); if (!el) return;
    el.value = val; el.classList.add('field-locked'); el.setAttribute('readonly', true);
  }
  setLocked('f-activite', si.activite || '');
  setLocked('f-technique', si.technique || '');
  if (si.date) { var df = document.getElementById('f-date'); if(df){df.value=si.date;df.classList.add('field-locked');df.setAttribute('readonly',true);} }
  if (si.seance) { var sf = document.getElementById('f-seance'); if(sf){sf.value=si.seance;sf.classList.add('field-locked');sf.setAttribute('readonly',true);} }
  if (si.groupe) { var gf = document.getElementById('f-groupe'); if(gf){gf.value=si.groupe;gf.classList.add('field-locked');gf.setAttribute('disabled',true);} }

  var familleLabel = 'F' + f.num;
  document.querySelectorAll('input[name="famille"]').forEach(function(r){
    if (r.value.startsWith(familleLabel)) { r.checked = true; }
    r.disabled = true;
  });

  setLocked('f-objectif', revGlobal);
  setLocked('f-observations', obsText);
  setLocked('f-objectifs-rev', revText);

  var banner = document.getElementById('logi-req-banner');
  if (banner) {
    banner.classList.add('done');
    banner.querySelector('strong').textContent = '‚úÖ Logigramme compl√©t√© ‚Äî donn√©es transf√©r√©es';
    banner.querySelector('span').textContent = 'Les champs ci-dessous sont pr√©-remplis depuis ton logigramme.';
    banner.querySelector('.logi-req-goto').textContent = 'Revoir le logigramme';
  }

  var conf = document.getElementById('logi-transfer-confirm');
  if (conf) { conf.textContent = '‚úÖ Donn√©es transf√©r√©es vers "Mon analyse" !'; setTimeout(function(){ conf.textContent=''; }, 4000); }
  if (si.groupe) try { localStorage.setItem('lastGroupe', si.groupe); } catch(e) {}
  showTab('formulaire', document.querySelector('.tab-btn:nth-child(2)'));
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   VALIDATION + SOUMISSION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function validateForm() {
  var errors = [];
  if (!formTransferData) {
    errors.push('‚ö†Ô∏è Tu dois d\u2019abord compl√©ter le logigramme et cliquer "Transf√©rer vers Mon analyse".');
    return errors;
  }
  if (!document.querySelector('input[name="stade-avant"]:checked'))
    errors.push('‚ö†Ô∏è S√©lectionne ton stade de ma√Ætrise AVANT la correction.');
  if (!document.querySelector('input[name="stade-apres"]:checked'))
    errors.push('‚ö†Ô∏è S√©lectionne ton stade de ma√Ætrise APR√àS la correction.');
  if (!document.getElementById('f-just-avant').value.trim())
    errors.push('‚ö†Ô∏è Justifie ton stade AVANT.');
  if (!document.getElementById('f-just-apres').value.trim())
    errors.push('‚ö†Ô∏è Justifie ton stade APR√àS.');
  if (!document.getElementById('f-vid-avant').value.trim())
    errors.push('‚ö†Ô∏è Ajoute le lien de ta vid√©o initiale (AVANT).');
  if (!document.getElementById('f-vid-apres').value.trim())
    errors.push('‚ö†Ô∏è Ajoute le lien de ta vid√©o finale (APR√àS).');
  if (!document.getElementById('f-edu1').value.trim())
    errors.push('‚ö†Ô∏è Ajoute au moins un exercice √©ducatif (√âducatif 1).');
  if (!document.getElementById('f-q1').value.trim())
    errors.push('‚ö†Ô∏è R√©ponds √† la question Q1.');
  return errors;
}

async function submitForm(e) {
  e.preventDefault();
  document.getElementById('form-error').style.display = 'none';

  if (!currentUser) {
    document.getElementById('form-error').innerHTML = '‚ö†Ô∏è Tu dois √™tre connect√© pour soumettre une analyse.';
    document.getElementById('form-error').style.display = 'block'; return;
  }

  var errors = validateForm();
  if (errors.length) {
    var errEl = document.getElementById('form-error');
    errEl.innerHTML = errors.join('<br>');
    errEl.style.display = 'block';
    window.scrollTo({ top: 0, behavior: 'smooth' }); return;
  }

  const btn = document.getElementById('btn-submit');
  btn.disabled = true; btn.textContent = 'Envoi en cours...';
  // S√©curit√© : r√©activer le bouton apr√®s 15s si rien ne se passe
  const submitTimeout = setTimeout(() => {
    btn.disabled = false; btn.textContent = 'Soumettre mon analyse';
    const errEl = document.getElementById('form-error');
    errEl.textContent = '‚ö†Ô∏è L\'envoi a pris trop de temps. V√©rifie ta connexion et r√©essaie.';
    errEl.style.display = 'block';
  }, 15000);

  const famille = document.querySelector('input[name="famille"]:checked')?.value || '';
  const stadeAv = document.querySelector('input[name="stade-avant"]:checked')?.value || '';
  const stadeAp = document.querySelector('input[name="stade-apres"]:checked')?.value || '';
  const td = formTransferData;

  const record = {
    user_id:              currentUser.id,
    etudiant_nom:         (currentProfile?.prenom || '') + ' ' + (currentProfile?.nom || ''),
    groupe:               (formTransferData?.groupe || document.getElementById('f-groupe').value || ''),
    seance:               document.getElementById('f-seance').value,
    activite:             document.getElementById('f-activite').value,
    technique:            document.getElementById('f-technique').value,
    famille_erreurs:      famille,
    stade_avant:          stadeAv,
    stade_apres:          stadeAp,
    objectif_global:      document.getElementById('f-objectif').value,
    objectifs_revises:    document.getElementById('f-objectifs-rev').value,
    observations:         document.getElementById('f-observations').value,
    justification_avant:  document.getElementById('f-just-avant').value,
    justification_apres:  document.getElementById('f-just-apres').value,
    lien_video_avant:     document.getElementById('f-vid-avant').value,
    lien_video_apres:     document.getElementById('f-vid-apres').value,
    lien_educatif1:       document.getElementById('f-edu1').value,
    lien_educatif2:       document.getElementById('f-edu2').value,
    lien_educatif3:       document.getElementById('f-edu3').value,
    desc_educatifs:       document.getElementById('f-edu-desc').value,
    q1:                   document.getElementById('f-q1').value,
    q2:                   document.getElementById('f-q2').value,
    q3:                   document.getElementById('f-q3').value,
    q4:                   document.getElementById('f-q4').value,
    plan_avant:           document.getElementById('f-plan-avant').value,
    plan_apres:           document.getElementById('f-plan-apres').value,
    statut:               'En attente',
    date_soumission:      new Date().toISOString(),
  };

  try {
    const { data, error } = await sb.from('analyses').insert([record]).select().single();
    if (error) throw error;
    clearTimeout(submitTimeout);
    btn.disabled = false; btn.textContent = 'Soumettre mon analyse';
    showSuccess(record, stadeAv, stadeAp);
  } catch(err) {
    const msg = err?.message || err?.error_description || JSON.stringify(err) || 'Erreur inconnue';
    const errEl = document.getElementById('form-error');
    errEl.innerHTML = '‚ö†Ô∏è Erreur lors de l\'envoi : <strong>' + msg + '</strong><br><small>V√©rifie ta connexion et r√©essaie.</small>';
    errEl.style.display = 'block';
    window.scrollTo({ top: 0, behavior: 'smooth' });
    clearTimeout(submitTimeout);
    btn.disabled = false; btn.textContent = 'Soumettre mon analyse';
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   BROUILLON
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function saveBrouillon() {
  if (!currentUser) { alert('Tu dois √™tre connect√©.'); return; }
  const btn = document.getElementById('btn-brouillon');
  btn.disabled = true; btn.textContent = 'üíæ Sauvegarde...';

  const famille = document.querySelector('input[name="famille"]:checked')?.value || '';
  const stadeAv = document.querySelector('input[name="stade-avant"]:checked')?.value || '';
  const stadeAp = document.querySelector('input[name="stade-apres"]:checked')?.value || '';

  const record = {
    user_id:           currentUser.id,
    etudiant_nom:      (currentProfile?.prenom || '') + ' ' + (currentProfile?.nom || ''),
    groupe:            (formTransferData?.groupe || document.getElementById('f-groupe')?.value || ''),
    seance:            document.getElementById('f-seance')?.value || '',
    activite:          document.getElementById('f-activite')?.value || '',
    technique:         document.getElementById('f-technique')?.value || '',
    famille_erreurs:   famille,
    stade_avant:       stadeAv,
    stade_apres:       stadeAp,
    objectif_global:   document.getElementById('f-objectif')?.value || '',
    objectifs_revises: document.getElementById('f-objectifs-rev')?.value || '',
    observations:      document.getElementById('f-observations')?.value || '',
    justification_avant: document.getElementById('f-just-avant')?.value || '',
    justification_apres: document.getElementById('f-just-apres')?.value || '',
    lien_video_avant:  document.getElementById('f-vid-avant')?.value || '',
    lien_video_apres:  document.getElementById('f-vid-apres')?.value || '',
    lien_educatif1:    document.getElementById('f-edu1')?.value || '',
    lien_educatif2:    document.getElementById('f-edu2')?.value || '',
    lien_educatif3:    document.getElementById('f-edu3')?.value || '',
    desc_educatifs:    document.getElementById('f-edu-desc')?.value || '',
    q1:                document.getElementById('f-q1')?.value || '',
    q2:                document.getElementById('f-q2')?.value || '',
    q3:                document.getElementById('f-q3')?.value || '',
    q4:                document.getElementById('f-q4')?.value || '',
    plan_avant:        document.getElementById('f-plan-avant')?.value || '',
    plan_apres:        document.getElementById('f-plan-apres')?.value || '',
    statut:            'Brouillon',
    date_soumission:   new Date().toISOString(),
  };

  try {
    const { error } = await sb.from('analyses').insert([record]);
    if (error) throw error;
    btn.textContent = '‚úÖ Brouillon sauvegard√© !';
    setTimeout(() => { btn.disabled = false; btn.textContent = 'üíæ Compl√©ter plus tard'; }, 3000);
    loadStudentHistory();
  } catch(err) {
    btn.disabled = false; btn.textContent = 'üíæ Compl√©ter plus tard';
    alert('Erreur : ' + (err.message || JSON.stringify(err)));
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SUCC√àS SOUMISSION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function showSuccess(fields, stadeAv, stadeAp) {
  var td = formTransferData || {};
  var dateF = '';
  if (td.date) { var dp=td.date.split('-'); dateF=dp[2]+'/'+dp[1]+'/'+dp[0]; }

  var h = '';
  h += '<div class="fsumm-section"><div class="fsumm-section-title">Identification</div>';
  h += '<div class="fsumm-row"><span class="fsumm-lbl">Activit√©</span><span class="fsumm-val">' + esc(td.activite||'') + '</span></div>';
  h += '<div class="fsumm-row"><span class="fsumm-lbl">Technique analys√©e</span><span class="fsumm-val">' + esc(td.technique||'') + '</span></div>';
  h += '<div class="fsumm-row"><span class="fsumm-lbl">S√©ance</span><span class="fsumm-val">' + esc(td.seance||'') + '</span></div>';
  h += '<div class="fsumm-row"><span class="fsumm-lbl">Date</span><span class="fsumm-val">' + esc(dateF) + '</span></div></div>';

  h += '<div class="fsumm-section"><div class="fsumm-section-title">Famille d&#x27;erreurs identifi√©e</div>';
  h += '<div class="fsumm-famille-badge"><span style="font-size:22px">' + (td.familleIcon||'') + '</span>';
  h += '<span style="font-size:13px;font-weight:700;color:' + (td.familleColor||'#fff') + '">Famille ' + (td.familleNum||'') + ' ‚Äî ' + esc(td.familleTitle||'') + '</span></div></div>';

  h += '<div class="fsumm-section"><div class="fsumm-section-title">Objectifs</div>';
  h += '<div class="fsumm-row" style="margin-bottom:14px"><span class="fsumm-lbl">Objectif global r√©vis√©</span><span class="fsumm-val">' + esc(td.objGlobal||'') + '</span></div>';
  if (td.objStrategiques && td.objStrategiques.length) {
    for (var i = 0; i < td.objStrategiques.length; i++) {
      var obj = td.objStrategiques[i];
      h += '<div class="fsumm-obj-block"><div class="fsumm-obj-title">Objectif strat√©gique ' + (i+1) + '</div>';
      h += '<div class="fsumm-obj-desc">' + esc(obj.desc) + '</div>';
      for (var j = 0; j < obj.indicators.length; j++) h += '<div class="fsumm-ind">‚Üí ' + esc(obj.indicators[j]) + '</div>';
      h += '</div>';
    }
  }
  h += '</div>';

  h += '<div class="fsumm-section"><div class="fsumm-section-title">Stades de ma√Ætrise</div>';
  h += '<div class="fsumm-row"><span class="fsumm-lbl">Stade AVANT</span><span class="fsumm-val">' + esc(stadeAv||'') + '</span></div>';
  h += '<div class="fsumm-row"><span class="fsumm-lbl">Stade APR√àS</span><span class="fsumm-val">' + esc(stadeAp||'') + '</span></div></div>';

  h += '<div class="fsumm-section"><div class="fsumm-section-title">Vid√©os</div>';
  ['lien_video_avant','lien_video_apres','lien_educatif1'].forEach(function(k, i) {
    var labels = ['Vid√©o AVANT','Vid√©o APR√àS','√âducatif 1'];
    if (fields[k]) h += '<div class="fsumm-row"><span class="fsumm-lbl">' + labels[i] + '</span><span class="fsumm-val"><a href="' + esc(fields[k]) + '" target="_blank" style="color:var(--accent)">' + esc(fields[k]) + '</a></span></div>';
  });
  h += '</div>';

  h += '<div class="fsumm-section"><div class="fsumm-section-title">R√©flexion personnelle</div>';
  ['q1','q2','q3','q4'].forEach(function(k, i) {
    if (fields[k]) h += '<div class="fsumm-row"><span class="fsumm-lbl">Q'+(i+1)+'</span><span class="fsumm-val">'+esc(fields[k])+'</span></div>';
  });
  h += '</div>';

  document.getElementById('fsumm-body').innerHTML = h;
  document.getElementById('analyse-form').style.display = 'none';
  document.getElementById('form-summary').style.display = 'block';
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function esc(s) { return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

function fsummCopy() {
  var td = formTransferData || {};
  var stAv = document.querySelector('input[name="stade-avant"]:checked');
  var stAp = document.querySelector('input[name="stade-apres"]:checked');
  var t = 'ANALYSE VID√âO ‚Äî R√âSUM√â COMPLET\n' + '='.repeat(48) + '\n';
  t += 'Activit√©   : ' + (td.activite||'') + '\n';
  t += 'Technique  : ' + (td.technique||'') + '\n';
  t += "FAMILLE D'ERREURS : Famille " + (td.familleNum||'') + ' ‚Äî ' + (td.familleTitle||'') + '\n\n';
  t += 'OBJECTIF GLOBAL R√âVIS√â\n' + (td.objGlobal||'') + '\n\n';
  if (td.objStrategiques) {
    t += 'OBJECTIFS STRAT√âGIQUES\n';
    td.objStrategiques.forEach(function(o,i){ t+=(i+1)+'. '+o.desc+'\n'; o.indicators.forEach(function(ind){ t+='   ‚Üí '+ind+'\n'; }); t+='\n'; });
  }
  if (navigator.clipboard) {
    navigator.clipboard.writeText(t).then(function(){
      var conf=document.getElementById('fsumm-copy-confirm');
      if(conf){conf.textContent='‚úÖ R√©sum√© copi√© !';setTimeout(function(){conf.textContent='';},3500);}
    });
  }
}

function fsummReset() {
  document.getElementById('form-summary').style.display = 'none';
  document.getElementById('analyse-form').style.display = 'block';
  document.getElementById('analyse-form').reset();
  formTransferData = null;
  document.querySelectorAll('.field-locked').forEach(function(el){
    el.classList.remove('field-locked'); el.removeAttribute('readonly');
  });
  document.querySelectorAll('input[name="famille"]').forEach(function(r){ r.disabled = false; r.checked = false; });
  var banner = document.getElementById('logi-req-banner');
  if (banner) {
    banner.classList.remove('done');
    banner.querySelector('strong').textContent = 'Logigramme obligatoire avant la soumission';
    banner.querySelector('span').textContent = "Tu dois compl√©ter le logigramme d'identification pour pouvoir soumettre ton analyse.";
    banner.querySelector('.logi-req-goto').textContent = 'Aller au logigramme ‚Üí';
  }
  window.scrollTo({top:0,behavior:'smooth'});
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TABLEAU DE BORD ENSEIGNANT ‚Äî Charger
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function loadDashboard() {
  document.getElementById('refresh-icon').textContent = '‚è≥';
  document.getElementById('dash-error').style.display = 'none';

  if (!currentUser || currentProfile?.role !== 'enseignant') {
    document.getElementById('table-body').innerHTML =
      '<div style="padding:1.5rem;color:var(--orange);font-size:0.88rem">‚ö†Ô∏è Acc√®s r√©serv√© aux enseignants.</div>';
    document.getElementById('refresh-icon').textContent = 'üîÑ';
    return;
  }

  try {
    const { data, error } = await sb.from('analyses')
      .select('*')
      .order('date_soumission', { ascending: false })
      .limit(200);

    if (error) throw error;
    allItems = data || [];
    renderDashboard(allItems);
  } catch(err) {
    document.getElementById('dash-error').textContent = '‚ö†Ô∏è ' + err.message;
    document.getElementById('dash-error').style.display = 'block';
    loadDemoData();
  }
  document.getElementById('refresh-icon').textContent = 'üîÑ';
}

function applyFilters() {
  const e = (document.getElementById('filter-etudiant')?.value || '').toLowerCase();
  const g = document.getElementById('filter-groupe').value;
  const s = document.getElementById('filter-statut').value;
  const f = document.getElementById('filter-famille').value;
  const filtered = allItems.filter(item =>
    (!e || (item.etudiant_nom||'').toLowerCase().includes(e)) &&
    (!g || (item.groupe||'') === g) &&
    (!s || (item.statut||'') === s) &&
    (!f || (item.famille_erreurs||'').startsWith(f))
  );
  renderDashboard(filtered);
}

function renderDashboard(items) {
  const total    = items.length;
  const corriges = items.filter(i => i.statut === 'Corrig√©').length;
  const attente  = items.filter(i => i.statut === 'En attente').length;
  const notes    = items.filter(i => i.note).map(i => parseFloat(i.note));
  const moy      = notes.length ? (notes.reduce((a,b)=>a+b,0)/notes.length).toFixed(1) : '‚Äî';

  document.getElementById('kpi-grid').innerHTML = `
    <div class="kpi"><div class="kpi-value" style="color:var(--accent)">${total}</div><div class="kpi-label">Analyses re√ßues</div></div>
    <div class="kpi"><div class="kpi-value" style="color:var(--green)">${corriges}</div><div class="kpi-label">Corrig√©es</div></div>
    <div class="kpi"><div class="kpi-value" style="color:var(--gold)">${attente}</div><div class="kpi-label">En attente</div></div>
    <div class="kpi"><div class="kpi-value" style="color:var(--teal)">${moy}</div><div class="kpi-label">Note moy. /5</div></div>
  `;
  document.getElementById('charts-grid').style.display = 'grid';

  const fCount = {};
  items.forEach(i => { const f=(i.famille_erreurs||'').split('‚Äî')[0].trim(); if(f) fCount[f]=(fCount[f]||0)+1; });
  const fSorted = Object.entries(fCount).sort((a,b)=>b[1]-a[1]);
  const maxF = fSorted[0]?.[1] || 1;
  document.getElementById('chart-familles').innerHTML = fSorted.map(([k,v]) =>
    `<div class="bar-row"><div class="bar-label">${k}</div><div class="bar-track"><div class="bar-fill" style="width:${Math.round(v/maxF*100)}%">${Math.round(v/maxF*100)}%</div></div><div class="bar-count">${v}</div></div>`
  ).join('') || '<div style="color:var(--gray);font-size:0.85rem;padding:0.5rem">Aucune donn√©e</div>';

  renderDonut('donut-avant', 'legend-avant', items, i => i.stade_avant || '');
  renderDonut('donut-apres', 'legend-apres', items, i => i.stade_apres || '');

  document.getElementById('table-body').innerHTML = items.length
    ? items.map((item,idx) => {
        const stadeAvBadge = stadeClass(item.stade_avant||'');
        const stadeApBadge = stadeClass(item.stade_apres||'');
        const statBadge    = item.statut==='Corrig√©'
          ? '<span class="badge badge-ok">‚úÖ Corrig√©</span>'
          : item.statut==='Brouillon'
          ? '<span class="badge" style="background:rgba(255,255,255,0.07);color:rgba(255,255,255,0.5);border:1px solid rgba(255,255,255,0.15);">‚úèÔ∏è Brouillon</span>'
          : '<span class="badge badge-att">‚è≥ En attente</span>';
        const vidLink = item.lien_video_avant
          ? `<a href="${item.lien_video_avant}" target="_blank" style="color:var(--teal);font-size:0.8rem">‚ñ∂ Voir</a>`
          : '‚Äî';
        return `<div class="table-row" onclick="openModal(${idx})">
          <div>üéì ${item.etudiant_nom||'‚Äî'}</div>
          <div style="font-size:0.78rem">${(item.famille_erreurs||'‚Äî').split('‚Äî')[0]}</div>
          <div>${stadeAvBadge}</div>
          <div>${stadeApBadge}</div>
          <div>${item.note ? item.note+'/5' : '‚Äî'}</div>
          <div>${statBadge}</div>
          <div>${vidLink}</div>
        </div>`;
      }).join('')
    : '<div style="padding:1.5rem;color:var(--gray);font-size:0.88rem">Aucune analyse trouv√©e.</div>';
}

function stadeClass(s) {
  if (!s) return '‚Äî';
  if (s.includes('1')) return `<span class="badge badge-s1">Verrouillage</span>`;
  if (s.includes('2')) return `<span class="badge badge-s2">Exploration</span>`;
  if (s.includes('3')) return `<span class="badge badge-s3">Exploitation</span>`;
  return s;
}

function renderDonut(svgId, legendId, items, accessor) {
  const counts = {s1:0, s2:0, s3:0};
  items.forEach(i => {
    const v = (typeof accessor === 'function') ? accessor(i) : (i[accessor] || '');
    if (v.includes('1')) counts.s1++;
    else if (v.includes('2')) counts.s2++;
    else if (v.includes('3')) counts.s3++;
  });
  const total = counts.s1+counts.s2+counts.s3 || 1;
  const colors = ['#E74C3C','#E67E22','#27AE60'];
  const vals = [counts.s1,counts.s2,counts.s3];
  let offset = 25;
  const paths = vals.map((v,i) => {
    const pct = v/total; const len = pct * 100;
    const p = `<circle cx="18" cy="18" r="15.9" fill="none" stroke="${colors[i]}" stroke-width="4" stroke-dasharray="${len} ${100-len}" stroke-dashoffset="${100-offset+25}" transform="rotate(-90 18 18)"/>`;
    offset += len; return p;
  });
  document.getElementById(svgId).innerHTML =
    `<circle cx="18" cy="18" r="15.9" fill="none" stroke="rgba(255,255,255,0.06)" stroke-width="4"/>` +
    paths.join('') + `<circle cx="18" cy="18" r="10" fill="#1B2E40"/>`;
  const labels = ['Stade 1 ‚Äî Verrouillage','Stade 2 ‚Äî Exploration','Stade 3 ‚Äî Exploitation'];
  document.getElementById(legendId).innerHTML = vals.map((v,i) =>
    `<div class="donut-legend-item"><div class="donut-dot" style="background:${colors[i]}"></div>${labels[i]}: ${Math.round(v/total*100)}%</div>`
  ).join('');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DONN√âES D√âMO (si pas de connexion)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function loadDemoData() {
  allItems = [
    {id:1, etudiant_nom:'Tremblay, Alex',  groupe:'Groupe 01', seance:'S√©ance 2', activite:'Natation',   technique:'Crawl ‚Äî Entr√©e de bras',  famille_erreurs:'F1 ‚Äî Rupture de la cha√Æne cin√©tique',     stade_avant:'Stade 1 ‚Äî Verrouillage', stade_apres:'Stade 2 ‚Äî Exploration',  note:'4',   statut:'Corrig√©',     lien_video_avant:'https://youtube.com'},
    {id:2, etudiant_nom:'Gagnon, Marie',   groupe:'Groupe 01', seance:'S√©ance 3', activite:'Volleyball', technique:'Service par en haut',      famille_erreurs:'F3 ‚Äî D√©salignement segmentaire',           stade_avant:'Stade 2 ‚Äî Exploration',  stade_apres:'Stade 3 ‚Äî Exploitation', note:'4.5', statut:'Corrig√©',     lien_video_avant:'https://youtube.com'},
    {id:3, etudiant_nom:'Roy, Simon',      groupe:'Groupe 02', seance:'S√©ance 2', activite:'Basketball', technique:'Tir en suspension',        famille_erreurs:'F6 ‚Äî Timing / synchronisation d√©ficiente', stade_avant:'Stade 1 ‚Äî Verrouillage', stade_apres:'Stade 1 ‚Äî Verrouillage', note:'',    statut:'En attente',  lien_video_avant:''},
    {id:4, etudiant_nom:'Leblanc, Sofia',  groupe:'Groupe 02', seance:'S√©ance 3', activite:'Natation',   technique:'Virage culbute',           famille_erreurs:"F2 ‚Äî Mauvais transfert d'√©nergie",        stade_avant:'Stade 1 ‚Äî Verrouillage', stade_apres:'Stade 2 ‚Äî Exploration',  note:'',    statut:'En attente',  lien_video_avant:'https://youtube.com'},
    {id:5, etudiant_nom:'C√¥t√©, Maxime',    groupe:'Groupe 03', seance:'S√©ance 1', activite:'Volleyball', technique:'Manchette',                famille_erreurs:'F4 ‚Äî Manque de rel√¢chement musculaire',    stade_avant:'Stade 3 ‚Äî Exploitation', stade_apres:'Stade 3 ‚Äî Exploitation', note:'5',   statut:'Corrig√©',     lien_video_avant:'https://youtube.com'},
  ];
  renderDashboard(allItems);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MODAL CORRECTION ENSEIGNANT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openModal(idx) {
  const item = allItems[idx];
  if (!item) return;
  currentItemId = item.id || null;

  const vid = (url, label) => url
    ? `<a class="modal-video-link" href="${url}" target="_blank">‚ñ∂ ${label}</a>`
    : `<span style="color:var(--gray)">Non fourni</span>`;

  document.getElementById('modal-title').textContent = `Correction ‚Äî ${item.etudiant_nom||'√âtudiant'}`;
  document.getElementById('modal-content').innerHTML = `
    <div class="modal-section">
      <div class="modal-section-label">Informations</div>
      <div class="modal-value">${item.groupe||''} ¬∑ ${item.seance||''} ¬∑ ${item.activite||''} ‚Äî ${item.technique||''}</div>
    </div>
    <div class="modal-section">
      <div class="modal-section-label">Famille d'erreurs</div>
      <div class="modal-value">${item.famille_erreurs||'‚Äî'}</div>
    </div>
    <div class="modal-section">
      <div class="modal-section-label">Stades Newell</div>
      <div class="modal-value">AVANT : ${item.stade_avant||'‚Äî'} ‚Üí APR√àS : ${item.stade_apres||'‚Äî'}</div>
    </div>
    <div class="modal-section">
      <div class="modal-section-label">Vid√©os</div>
      <div class="modal-value" style="display:flex;gap:1rem;flex-wrap:wrap">
        ${vid(item.lien_video_avant,'Vid√©o AVANT')}
        ${vid(item.lien_video_apres,'Vid√©o APR√àS')}
        ${vid(item.lien_educatif1,'√âducatif 1')}
        ${vid(item.lien_educatif2,'√âducatif 2')}
        ${vid(item.lien_educatif3,'√âducatif 3')}
      </div>
    </div>
    <div class="modal-section">
      <div class="modal-section-label">R√©flexions (Q1‚ÄìQ4)</div>
      <div class="modal-value" style="font-size:0.82rem">
        <strong>Q1</strong> ${item.q1||'‚Äî'}<br><br>
        <strong>Q2</strong> ${item.q2||'‚Äî'}<br><br>
        <strong>Q3</strong> ${item.q3||'‚Äî'}<br><br>
        <strong>Q4</strong> ${item.q4||'‚Äî'}
      </div>
    </div>
    <div class="modal-section">
      <div class="modal-section-label">Ajouter / modifier la correction</div>
      <div class="modal-note-area">
        <div>
          <label style="font-size:0.75rem;color:#A9CCE3;display:block;margin-bottom:0.3rem">Note /5</label>
          <input type="number" class="note-input" id="modal-note" min="0" max="5" step="0.5"
            value="${item.note||''}" placeholder="‚Äî" />
        </div>
        <div>
          <label style="font-size:0.75rem;color:#A9CCE3;display:block;margin-bottom:0.3rem">Commentaire</label>
          <textarea class="comment-input" id="modal-comment"
            placeholder="Ton feedback pour l'√©tudiant...">${item.commentaire_prof||''}</textarea>
        </div>
      </div>
      <button class="btn-save" id="btn-save-correction" onclick="saveCorrection()">
        üíæ Sauvegarder et envoyer le feedback
      </button>
    </div>
  `;
  document.getElementById('modal').classList.add('open');
}

function closeModal() {
  document.getElementById('modal').classList.remove('open');
  currentItemId = null;
}

async function saveCorrection() {
  const btn     = document.getElementById('btn-save-correction');
  btn.disabled  = true; btn.textContent = 'Sauvegarde...';

  const note    = document.getElementById('modal-note').value;
  const comment = document.getElementById('modal-comment').value;

  try {
    if (currentItemId) {
      const { error } = await sb.from('analyses').update({
        note:              note ? parseFloat(note) : null,
        commentaire_prof:  comment,
        statut:            'Corrig√©',
        date_correction:   new Date().toISOString(),
      }).eq('id', currentItemId);
      if (error) throw error;
    }
    const item = allItems.find(i => i.id == currentItemId);
    if (item) { item.note = note; item.commentaire_prof = comment; item.statut = 'Corrig√©'; }
    closeModal();
    renderDashboard(allItems);
    btn.textContent = 'üíæ Sauvegarder et envoyer le feedback';
    btn.disabled = false;
  } catch(e) {
    btn.textContent = '‚ö†Ô∏è Erreur ‚Äî r√©essayer';
    btn.disabled = false;
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   NAVIGATION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function loadStudentHistory() {
  const container = document.getElementById('historique-list');
  if (!container) return;
  container.innerHTML = '<div class="loading"><div class="spinner"></div> Chargement...</div>';

  const { data, error } = await sb.from('analyses')
    .select('*')
    .order('date_soumission', { ascending: false });

  if (error || !data || data.length === 0) {
    container.innerHTML = "<div style='color:var(--gray);padding:2rem;text-align:center;'>Tu n'as pas encore soumis d'analyse.<br><br><button class='btn-refresh' onclick=\"showTab('formulaire', document.querySelector('.tab-btn'))\">‚Üí Faire mon premier d√©p√¥t</button></div>";
    return;
  }

  // M√©moriser les infos de la derni√®re analyse pour pr√©-remplir le logigramme
  if (data.length > 0) {
    const last = data[0];
    try {
      if (last.groupe) localStorage.setItem('lastGroupe', last.groupe);
      if (last.activite) localStorage.setItem('lastActivite', last.activite);
      // Pr√©-remplir les champs du logigramme si encore vides
      setTimeout(() => {
        const lg = document.getElementById('logi-groupe');
        const la = document.getElementById('logi-activite');
        if (lg && !lg.value && last.groupe) lg.value = last.groupe;
        if (la && !la.value && last.activite) la.value = last.activite;
        logiPreviewSport && logiPreviewSport(last.activite || '');
      }, 100);
    } catch(e) {}
  }

  container.innerHTML = data.map(item => {
    const date = item.date_soumission ? new Date(item.date_soumission).toLocaleDateString('fr-CA') : '‚Äî';
    const statBadge = item.statut === 'Corrig√©'
      ? '<span class="badge badge-ok">‚úÖ Corrig√©</span>'
      : item.statut === 'Brouillon'
      ? '<span class="badge" style="background:rgba(255,255,255,0.07);color:rgba(255,255,255,0.5);border:1px solid rgba(255,255,255,0.15);font-weight:700;">‚úèÔ∏è Brouillon</span>'
      : '<span class="badge badge-att">‚è≥ En attente</span>';
    const noteBadge = item.note
      ? `<span style="background:rgba(46,134,193,0.2);color:var(--accent);padding:2px 10px;border-radius:20px;font-weight:700;">${item.note}/5</span>`
      : '';
    const correction = item.commentaire_prof
      ? `<div style="margin-top:0.8rem;padding:0.8rem;background:rgba(26,188,156,0.1);border-left:3px solid var(--teal);border-radius:4px;font-size:0.85rem;color:#A9CCE3;">
           <div style="font-size:0.75rem;color:var(--teal);font-weight:700;margin-bottom:4px;">üí¨ Commentaire de l'enseignant</div>
           ${item.commentaire_prof}
         </div>` : '';
    return `<div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:1.2rem;margin-bottom:1rem;">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:0.5rem;">
        <div>
          <div style="font-weight:700;color:var(--text);font-size:1rem;">${item.activite||'‚Äî'} ‚Äî ${item.technique||'‚Äî'}</div>
          <div style="font-size:0.8rem;color:var(--gray);margin-top:2px;">${item.groupe||''} ¬∑ ${item.seance||''} ¬∑ ${date}</div>
        </div>
        <div style="display:flex;gap:0.5rem;align-items:center;">${noteBadge} ${statBadge}</div>
      </div>
      <div style="margin-top:0.7rem;font-size:0.85rem;color:var(--accent);">${(item.famille_erreurs||'‚Äî')}</div>
      <div style="display:flex;gap:1rem;margin-top:0.4rem;font-size:0.8rem;color:var(--gray);">
        <span>Avant : <strong style="color:var(--text)">${(item.stade_avant||'‚Äî').replace('Stade 1 ‚Äî ','').replace('Stade 2 ‚Äî ','').replace('Stade 3 ‚Äî ','')}</strong></span>
        <span>Apr√®s : <strong style="color:var(--text)">${(item.stade_apres||'‚Äî').replace('Stade 1 ‚Äî ','').replace('Stade 2 ‚Äî ','').replace('Stade 3 ‚Äî ','')}</strong></span>
      </div>
      ${correction}
    </div>`;
  }).join('');
}

function showTab(id, btn) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  if(btn) btn.classList.add('active');
  if(id==='dashboard') loadDashboard();
  if(id==='historique') loadStudentHistory();
  if(id==='logigramme') logiInit();
}

document.querySelectorAll('.radio-item input').forEach(inp => {
  inp.addEventListener('change', () => {
    const group = inp.name;
    document.querySelectorAll(`input[name="${group}"]`).forEach(r => {
      r.closest('.radio-item').classList.toggle('selected', r.checked);
    });
  });
});

document.addEventListener('keydown', e => { if(e.key==='Escape') closeModal(); });
document.getElementById('modal').addEventListener('click', e => {
  if(e.target === document.getElementById('modal')) closeModal();
});

// Fermer login avec Enter
document.addEventListener('keydown', e => {
  if (e.key === 'Enter') {
    if (document.getElementById('register-form-section').style.display !== 'none') {
      doRegister();
    } else if (!document.getElementById('login-screen').classList.contains('hidden')) {
      doLogin();
    }
  }
});

// Init
appInit();
</script>
</body>
</html>
